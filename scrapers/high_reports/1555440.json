{
  "reported_to": "curl",
  "reported_by": "maslahhunter ",
  "title": "match",
  "content": "\nSteps To Reproduce:\nlib/telnet.c suboption function incorrecly checks for the sscanf return value. Instead of checking that 2 elements are parsed, the code also continues if just one element matches:\nif(sscanf(v->data, \"%127[^,],%127s\", varname, varval)) {\nAs such it is possible to construct environment values that don't update the varval buffer and instead use the previous value. In combination of advancing in the temp buffer by strlen(v->data) + 1, this means that there will be uninitialized gaps in the generated output temp buffer. These gaps will contain whatever stack contents from previous operation of the application.\nFortunately the environment is controlled by the client and not the server. As such this vulnerability can't be exploited by the server. Practical exploitation is limited by the following requirements:\nattacker is able to control the environment passed to libcurl via CURLOPT_TELNETOPTIONS (\"NEW_ENV=xxx,yyy\") and control xxx and yyy in the curl_slist entries)\nattacker is able to either inspect the network traffic of the telnet connection or to select the server/port the connection is established to\nWhen both are true the attacker is able to some content of the stack. Note however that for this leak to be meaningful, some confidential or sensitive information would need to be leaked. This could happen if some key or other sensitive material (that is otherwise out of the reach of the attacker, due to for example setuid + dropping of privileges, or for example only being able to execute the command remotely in a limited fashion, for example php curl, or similar) would thus become visible fully, or partially. The leak is limited to maximum about half of the 2048 byte temp buffer.\nSteps To Reproduce:\nRun telnet service\ntcpdump -i lo -X -s 65535 port 23\nExecute\nImpact\nlib/telnet.c suboption function incorrecly checks for the sscanf return value. Instead of checking that 2 elements are parsed, the code also continues if just one element matches:\nif(sscanf(v->data, \"%127[^,],%127s\", varname, varval)) {\nAs such it is possible to construct environment values that don't update the varval buffer and instead use the previous value. In combination of advancing in the temp buffer by strlen(v->data) + 1, this means that there will be uninitialized gaps in the generated output temp buffer. These gaps will contain whatever stack contents from previous operation of the application.\nFortunately the environment is controlled by the client and not the server. As such this vulnerability can't be exploited by the server. Practical exploitation is limited by the following requirements:\nattacker is able to control the environment passed to libcurl via CURLOPT_TELNETOPTIONS (\"NEW_ENV=xxx,yyy\") and control xxx and yyy in the curl_slist entries)\nattacker is able to either inspect the network traffic of the telnet connection or to select the server/port the connection is established to\nWhen both are true the attacker is able to some content of the stack. Note however that for this leak to be meaningful, some confidential or sensitive information would need to be leaked. This could happen if some key or other sensitive material (that is otherwise out of the reach of the attacker, due to for example setuid + dropping of privileges, or for example only being able to execute the command remotely in a limited fashion, for example php curl, or similar) would thus become visible fully, or partially. The leak is limited to maximum about half of the 2048 byte temp buffer.\nSteps To Reproduce:\nRun telnet service\ntcpdump -i lo -X -s 65535 port 23\nExecute\n\n",
  "severity": [
    7.5,
    null
  ],
  "bounty": null,
  "weaknesses": [
    "External Control of Critical State Data"
  ],
  "screenshots": {},
  "disclosed_date": 1654772940,
  "report_url": "https://hackerone.com/reports/1555440",
  "is_multi_component": false,
  "complexity": "MEDIUM",
  "novelty": "MEDIUM",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Run telnet service"
    ],
    [
      2,
      "Execute tcpdump -i lo -X -s 65535 port 23"
    ],
    [
      3,
      "Execute curl command with controlled CURLOPT_TELNETOPTIONS environment variables"
    ]
  ],
  "vuln_description": "The vulnerability in libcurl's telnet.c suboption function incorrectly checks the sscanf return value, allowing environment values to be constructed that don't update the varval buffer and instead use previous stack values. This can leak stack contents when an attacker controls both the environment variables and can monitor the telnet connection.",
  "reason": "The vulnerability requires understanding of both the libcurl telnet implementation and how sscanf return values are checked. While the core issue is straightforward (incorrect return value check), discovering the potential for stack leakage requires understanding how the uninitialized buffer interacts with the telnet protocol and environment variable handling.",
  "new_complexity": "MEDIUM",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null
}