{
  "reported_to": "GitLab",
  "reported_by": "cryptopone ",
  "title": "New /add_contacts /remove_contacts quick commands susseptible to XSS from Customer Contact firstname/lastname fields",
  "content": "\nSummary\nIn Gitlab 15.0.0 a new Customer Relations feature was added that allows us to use quick actions to find the contact we wish to select.\nHowever, I noticed that if I set the contact's first name or last name to <script>alert(document.domain)</script> we can get the XSS to trigger when we are attempting to use the quick commands to add/remove a contact.\nSteps to reproduce\nCreate a new group.\nOnce the group is created, navigate to the Settings -> General options for the group.\nExpand the section \"Permissions and group features\" and under \"Customer Relations\" make sure \"Enable customer relations\" is selected.\nReturn back to the group page. On the left side of the screen a new menu option will appear titled \"Customer relations\". Select it.\nCreate a new contact with \"First name\" set to \"<script>alert(document.domain)</script>\" and \"Last name\" set to \"<script>alert(document.domain)</script>\". Provide an email address and save your changes.\nThe user you created in the previous step should now appear as a contact on the Customer Relations page.\nGo to the create new project URL (https://gitlab.com/projects/new#blank_project) and under Project URL, select the Group you created earlier. Give the project a name Ex. \"CustomerProject\".\nOnce the project has been created on the left side of the project page select \"Issues\" and then click \"New Issue\".\nIn the description pane type \"/add_contacts\" so the popup appears, then press \"enter\" to trigger the XSS.\nImpact\nUsers attempting to utilize the quick commands /add_contacts or /remove_contacts could inadvertently trigger XSS while attempting to add/remove a customer to an issue.\nExamples\nThis bug was discovered originally on my self-hosted 15.0.0 but is reproducible on gitlab.com.\n<image_0>\n<image_1>\n<image_2>\nWhat is the current bug behavior?\nThe HTML special characters are not escaped, allowing an iframe to be injected into the page with XSS.\nWhat is the expected correct behavior?\nThe HTML special characters would be escaped and shown in the diagram.\nOutput of checks\nThis bug is reproducible on Gitlab.com\nResults of GitLab environment info\nCode 1.05 KiB\n1System:         Ubuntu 20.04\n2Proxy:          no\n3Current User:   git\n4Using RVM:      no\n5Ruby Version:   2.7.5p203\n6Gem Version:    3.1.4\n7Bundler Version:2.2.33\n8Rake Version:   13.0.6\n9Redis Version:  6.2.6\n10Sidekiq Version:6.4.0\n11Go Version:     unknown\n12\n13GitLab information\n14Version:        15.0.0-ee\n15Revision:       3b397c17532\n16Directory:      /opt/gitlab/embedded/service/gitlab-rails\n17DB Adapter:     PostgreSQL\n18DB Version:     12.10\n19URL:            http://gitlab-pentest4.example.com\n20HTTP Clone URL: http://gitlab-pentest4.example.com/some-group/some-project.git\n21SSH Clone URL:  git@gitlab-pentest4.example.com:some-group/some-project.git\n22Elasticsearch:  no\n23Geo:            no\n24Using LDAP:     no\n25Using Omniauth: yes\n26Omniauth Providers:\n27\n28GitLab Shell\n29Version:        14.3.0\n30Repository storage paths:\n31- default:      /var/opt/gitlab/git-data/repositories\n32GitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell```\n33\n34## Impact\n35\n36JavaScript execution as the authenticated user when the user attempts to add or remove a contact for the new customer relations feature.\n\n",
  "severity": [
    8.7,
    null
  ],
  "bounty": 13950,
  "weaknesses": [
    "Cross-site Scripting (XSS) - Stored"
  ],
  "screenshots": {
    "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/xazoywypzmqfkyhagdjjwklu53of?response-content-disposition=attachment%3B%20filename%3D%22Customer_Contact.png%22%3B%20filename%2A%3DUTF-8%27%27Customer_Contact.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQRFICECNA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T011601Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDqGYTLnh5tpIOp%2BBu2Us%2BRw1i52eon3doC2lLG%2FAZ0%2BwIgHItMlaeaBdH%2FEjdYfdSK%2Fr2oJjwbxvvT1OO8FMRmxYoquwUI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDNWECp3I%2F1QPp%2BcOYCqPBeyg5MMY1W5ewovCqDXd8gxtn%2Fc5%2FQj4HNPCx%2F71OFHgMReknz2jZjY%2B0ZjUPvyzaShcO4JP6ELP9hwmnl%2FMeNzHTMswiIjuwjx7j4qTMUjILB7e%2F94l9VKEcMAJ7o8RvJAMHCTTos0L6sMpwaHD2f6imQ9Y0sjHlFcQmy6gji%2F%2BwyY%2BshQbky5jMNE%2BfQMJRjv4PMBPDtMczy2j6DzwOLUgZ%2F4E%2FpDfY67DWHYam5qWGfIvV6T5fvytnYFIawEywnxmch2DA3lv0DioRBsLDf07t%2B9ua%2FfK7hJAz8uBNkCRY%2BSW7IBp%2BK3qQb5bsEI%2F3VzrVTFjw6z3QWOvrO6jelIrCS1UbCyMJ1vNLE1Z%2BQRo%2BWzjZkF4%2F3TqZVx6alqwnpih5d%2BiCtDMBzPtvqI2DZJY5GrrpmwNYONCjpLRQ53%2FV4kpgSZH4p%2FY8pD0HFszYiLeYPjKmrWtppeAoziHfyG5LQCSK4A06EBg0wKsZPpRsUSNYMo2FVfhULyc64%2BJf4PjBSlxl%2FYYXfBePBQG5OzgdL5T9xa%2BQcpIZkgwLbAVo%2FBlqlFG1j062dgUTsl%2FJHPgzDzkmKHzDF2E9YTqfiLiGoavR3QiS3i8ZKkjG9ht2QmTpUEl35zEZrkPEW3CCK6n92x9GRYZcjM16VPBzUK69NKo9KJLNAaZ2kKhYA7U2Y00JAwTHVl7Kk4JkIJt0%2BKx1lCahbihZgt24NwLVTzaYkm47hKXyFVRilqnQNHe%2FOIFwWwJpYZJ%2FUeG5JDDdVhGrikxDo2jPBZrexD9Rby%2F8Itez87sZ72eTgvMhy1AuIhYDQBSIxQspKnTE6DVyr2Wvysnh8rQbLpxhTdX8ttzASoPWIkpZ1L1P1yLrHow4vWHvwY6sQESAbiZRKGYCmV926h2FLIfjA7WhXV%2BdXKuHmspf1ZK9KSgfTarg9IXFB9WslSzqoeHkxX276%2FLHeXMLn8kpS8i57zAalLCHRlWVQPHcKJvCOetUj1jvp4CuslPz5Pgf%2BtQrXs0mNqHMJaB1f7kBF54kvXQqSYRkhbcxK7uZxU1TbgkLeJ6zbqxtGSin9cWcjRQN5mVcMhnXof1vKRt4FJvZhTyCRMU1LuGqi%2FYlIm95xg%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=3a0688ddb8b696c358130c157a53b50e4a4bb74f0b7976347a51d49e947b769d",
    "image_1": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/xn1518gpry1y5pcc8ypluhok8g7n?response-content-disposition=attachment%3B%20filename%3D%22add_contacts_popup.png%22%3B%20filename%2A%3DUTF-8%27%27add_contacts_popup.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQRFICECNA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T011601Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDqGYTLnh5tpIOp%2BBu2Us%2BRw1i52eon3doC2lLG%2FAZ0%2BwIgHItMlaeaBdH%2FEjdYfdSK%2Fr2oJjwbxvvT1OO8FMRmxYoquwUI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDNWECp3I%2F1QPp%2BcOYCqPBeyg5MMY1W5ewovCqDXd8gxtn%2Fc5%2FQj4HNPCx%2F71OFHgMReknz2jZjY%2B0ZjUPvyzaShcO4JP6ELP9hwmnl%2FMeNzHTMswiIjuwjx7j4qTMUjILB7e%2F94l9VKEcMAJ7o8RvJAMHCTTos0L6sMpwaHD2f6imQ9Y0sjHlFcQmy6gji%2F%2BwyY%2BshQbky5jMNE%2BfQMJRjv4PMBPDtMczy2j6DzwOLUgZ%2F4E%2FpDfY67DWHYam5qWGfIvV6T5fvytnYFIawEywnxmch2DA3lv0DioRBsLDf07t%2B9ua%2FfK7hJAz8uBNkCRY%2BSW7IBp%2BK3qQb5bsEI%2F3VzrVTFjw6z3QWOvrO6jelIrCS1UbCyMJ1vNLE1Z%2BQRo%2BWzjZkF4%2F3TqZVx6alqwnpih5d%2BiCtDMBzPtvqI2DZJY5GrrpmwNYONCjpLRQ53%2FV4kpgSZH4p%2FY8pD0HFszYiLeYPjKmrWtppeAoziHfyG5LQCSK4A06EBg0wKsZPpRsUSNYMo2FVfhULyc64%2BJf4PjBSlxl%2FYYXfBePBQG5OzgdL5T9xa%2BQcpIZkgwLbAVo%2FBlqlFG1j062dgUTsl%2FJHPgzDzkmKHzDF2E9YTqfiLiGoavR3QiS3i8ZKkjG9ht2QmTpUEl35zEZrkPEW3CCK6n92x9GRYZcjM16VPBzUK69NKo9KJLNAaZ2kKhYA7U2Y00JAwTHVl7Kk4JkIJt0%2BKx1lCahbihZgt24NwLVTzaYkm47hKXyFVRilqnQNHe%2FOIFwWwJpYZJ%2FUeG5JDDdVhGrikxDo2jPBZrexD9Rby%2F8Itez87sZ72eTgvMhy1AuIhYDQBSIxQspKnTE6DVyr2Wvysnh8rQbLpxhTdX8ttzASoPWIkpZ1L1P1yLrHow4vWHvwY6sQESAbiZRKGYCmV926h2FLIfjA7WhXV%2BdXKuHmspf1ZK9KSgfTarg9IXFB9WslSzqoeHkxX276%2FLHeXMLn8kpS8i57zAalLCHRlWVQPHcKJvCOetUj1jvp4CuslPz5Pgf%2BtQrXs0mNqHMJaB1f7kBF54kvXQqSYRkhbcxK7uZxU1TbgkLeJ6zbqxtGSin9cWcjRQN5mVcMhnXof1vKRt4FJvZhTyCRMU1LuGqi%2FYlIm95xg%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=8f8e245ee226471b7d1039f5cc933c01422f60013d86627978e7ec6de20496f9",
    "image_2": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/rqqfvjq6764po2knam5qf8c35rnc?response-content-disposition=attachment%3B%20filename%3D%22add_contact.png%22%3B%20filename%2A%3DUTF-8%27%27add_contact.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQRFICECNA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T011601Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIQDqGYTLnh5tpIOp%2BBu2Us%2BRw1i52eon3doC2lLG%2FAZ0%2BwIgHItMlaeaBdH%2FEjdYfdSK%2Fr2oJjwbxvvT1OO8FMRmxYoquwUI%2Bv%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDNWECp3I%2F1QPp%2BcOYCqPBeyg5MMY1W5ewovCqDXd8gxtn%2Fc5%2FQj4HNPCx%2F71OFHgMReknz2jZjY%2B0ZjUPvyzaShcO4JP6ELP9hwmnl%2FMeNzHTMswiIjuwjx7j4qTMUjILB7e%2F94l9VKEcMAJ7o8RvJAMHCTTos0L6sMpwaHD2f6imQ9Y0sjHlFcQmy6gji%2F%2BwyY%2BshQbky5jMNE%2BfQMJRjv4PMBPDtMczy2j6DzwOLUgZ%2F4E%2FpDfY67DWHYam5qWGfIvV6T5fvytnYFIawEywnxmch2DA3lv0DioRBsLDf07t%2B9ua%2FfK7hJAz8uBNkCRY%2BSW7IBp%2BK3qQb5bsEI%2F3VzrVTFjw6z3QWOvrO6jelIrCS1UbCyMJ1vNLE1Z%2BQRo%2BWzjZkF4%2F3TqZVx6alqwnpih5d%2BiCtDMBzPtvqI2DZJY5GrrpmwNYONCjpLRQ53%2FV4kpgSZH4p%2FY8pD0HFszYiLeYPjKmrWtppeAoziHfyG5LQCSK4A06EBg0wKsZPpRsUSNYMo2FVfhULyc64%2BJf4PjBSlxl%2FYYXfBePBQG5OzgdL5T9xa%2BQcpIZkgwLbAVo%2FBlqlFG1j062dgUTsl%2FJHPgzDzkmKHzDF2E9YTqfiLiGoavR3QiS3i8ZKkjG9ht2QmTpUEl35zEZrkPEW3CCK6n92x9GRYZcjM16VPBzUK69NKo9KJLNAaZ2kKhYA7U2Y00JAwTHVl7Kk4JkIJt0%2BKx1lCahbihZgt24NwLVTzaYkm47hKXyFVRilqnQNHe%2FOIFwWwJpYZJ%2FUeG5JDDdVhGrikxDo2jPBZrexD9Rby%2F8Itez87sZ72eTgvMhy1AuIhYDQBSIxQspKnTE6DVyr2Wvysnh8rQbLpxhTdX8ttzASoPWIkpZ1L1P1yLrHow4vWHvwY6sQESAbiZRKGYCmV926h2FLIfjA7WhXV%2BdXKuHmspf1ZK9KSgfTarg9IXFB9WslSzqoeHkxX276%2FLHeXMLn8kpS8i57zAalLCHRlWVQPHcKJvCOetUj1jvp4CuslPz5Pgf%2BtQrXs0mNqHMJaB1f7kBF54kvXQqSYRkhbcxK7uZxU1TbgkLeJ6zbqxtGSin9cWcjRQN5mVcMhnXof1vKRt4FJvZhTyCRMU1LuGqi%2FYlIm95xg%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=f89e98289322c3a9c7c40032ac81e4877d9633ffd676220fd7f35490ab240ddf"
  },
  "disclosed_date": 1668578820,
  "report_url": "https://hackerone.com/reports/1578400",
  "is_multi_component": false,
  "complexity": "LOW",
  "novelty": "LOW",
  "vuln_category": "WEB_APP",
  "steps": [
    [
      1,
      "Create a new group and enable 'Customer Relations' in group settings."
    ],
    [
      2,
      "Create a contact with XSS payload in first/last name fields."
    ],
    [
      3,
      "Create a new project under the same group."
    ],
    [
      4,
      "Create a new issue and trigger XSS via '/add_contacts' command."
    ]
  ],
  "vuln_description": "Cross-site scripting (XSS) vulnerability in GitLab's Customer Relations feature where malicious JavaScript can be executed via contact first/last names when using quick commands.",
  "reason": "The attack requires understanding of GitLab's new Customer Relations feature and its quick commands, but the XSS vector is straightforward once the feature is discovered. No complex state manipulation or novel logic is required.",
  "new_complexity": "LOW",
  "requires_code": false,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null,
  "authnz_metadata": {
    "reason": "The XSS vulnerability involves HTML injection in the first name/last name fields, which is not directly related to authentication or authorization bypass. The methodology described focuses on testing authorization boundaries by swapping user sessions and resource IDs, not on input validation or escaping of user-supplied data.",
    "is_detectable": false
  }
}