{
  "reported_to": "curl",
  "reported_by": "salvet ",
  "title": "Only OpenSSL handles a CRL when passed in via CApath ",
  "content": "\nSummary:\nCode in vtls/nss.c interprets CApath option differently than OpenSSL-using code,\nuser can be mislead to unsecure use of curl/libcurl easily. CApath directory\ncan contain CRL files in addition to CA certificate files and they are used\nfor certificate verification when curl calls OpenSSL. Code path using NSS blindly\nloads all files residing in CApath as CA certificates instead, which has two effects:\nfirst, the meaning of CRLs is ignored and revoked certificates can be accepted,\nsecond, NSS may find duplicate SN in corrupt 'CA certificate' during TLS handshake and break\nconnection to legitimate server (NSS does not perform full validation in load\nand search routines, ASN.1 templates used can mistakenly match both types of object).\nSuch use is not explicitly supported according to curl documentation strictly speaking\nbut I find current implementation very risky (I know security professionals who have fallen to this trap)\nand recommend adding validation/type detection for each file loaded\nfrom CApath (or using c_hash-style name extensions if any file with such extension\nis present, if full validation is deemed too complicated or as a quick fix helping most users).\nSteps To Reproduce:\nrevoke a certificate, install resulting CRL in CApath, try with NSS-based curl\ntry connecting TLS server whose CA has self-signed certificate with SN=1 and CRL in CApath (success can depend on order of directory entries)\nSupporting Material/References:\n[list any additional material (e.g. screenshots, logs, etc.)]\n[attachment / reference]\nImpact\nAn attacker can impersonate TLS server using revoked (presumably leaked) certificate.\n\n",
  "severity": [
    7.0,
    8.9
  ],
  "bounty": null,
  "weaknesses": [
    "Improper Certificate Validation"
  ],
  "screenshots": {},
  "disclosed_date": 1610114940,
  "report_url": "https://hackerone.com/reports/713975",
  "is_multi_component": true,
  "complexity": "MEDIUM",
  "novelty": "MEDIUM",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Revoke a certificate and install the resulting CRL in CApath."
    ],
    [
      2,
      "Attempt to connect to a TLS server using NSS-based curl, where the server's CA has a self-signed certificate with SN=1 and the CRL is present in CApath."
    ]
  ],
  "vuln_description": "The vulnerability arises because NSS-based curl incorrectly interprets all files in the CApath directory as CA certificates, including CRL files. This misinterpretation leads to two issues: revoked certificates may be accepted, and NSS might encounter duplicate serial numbers in what it mistakenly treats as CA certificates, potentially breaking connections to legitimate servers. This behavior contrasts with OpenSSL's correct handling of CRL files in the same directory.",
  "reason": "The vulnerability involves understanding the subtle differences in how OpenSSL and NSS handle files in the CApath directory, particularly CRL files. The attacker must also be aware of the implications of misinterpreting these files, including the potential for accepting revoked certificates and disrupting legitimate connections. The interaction between the CRL files and the certificate verification process is non-obvious and requires specific knowledge of both OpenSSL and NSS behaviors.",
  "new_complexity": "HIGH",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null
}