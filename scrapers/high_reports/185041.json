{
  "reported_to": "shopify-scripts",
  "reported_by": "raydot ",
  "title": "Type confusion in mrb_exc_set leading to memory corruption",
  "content": "\nSimilar to #181871, but the bug is more general. The E_*_ERROR macros are not constants, so the exception types can be redefined to not be exceptions:\ndefine E_NOTIMP_ERROR (mrb_class_get(mrb, \"NotImplementedError\"))\nThis means that any code calling mrb_raise on an exception macro can instead get a non-exception object, leading to memory corruption and arbitrary code execution. This snippet causes a native crash in mruby-engine:\nNotImplementedError = String\nModule.constants # mrb_raise(mrb, E_NOTIMP_ERROR, \"Module.constants not implemented\");\nThis should be fixed by making mrb_exc_set check that it is an exception type. Attached is a patch to mruby to fix this problem.\n\n",
  "severity": [
    9.0,
    10.0
  ],
  "bounty": null,
  "weaknesses": [
    "Uncontrolled Resource Consumption"
  ],
  "screenshots": {},
  "disclosed_date": 1481937960,
  "report_url": "https://hackerone.com/reports/185041",
  "is_multi_component": false,
  "complexity": "MEDIUM",
  "novelty": "MEDIUM",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Redefine NotImplementedError as a String: `NotImplementedError = String`"
    ],
    [
      2,
      "Trigger an operation that raises NotImplementedError: `Module.constants`"
    ]
  ],
  "vuln_description": "The vulnerability involves a type confusion in mrb_exc_set where exception types (E_*_ERROR macros) can be redefined to non-exception objects. This allows an attacker to cause memory corruption and potentially arbitrary code execution by manipulating exception handling mechanisms in mruby.",
  "reason": "The attack requires understanding of mruby's exception handling internals and the ability to redefine core exception types. While the steps to reproduce are simple, the underlying issue involves subtle interactions between Ruby's dynamic nature and mruby's C implementation.",
  "new_complexity": "MEDIUM",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": "181871"
}