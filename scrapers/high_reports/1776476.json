{
  "reported_to": "Internet Bug Bounty",
  "reported_by": "leixiao ",
  "title": "CVE-2022-40127: RCE in Apache Airflow <2.4.0 bash example",
  "content": "\nairflow-2.3.3/airflow/example_dags/example_bash_operator.py has a command injection vulnerability.\nI can control the run_id in the following code(example_bash_operator.py),So I can inject custom commands.\nCode 147 Bytes\n1    also_run_this = BashOperator(\n2        task_id='also_run_this',\n3        bash_command='echo \"run_id={{ run_id }} | dag_run={{ dag_run }}\"',\n4    )\nEnter the DAGs menu and start example_bash_operator task, select \u201cTrigger DAG w/ config\u201d.Set the run_id to \" touch /tmp/success \" and trigger.\n<image_0>\nImpact\nExecute any OS command\n\n",
  "severity": [
    8.8,
    null
  ],
  "bounty": 4000,
  "weaknesses": [
    "Code Injection"
  ],
  "screenshots": {
    "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/xza3m9vq4h68hg7extxh89u7ww1c?response-content-disposition=attachment%3B%20filename%3D%22image.png%22%3B%20filename%2A%3DUTF-8%27%27image.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQX5CGUOUZ%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T010049Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKD%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJHMEUCIE4%2BdsYZj8NuOdkk6Y4TlghZvXM%2BZpWd3av0hpGZRkJVAiEAm51AD3I4iCsm5XvHzzoDRyLERqosajjqDpMEYLOzYNgquwUI%2Bf%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARADGgwwMTM2MTkyNzQ4NDkiDBEDfR3XjEJT1yhKrCqPBSNBBVY34q1kDJW6%2BXH9y0t8uQDR6rkXhTCKeBb0ZPdgjvFpaNEim1ps69Llsjdvyme8%2BE632O5oMn1rlYsduNoe%2BVFT04wgdDyBHMrZPGrmQJXJ9WfLBtn%2B6gGNqLIPUJf%2BEKzihMcxjrR7yQkzov2kHg%2B9jM0DA8aUdQ4MRb90yJ3JGbUWDNMqziFFCFIp3yKHjNIZfqMeu%2B%2FCTkSO2vPiqFY61o66kBeHSBFbttxJg1xaNwEeNDxlrCov6Y0o%2BzNTqxq3uAh6QAxDqENoaaZuIJa%2FDGVzsZ0wGe2z0lD7tye9s0f7MEzc5noOhW%2FFLLsGLKkYwg9burTU%2BtZ40qbMpG9pYHFUZPLJFfmTbAY8dz5ORPEXzfDZsdQPigQVzlK8O2G8pgHcVorLgpmo%2FgFtfX3MATfcduVLW7bN93IPBLtULhsCvXap5gE1W1sfN45qOSlNNv7LCI9pgLlXNZsP%2Fdk0TQTn8S89Cs6t6xMcwhC0mSX7tHtSvtDlcZ1uP3TGZSoEY5%2B5lf6%2FEI5pLU%2Bh3Vc4gNfBFoSsEZVgLyBLJrol4kIaQrkkGwndMuOqrdmtaPH9frf5uRckpTdJL0b0OSukAU4x%2BkbJAH%2FStqmiK70z77ZHS8zdUlA5ceNWFxHZlcFDbLAYNUMOnaGxRks8eTTTO2gYg%2BBMvOljbtJsV7naGGZ86OQmWuPlHJPhEwdO1rVSWuA6%2B0%2BAkBGjUP1QjTkNT%2Fg0NOlOJcOjugVjOwmEkamOeuTWNdr7%2B%2FzCz14KbN4yhu6gnXuas6YrVxuWQhBLC37AQ6OBH2M2WaIc%2FVI7F76YmMOJqtwDDxihpH7Q694bI%2FX%2Bg6gfyG8nMvnn8CLXvwUm2MSBooAE5swwruOHvwY6sQGdTiggpgVOaz7DKSKzbDgKdqYrp7KMtYd%2FFsTa5X5jz%2FnYDarzNLp7yJJghfiuRwVc3hggpxKVJOd4GvRdg1ZZgo5yoykgqXXPsIFhOnCEHuFoFDEZRkHq49fmWaOtxXD8k0cQzzwETnP56DLvYYlAGu6zktJrQnKJUrO%2F23MQ%2Fm6oe%2FP66Ew%2F0kkUOyN%2B192D66NGNnVXHpKKUNrFZRf%2BvNuja268WGn9FQ4RP5eBZxE%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=570f181b7985fd3889cf5fa93342325e74a7c4e28e48fe2749e10f683bf9c269"
  },
  "disclosed_date": 1672897620,
  "report_url": "https://hackerone.com/reports/1776476",
  "is_multi_component": false,
  "complexity": "LOW",
  "novelty": "LOW",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Navigate to the DAGs menu in Apache Airflow and select the 'example_bash_operator' task."
    ],
    [
      2,
      "Select 'Trigger DAG w/ config' and set the 'run_id' parameter to a malicious command, e.g., 'touch /tmp/success'."
    ],
    [
      3,
      "Trigger the DAG to execute the injected command."
    ]
  ],
  "vuln_description": "The vulnerability is a command injection flaw in Apache Airflow's example_bash_operator.py, where the 'run_id' parameter is not properly sanitized before being used in a bash command. This allows an attacker to inject and execute arbitrary OS commands.",
  "reason": "The vulnerability is straightforward to discover as it involves a direct command injection in a visible parameter ('run_id') without any complex interactions or state manipulations. The attack path is linear and does not require understanding of multiple components or subtle interactions.",
  "new_complexity": "LOW",
  "requires_code": true,
  "requires_CVE": true,
  "is_ctf": false,
  "other_report": null,
  "injection_metadata": {
    "is_simple_payload": true
  },
  "authnz_metadata": {
    "reason": "The vulnerability involves command injection through the 'run_id' parameter in Apache Airflow's example_bash_operator.py, which is not related to authentication or authorization bypass. The proposed methodologies focus on AuthN/AuthZ and IDOR vulnerabilities, which are not applicable here.",
    "is_detectable": false
  }
}