{
  "reported_to": "Cosmos",
  "reported_by": "cyberboy ",
  "title": "Race condition in faucet when using starport",
  "content": "\nHi team,\nI and Aditya sent this bug over email on Wed, 29 Dec, 17:45 IST. Later we noticed that security reports are accepted via the HackerOne program. So, I am sending a copy of the bug report here.\nSummary:\nWe were testing an application and we found a race condition bug in the faucet Implementation of Starport.\nhttps://github.com/tendermint/starport\nSteps To Reproduce:\nStart a starport with the below configuration. Note the \"coins_max\" has been set to 11 tokens and hence a user cannot fetch more after the 11 token limits.\nCode 359 Bytes\n1accounts:\n2  - name: alice\n3    coins: [\"0token\", \"200000000stake\"]\n4  - name: bob\n5    coins: [\"500token\", \"100000000stake\"]\n6validator:\n7  name: alice\n8  staked: \"100000000stake\"\n9client:\n10  openapi:\n11    path: \"docs/static/openapi.yml\"\n12  vuex:\n13    path: \"vue/src/store\"\n14faucet:\n15  name: bob\n16  coins: [\"5token\", \"100000stake\"]  \n17  coins_max: [\"11token\", \"100000stake\"]\nNow call the request manually with 5 tokens per request as in our configuration after 2 requests and 10 tokens in total Alice won't be able to fetch more tokens from the faucet\nCode 397 Bytes\n1POST / HTTP/1.1\n2Host: 172.105.41.242:4500\n3User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:95.0) Gecko/20100101 Firefox/95.0\n4Accept: application/json\n5Accept-Language: en-US,en;q=0.5\n6Accept-Encoding: gzip, deflate\n7Referer: http://172.105.41.242:4500/\n8Content-Type: application/json\n9Origin: http://172.105.41.242:4500\n10Content-Length: 63\n11Connection: close\n12{\n13  \"address\": \"ALICE_ADDRESS\"}\n14\nNow we can confirm Alice cannot have more than 11 tokens.\nNow regenerate the server and instead of sending a single request send a concurrent request to fetch tokens in Alice address. We used 50 requests concurrently.\n<image_0>\nNow when we check Alice balance it is 30 which should have not been more than 11\n<image_1>\nWe believe the root cause of the issues is the go mapping which is not advised for concurrency\nhttps://github.com/tendermint/starport/blob/develop/starport/pkg/cosmosfaucet/transfer.go#L59\nSupporting Material/References:\nhttps://cwe.mitre.org/data/definitions/362.html\nImpact\nA malicious user can send concurrent requests to fetch more tokes from faucets than the \"max-credit limit\" which allows.\n\n",
  "severity": [
    9.3,
    null
  ],
  "bounty": 5000,
  "weaknesses": [
    "None"
  ],
  "screenshots": {
    "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/4pj9n1y11kneguz4cmnqimw1ledd?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2021-12-29_at_5.41.56_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2021-12-29_at_5.41.56_PM.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQYGNOTUMY%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T021702Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIF5fGvQpT7B2%2Fk0Yh9keTF%2FfLwbvhqT98JWEvClFMKMQAiBmdJ%2FcI3ki6GKAd6w2%2B%2FsE89aoOBBvBN2pc%2FeC78Bm2iq7BQj6%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAMaDDAxMzYxOTI3NDg0OSIMtfQfu8k1CsW%2Br%2B3cKo8F%2FKwMVhCADjAqfErIOq%2FT1jmJRcHNhp6W0UVlxTEfr9yhFeG9yHrafo8UcV%2FA2doGvdVr2kIrRGlV1YiIkp3JFw9ZlL%2FRUf4riJOAokhCaUlQpWfql547d%2BzYmaq9mT%2BPSu3T0hefYMwrK7cPb4%2FIjTH2jJHQCzJguVRxmCJONXRciulSGKMmMnY0EUGLsMnaalDcr8VnjywavAetM%2BCFTLQ%2FC427VviAmkO%2BR%2B38f4bqeD9q7o83qijkUe8CBBDJ7j0Z1zXdw8%2Brh1cVO8%2FVe3YH1EoDEPObdlKJy2stpMMBLY480qdYgcIXVs7q9ujuwKUAQlOyn%2BRRDA0uf1sFA36zvIM%2BaBOBtFcxIgMcGRb%2BarrTU6SkmiaQP1ISnEZ1pSssJVGyPoPTEsfYk3X4Y6l%2BOImElexmdlwlK1PchGWu4wbb9w6p8Pw7fKgEDLUNcMAdm3HzPOg7%2BdgbssE%2FeWD23%2B2xr8icMkWqvbcd%2FWVRwAr0FesjGDwbOyWF8Oqb2JQnSeOCoWOsP4so6k32kxkBSzlfzJpz27XKxNc0IqdGH6cZlXPNmzvUJ%2Bpu7D4EUBtNUjMuR3HaJ%2FrKuu2Ee11A8uFOszj%2B54lBn6FOwxayUZgKy%2BOU%2FPQQZ%2FITaDNAPi3mibvtOTYf0onhO69wIu3uzeDIRkCK6pMVHM65HjU%2BNALBFUONAz9f87krPMom28ECqxwy08guAL%2BE1cDisgJockC8rYYO%2F3ww0iDiuqx2jXlt1oKNfdRT5ySXApwVWmp6%2FuTwxiUdnUSN1Sr28QGdZYnt0P0gp6RHSbjgpLhq4s%2BMcifo6Ov0xQGC10SaK2q8ped0BOSOiQqK9o1K0M7OloAPMSvYe%2Bkg8HcmcTCc%2BIe%2FBjqyAWiIi2qvkTKu10jyjIuc62KYUPkU%2BI5coUapfWQWE48JULRxCH2HGb78T2AhJfQKWSByftivekPAWT3NNrHCoCdYAV3bRei9zgbkGr7fukG6%2FUS97EcBg%2FhfGgUgLz7w4wGS3KQk4Bng91lDPoAypmizDUYCxXJQoW43uSF83d1rPpivs%2F3TOBFPeMx34RWvYkaOpGXjBta3Ix5p9NNaLFR5e%2Fb3XNEejzWux9u8C7WaRyg%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=c7b18ac5c7b3ee3a3af0852d9773c0c42101f94a4517a4ffc31b28e2466518c5",
    "image_1": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/elyc2hli46v65e31q84ew4vc2lfq?response-content-disposition=attachment%3B%20filename%3D%22Screenshot_2021-12-29_at_5.43.09_PM.png%22%3B%20filename%2A%3DUTF-8%27%27Screenshot_2021-12-29_at_5.43.09_PM.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQYGNOTUMY%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T021702Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKH%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIF5fGvQpT7B2%2Fk0Yh9keTF%2FfLwbvhqT98JWEvClFMKMQAiBmdJ%2FcI3ki6GKAd6w2%2B%2FsE89aoOBBvBN2pc%2FeC78Bm2iq7BQj6%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAMaDDAxMzYxOTI3NDg0OSIMtfQfu8k1CsW%2Br%2B3cKo8F%2FKwMVhCADjAqfErIOq%2FT1jmJRcHNhp6W0UVlxTEfr9yhFeG9yHrafo8UcV%2FA2doGvdVr2kIrRGlV1YiIkp3JFw9ZlL%2FRUf4riJOAokhCaUlQpWfql547d%2BzYmaq9mT%2BPSu3T0hefYMwrK7cPb4%2FIjTH2jJHQCzJguVRxmCJONXRciulSGKMmMnY0EUGLsMnaalDcr8VnjywavAetM%2BCFTLQ%2FC427VviAmkO%2BR%2B38f4bqeD9q7o83qijkUe8CBBDJ7j0Z1zXdw8%2Brh1cVO8%2FVe3YH1EoDEPObdlKJy2stpMMBLY480qdYgcIXVs7q9ujuwKUAQlOyn%2BRRDA0uf1sFA36zvIM%2BaBOBtFcxIgMcGRb%2BarrTU6SkmiaQP1ISnEZ1pSssJVGyPoPTEsfYk3X4Y6l%2BOImElexmdlwlK1PchGWu4wbb9w6p8Pw7fKgEDLUNcMAdm3HzPOg7%2BdgbssE%2FeWD23%2B2xr8icMkWqvbcd%2FWVRwAr0FesjGDwbOyWF8Oqb2JQnSeOCoWOsP4so6k32kxkBSzlfzJpz27XKxNc0IqdGH6cZlXPNmzvUJ%2Bpu7D4EUBtNUjMuR3HaJ%2FrKuu2Ee11A8uFOszj%2B54lBn6FOwxayUZgKy%2BOU%2FPQQZ%2FITaDNAPi3mibvtOTYf0onhO69wIu3uzeDIRkCK6pMVHM65HjU%2BNALBFUONAz9f87krPMom28ECqxwy08guAL%2BE1cDisgJockC8rYYO%2F3ww0iDiuqx2jXlt1oKNfdRT5ySXApwVWmp6%2FuTwxiUdnUSN1Sr28QGdZYnt0P0gp6RHSbjgpLhq4s%2BMcifo6Ov0xQGC10SaK2q8ped0BOSOiQqK9o1K0M7OloAPMSvYe%2Bkg8HcmcTCc%2BIe%2FBjqyAWiIi2qvkTKu10jyjIuc62KYUPkU%2BI5coUapfWQWE48JULRxCH2HGb78T2AhJfQKWSByftivekPAWT3NNrHCoCdYAV3bRei9zgbkGr7fukG6%2FUS97EcBg%2FhfGgUgLz7w4wGS3KQk4Bng91lDPoAypmizDUYCxXJQoW43uSF83d1rPpivs%2F3TOBFPeMx34RWvYkaOpGXjBta3Ix5p9NNaLFR5e%2Fb3XNEejzWux9u8C7WaRyg%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=6c3e7c370fdbc2661a50f0471332a61471ac48bcd664750cacf6eb903aadee7d"
  },
  "disclosed_date": 1658872020,
  "report_url": "https://hackerone.com/reports/1438052",
  "is_multi_component": false,
  "complexity": "MEDIUM",
  "novelty": "MEDIUM",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Configure a Starport application with specific faucet settings (coins_max set to 11 tokens) and start the server."
    ],
    [
      2,
      "Send concurrent requests (e.g., 50 requests) to the faucet endpoint to request tokens for the same address."
    ]
  ],
  "vuln_description": "A race condition in the Starport faucet implementation allows a user to bypass the maximum token limit (coins_max) by sending concurrent requests. The vulnerability arises due to improper synchronization when checking and updating the token balance in a shared map, enabling a malicious user to accumulate more tokens than the configured limit.",
  "reason": "The vulnerability involves understanding the faucet's token limit mechanism and exploiting a race condition in concurrent requests. While the concept of race conditions is well-known, identifying this specific issue requires knowledge of the faucet's implementation details and the ability to craft concurrent requests to trigger the condition.",
  "new_complexity": "MEDIUM",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null
}