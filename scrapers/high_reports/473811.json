{
  "reported_to": "Node.js third-party modules",
  "reported_by": "skyn3t ",
  "title": "[bower] Arbitrary File Write through improper validation of symlinks while package extraction",
  "content": "\nI would like to report file write in arbitrary locations via install command in bower\nIt allows attackers to write arbitrary files when a malicious package is extracted.\nModule\nmodule name: bower\nversion: 1.8.4\nnpm page: https://www.npmjs.com/package/bower\nModule Description\nBower offers a generic, unopinionated solution to the problem of front-end package management, while exposing the package dependency model via an API that can be consumed by a more opinionated build stack. There are no system wide dependencies, no dependencies are shared between different apps, and the dependency tree is flat.\nModule Stats\nweekly downloads\n175,693\nVulnerability\nVulnerability Description\nQuoting from #362118\nThe vulnerability is a form of directory traversal that can be exploited by extracting files from an archive. The premise of the directory traversal vulnerability is that an attacker can gain access to parts of the file system outside of the target folder in which they should reside. The attacker can then overwrite executable files and either invoke them remotely or wait for the system or user to call them, thus achieving remote command execution on the victim\u2019s machine. The vulnerability can also cause damage by overwriting configuration files or other sensitive resources, and can be exploited on both client (user) machines and servers.\nWhen we install a package that is in the tar archive format using bower, it tries to extract the package first. Bower installer attempts to prevent a package from writing any files outside the install directory; however it is possible to bypass the check with a symbolic link in a crafted npm package.\nExample structure of malicious npm package:\nCode 436 Bytes\n1$ tar -xvf hello.tar.gz\n2hello/\n3hello/README.md\n4hello/link\n5hello/link/PWNED\n6hello/package.json\n7\n8$ tar -tvf hello.tar.gz\n9drwxr-xr-x 0/0               0 2019-01-01 21:27 hello/\n10-rw-r--r-- 0/0              12 2019-01-01 21:27 hello/README.md\n11lrw-r--r-- 0/0               0 2019-01-01 21:27 hello/link -> /tmp\n12-rw-r--r-- 0/0              15 2019-01-01 21:27 hello/link/PWNED\n13-rw-r--r-- 0/0             102 2019-01-01 21:27 hello/package.json\nSteps To Reproduce:\nUsing attached file hello.tar.gz\nCode 257 Bytes\n1$ bower install ./hello.tar.gz\n2bower hello.tar#*                 copy /home/path/hello.tar.gz\n3bower hello.tar#*              extract hello.tar.gz\n4bower hello.tar#*             resolved /home/path/hello.tar.gz\n5bower hello.tar#*              install hello.tar\nThis creates a file /tmp/PWNED which is a sufficient PoC\nPatch\nI'm fully aware that bower has been deprecated and using yarn is advised. Therefore, I would recommend releasing an advisory if a patch might not be possible.\nThe vulnerability lies in extract.js\nCode 71 Bytes\n1function isSymlink(entry) {\n2    return entry.type === 'SymbolicLink';\n3}\nAccording to the docs of tar-fs making following changes will work in order to properly ignore symlinks\nCode 146 Bytes\n- function isSymlink(entry) {\n+ function isSymlink(_, entry) {\n-     return entry.type === 'SymbolicLink';\n+    return entry.type === 'symlink';\n}\nSupporting Material/References:\nState all technical information about the stack where the vulnerability was found\nUbuntu 16.04\nNode v11.3.0\nBower 1.8.4\nWrap up\nI contacted the maintainer to let them know: N\nI opened an issue in the related repository: N\nHunter's comments and funny memes goes here\n<image_0>\nImpact\nWriting arbitrary files on the system\n\n",
  "severity": [
    8.0,
    null
  ],
  "bounty": null,
  "weaknesses": [
    "Path Traversal"
  ],
  "screenshots": {
    "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/000/399/574/eb57cf7c8be70e0ba8edd5b2e3810f383aa1a919/HAPPY_NEW_YEAR.png?response-content-disposition=attachment%3B%20filename%3D%22HAPPY_NEW_YEAR.png%22%3B%20filename%2A%3DUTF-8%27%27HAPPY_NEW_YEAR.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ3QLCVJEY%2F20250326%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250326T151503Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJIMEYCIQCq0ZcXoddxcmzR7Yhg6VfWiTRoH0A7Dzwld9Kb0V1WXQIhAIzaIKbxI35BXzxJkIOQqQ08FY4N%2F5ljwG4tz1KlTcc3KrIFCCwQAxoMMDEzNjE5Mjc0ODQ5IgwWRSNerQuiUJQwmVAqjwUWIR7K%2FfofFDcKmwVgcI82%2FEVsmgVHiSw6HsrMX8Y%2BWZ5C5wvFCJyDVR2I9i%2B9eb%2B4EtQU9OREffzHPlP52PKdQJUdOsV3ZwgFJdcBjcg8ItQTu43lQFYp3VLHwFX5ilCizsoTFpbUuowgMVVJriNODv8Qn8KS24LSEbpn3JGwPa2MHWh9J%2FV4MErIJI8i25h7MBmem2BoCPJ7PsjLXHSQ%2FTKRTrFj3P18PhCU2bkNqFUhAtl5hP%2B2yhngoPquhcseBmyjHa1mXOTr68d91PBzkQTjKZ2bLG2rFFxEQrVyAPLGcizxDqPY%2FBjFTrr63WY9OtSow5yX4YqYG9ArDYP83GY15NNloESo%2Fk662AcNyJNueSsIcycX%2Fv%2BDfuv%2BsgUR3Gal63nRsBmnW85n1DRgfmfDCHhSpTWg%2BUJAns5YbzqmgACqXrkXoEY9LPPpgllSHvdbA8k3%2FUJC3HTrrtasXkGhV2C7IkFD6L631wPlF5apUccjF83w0YMDhx49abfqTJndYlNqYrrb0rT2JOBEu12IU3Iol3ZIE78oRlHhX3dabzKMc%2FlpGzZVBxls71PIIsQMP9yClPhHiTXTSHoaXMMdIAASlaNnwkTdyhyhRTo3jS1MfGXt%2BrRnZ%2FOlGR%2FxnTJ679tWkY52VdCq9PbSjNymA%2FnnYRg9iI7QQFuP5ZVWSo7ouFd%2Bpn7OofcwVvCrl7b5HGAbE4E%2BZychJxm7Nu4pFMAB52PTxDqoHCyX%2BdqglDupbQKNHIA8pdm75gqor1P1Bq1d82lIL6n0FZJQAnrc6yfCAu8hqkgFeuyOffEwtyFmE2fOGuS%2FDePCc9l7DfcIDZtCnNIV3RPTHQKvDtOkursZD%2BhOViNnX4%2FMMJy6j78GOrABg2v4N5DPsLKmAzmEW0GjKEYcSe%2BYSDkZ%2Fb9nGe4N0fSQukZS6emaG%2FnmDew1jQsniYhFcRNwvmnR2mgq8YdYOqG1lziJG6L0J6Ced%2BB2jZoHfsh8UkYlCdHsQtsHO2M20Rc1HSanFjb7S2q8j%2Fw9yWKqdVneCKQjSq0cnGY%2BCMX2ywKPRgNTXvbMpvIcAP2OXhdOTx5%2F3517CH0ncLvOyD%2F9hD4wkbDYhTE3Lmyxl30%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=de32b9f4a285c9b8a19fab91e70582dda68b3f089b12ce45fc6cb614a0ff7ea9"
  },
  "disclosed_date": 1548506280,
  "report_url": "https://hackerone.com/reports/473811",
  "is_multi_component": false,
  "complexity": "MEDIUM",
  "novelty": "LOW",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Create a malicious tar archive with a symbolic link pointing to a sensitive location (e.g., /tmp) and a file within that linked directory"
    ],
    [
      2,
      "Execute 'bower install' on the malicious tar archive to trigger the extraction process"
    ]
  ],
  "vuln_description": "The vulnerability allows arbitrary file write through improper validation of symlinks during package extraction in Bower. A malicious package can create symbolic links that point outside the intended extraction directory, enabling an attacker to write files to arbitrary locations on the filesystem.",
  "reason": "The attack involves creating a specially crafted tar archive with symbolic links, which is a straightforward process for someone familiar with tar and symbolic links. The vulnerability stems from a simple validation oversight in Bower's extraction logic, which doesn't properly handle symlinks during package extraction.",
  "new_complexity": "LOW",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": "362118"
}