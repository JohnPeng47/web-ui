{
  "reported_to": "shopify-scripts",
  "reported_by": "geeknik ",
  "title": "heap-buffer-overflow (read outside of buffer) in mrb_vm_exec()",
  "content": "\nTriggered in 3231219 (14 April 2017). Compiled with afl-gcc + asan.\n./mirb < test000\nCode 1.60 KiB\n1==10555==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x60200001c920 at pc 0x52be2c bp 0x7ffe6751ada0 sp 0x7ffe6751ad98\n2READ of size 16 at 0x60200001c920 thread T0\n3    #0 0x52be2b in mrb_vm_exec /root/mruby/src/vm.c:1556\n4    #1 0x530a19 in mrb_vm_run /root/mruby/src/vm.c:829\n5    #2 0x53260f in mrb_run /root/mruby/src/vm.c:2644\n6    #3 0x53260f in ecall /root/mruby/src/vm.c:320\n7    #4 0x4fd59f in mrb_vm_exec /root/mruby/src/vm.c:1716\n8    #5 0x530a19 in mrb_vm_run /root/mruby/src/vm.c:829\n9    #6 0x53260f in mrb_run /root/mruby/src/vm.c:2644\n10    #7 0x53260f in ecall /root/mruby/src/vm.c:320\n11    #8 0x508b65 in mrb_vm_exec /root/mruby/src/vm.c:1170\n12    #9 0x530a19 in mrb_vm_run /root/mruby/src/vm.c:829\n13    #10 0x53260f in mrb_run /root/mruby/src/vm.c:2644\n14    #11 0x53260f in ecall /root/mruby/src/vm.c:320\n15    #12 0x508b65 in mrb_vm_exec /root/mruby/src/vm.c:1170\n16    #13 0x530a19 in mrb_vm_run /root/mruby/src/vm.c:829\n17    #14 0x40781f in main /root/mruby/mrbgems/mruby-bin-mirb/tools/mirb/mirb.c:549\n18    #15 0x7f93c4ea5b44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n19    #16 0x40a71c (/root/mruby/bin/mirb+0x40a71c)\n20\n210x60200001c920 is located 0 bytes to the right of 16-byte region [0x60200001c910,0x60200001c920)\n22allocated by thread T0 here:\n23    #0 0x7f93c55849f6 in __interceptor_realloc (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x549f6)\n24    #1 0x421a2e in mrb_realloc_simple /root/mruby/src/gc.c:202\n25    #2 0x421a2e in mrb_realloc /root/mruby/src/gc.c:216\n26    #3 0x421a2e in mrb_malloc /root/mruby/src/gc.c:237\n27\n28SUMMARY: AddressSanitizer: heap-buffer-overflow /root/mruby/src/vm.c:1556 mrb_vm_exec\n\n",
  "severity": [
    7.0,
    8.9
  ],
  "bounty": null,
  "weaknesses": [
    "Heap Overflow"
  ],
  "screenshots": {},
  "disclosed_date": 1494348180,
  "report_url": "https://hackerone.com/reports/221251",
  "is_multi_component": true,
  "complexity": "HIGH",
  "novelty": "MEDIUM",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Compile mruby with afl-gcc and asan (AddressSanitizer) enabled."
    ],
    [
      2,
      "Run the compiled 'mirb' executable with the test input file: './mirb < test000'."
    ]
  ],
  "vuln_description": "The vulnerability is a heap-buffer-overflow read in the mrb_vm_exec() function of mruby's virtual machine. The issue occurs when the VM attempts to read 16 bytes from memory just outside an allocated buffer (0x60200001c920), which is located exactly at the end of a 16-byte region. This can lead to memory corruption or information disclosure.",
  "reason": "The vulnerability appears to be a straightforward buffer read overflow in a single component (the VM execution). While it requires understanding of mruby's VM internals, the discovery process itself is relatively simple - feeding random inputs via fuzzing until a crash occurs. The complexity is low because it doesn't involve multiple components, complex state manipulation, or subtle interactions between components.",
  "new_complexity": "LOW",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null
}