{
  "reported_to": "shopify-scripts",
  "reported_by": "raydot ",
  "title": "Type confusion in wrap_decimal leading to memory corruption",
  "content": "\nDecimal can be redefined, causing the Decimal class lookup in wrap_decimal to be invalid. This can lead to memory corruption or arbitrary code execution.\nThe following snippet results in a native crash in mruby-engine\nolddecimal = Decimal.new(1)\nDecimal = Hash\na = -olddecimal\nputs a\nI suspect you caught this along with charliesome's similar bug for Struct. If not I'll follow up with a patch and an RCE exploit.\n\n",
  "severity": [
    9.0,
    10.0
  ],
  "bounty": null,
  "weaknesses": [
    "Code Injection"
  ],
  "screenshots": {},
  "disclosed_date": 1484528580,
  "report_url": "https://hackerone.com/reports/185051",
  "is_multi_component": true,
  "complexity": "HIGH",
  "novelty": "MEDIUM",
  "vuln_category": "CODE",
  "steps": [
    [
      1,
      "Create a Decimal object: olddecimal = Decimal.new(1)"
    ],
    [
      2,
      "Redefine the Decimal class: Decimal = Hash"
    ],
    [
      3,
      "Perform a negation operation on the old decimal: a = -olddecimal"
    ],
    [
      4,
      "Print the result: puts a"
    ]
  ],
  "vuln_description": "The vulnerability involves a type confusion issue in the 'wrap_decimal' function where the Decimal class can be redefined, leading to an invalid class lookup. This can result in memory corruption or arbitrary code execution when operations are performed on the original Decimal object after the class has been redefined.",
  "reason": "The attack requires understanding of Ruby's dynamic class system and the ability to redefine classes during runtime. The interaction between the original Decimal object and the redefined Decimal class is subtle and non-obvious, as it leads to unexpected behavior in the 'wrap_decimal' function.",
  "new_complexity": "HIGH",
  "requires_code": true,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null,
  "injection_metadata": {
    "is_simple_payload": true
  },
  "authnz_metadata": {
    "reason": "since Slack and Github are independent applications, none of the steps would apply since they deal with user_session/user_ids scoped to the same application",
    "is_detectable": false
  }
}