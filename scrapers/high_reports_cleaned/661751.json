{
  "reported_to": "Starbucks",
  "reported_by": "mindtrick ",
  "title": "Subdomain takeover of d02-1-ag.productioncontroller.starbucks.com",
  "content": "\nSummary:\nI was able to claim the subdomain: d02-1-ag.productioncontroller.starbucks.com using Azure Cloud Service\nPlatform(s) Affected:\nSubdomain\nAzure Cloud Service\nSteps To Reproduce:\nUsing dig, I was able to determine that the subdomain 'd02-1-ag.productioncontroller.starbucks.com' was vulnerable to takeover. The record showed status: NXDOMAIN and was pointing to the CNAME: 3edbac0a-5c43-428a-b451-a5eb268f888b.cloudapp.net.\nUsing this information, I was able to create a new Azure Cloud Service with the name '3edbac0a-5c43-428a-b451-a5eb268f888b'. This would resolve to the CNAME record mentioned above.\nI then crafted a website and uploaded it to the cloud service using this as a guide: https://docs.microsoft.com/en-us/azure/cloud-services/cloud-services-how-to-create-deploy-portal.\nI was then able to view the uploaded site at http://d02-1-ag.productioncontroller.starbucks.com\nSupporting Material/References:\nPOC:\nhttp://d02-1-ag.productioncontroller.starbucks.com/poc-2sKR4C.html\nHow can the system be exploited with this bug?\nSee impact below.\nHow did you come across this bug ?\nUsing enumeration, I was able to discover this domain and determined it was vulnerable by the DNS record data mentioned in the steps above.\nRecommendations for fix\nTo mitigate this issue you can:\nRemove the DNS record from the DNS zone if it is no longer needed.\nClaim the domain name in a permanent DNS record so it cannot be used elsewhere.\nImpact\nThis is extremely vulnerable to attacks as a malicious user could create any web page with any content and host it on the starbucks.com domain. This would allow them to post malicious content which would be mistaken for a valid site. They could steal cookies, bypass domain security, steal sensitive user data, etc. Here is a nice write-up of the vulnerabilities: https://0xpatrik.com/subdomain-takeover/\nAs mentioned in the write-up above the\n\n",
  "severity": [
    8.4,
    null
  ],
  "bounty": null,
  "weaknesses": [
    "Privilege Escalation"
  ],
  "screenshots": {},
  "disclosed_date": 1565910300,
  "report_url": "https://hackerone.com/reports/661751",
  "is_multi_component": true,
  "complexity": "HIGH",
  "novelty": "HIGH",
  "vuln_category": "WEB_APP",
  "steps": [
    [
      1,
      "Use dig to check the DNS records for the subdomain 'd02-1-ag.productioncontroller.starbucks.com' and note the CNAME pointing to '3edbac0a-5c43-428a-b451-a5eb268f888b.cloudapp.net'."
    ],
    [
      2,
      "Create a new Azure Cloud Service with the name '3edbac0a-5c43-428a-b451-a5eb268f888b' and upload a custom website to it."
    ]
  ],
  "vuln_description": "The subdomain 'd02-1-ag.productioncontroller.starbucks.com' was vulnerable to takeover due to an unclaimed CNAME record pointing to an Azure Cloud Service. An attacker could claim the subdomain by creating an Azure Cloud Service with the same name as the CNAME record, allowing them to host malicious content under the Starbucks domain.",
  "reason": "The attack involves a straightforward process of checking DNS records and claiming an unclaimed Azure Cloud Service. There are no complex interactions or state manipulations required, and the logic is commonly understood in subdomain takeover scenarios.",
  "new_complexity": "LOW",
  "requires_code": false,
  "requires_CVE": false,
  "is_ctf": false,
  "other_report": null,
  "idor_detectable": false,
  "authnz_byppass_detectable": false,
  "is_simple_payload": true,
  "injection_metadata": {
    "is_simple_payload": true
  },
  "authnz_metadata": {
    "reason": "The subdomain takeover vulnerability involves DNS misconfiguration and Azure Cloud Service exploitation, which is outside the scope of the AuthN/AuthZ testing methodology described. The methodology focuses on session, action, and resource_id manipulation within a single application, whereas this vulnerability is infrastructure-related and does not involve user sessions or application-level authorization checks.",
    "is_detectable": false
  }
}