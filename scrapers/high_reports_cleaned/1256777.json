{
    "reported_to": "GitLab",
    "reported_by": "joaxcar ",
    "title": "Stored XSS in main page of a project caused by arbitrary script payload in group \"Default initial branch name\"",
    "content": "\nSummary\nA stored XXS exists in the main page of a project. By changing the \"default branch name\" of a group a malicious user can inject arbitrary JavaScript into the main page of a project. Any user that is either at least developer of the project, or an administrator of the GitLab instance, and access the project URL will trigger the payload.\n<image_0>\nAs a default self-hosted GitLab instance does not enforce any CSP rules any javascript can be called. Including inclusion of external script files (<script src=\"external_script\"></script>). On GitLab.com I have not been able to bypass the CSP except from changing the base-uri which causes all links on the page(including navigation bars) to point to the attackers site (with payload <Base Href=\"attacker_site\">).\nOn a self-hosted instance without proper CSP I was able to generate personal access tokens from the victim that could be extracted by the attacker to get complete access to the victims content and actions. If the victim is an Administrator this leads to complete access to the system. (I will post a script PoC when I have cleaned it up)\n<image_1>\nSteps to reproduce\nCreate two users, attacker01 and victim01\nLog in as attacker01\nCreate a group attack_group by visiting https://gitlab.domain.com/groups/new#create-group-pane\nGo to https://gitlab.domain.com/groups/attack_group/-/settings/repository and expand the \"Default initial branch name\" tab\nEnter <script>alert(1);</script> as \"Default initial branch name\" and click \"save changes\"\n<image_2>\nGo to https://gitlab.domain.com/groups/attack_group and click the button \"New project\" and choose to create a \"Create blank project\"\nName the project attacking_project and click \"Create project\"\nNow the project will load and the alert should pop up.\n<image_3>\noptional:\n9. On the project main page click the \"Invite members\" button and invite victim01 as a Developer\n10. Log in with victim01\n11. Visit https://gitlab.domain.com/attack_group/attacking-project and the script will run for the victim as well\nImpact\nStored XXS capable of arbitrary script execution. Impact depends on the instance CSP settings.\nExamples\nIf an administrator of GitLab.com visit https://gitlab.com/attack_xxs_group/test3 (a private group and project) one can see that ALL links on the site (all navigation and actions) are redirected to google.com. This is caused by the payload <Base Href=\"//www.google.com\">\nWhat is the current bug behavior?\nArbitrary JavaScript is executed on a project main page\nWhat is the expected correct behavior?\nThe branch name should be sanitized and checked for bad input, and the included branch name should be sanitized when displayed.\nOutput of checks\nThis bug happens on GitLab.com\nBut CSP removes most of the impact\nResults of GitLab environment info\nI did not manage to run the environment script. I tried this on a Azure hosted GitLab server created from the Azure store.\nImpact\nStored XXS capable of arbitrary script execution. Impact depends on the instance CSP settings. If CSP is not properly set the attacker can execute arbitrary commands as the victim and/or generate personal access tokens for full account access. If an Administrator gets compromised, this could lead to complete instance access.\nOn GitLab.com an attacker can change the base-uri to make all links redirect to the attacker's site\n\n",
    "severity": [
        7.3,
        null
    ],
    "bounty": 3000,
    "weaknesses": [
        "Cross-site Scripting (XSS) - Stored"
    ],
    "screenshots": {
        "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/uwjvq9r04qp9pmkdmaj12hik5q8o?response-content-disposition=attachment%3B%20filename%3D%22info.png%22%3B%20filename%2A%3DUTF-8%27%27info.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ4THEFA5D%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T184547Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELL%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIA%2FmPasm3e%2B19iYq8ElMfUlBHfCf6hlXlZIXFhTG6MsyAiA22QrvM1KyqD2QsQPlvEB5%2BqWhlwUVotrDfZ53lEo%2FwSqyBQgbEAMaDDAxMzYxOTI3NDg0OSIMp2KwBQXeE9h770PMKo8F2LsCKqJJekXmGYpoE3BMHakxy0DuOEoxo%2FRth%2BpPUahbaR4h4NfxMSEHG4yYJFrDfhifa0VJ1tExh20vARZQFhJGsx6AGuBVoIWIUTGIXfSokr8PnPDb6HbDx72p3Y5U793ruMsTrfXTJgvJNn7wmPvIi6cScEn6eSvBEb7ALVamM9aSLLie%2FIIB3Pohl4kFNE57dyq6a2whlTUHbzYxlhklVXsex4nQ%2BX1BAlfc85T17OPewfEhHrhgVqYGXfLpaeBzZxEEgZwVJRZnu233bFRpuZL5k9KmZB0ZBQWC7mJKCeHqXoODzjFMoWokeXZwLf1qUNEtSW5VUkFWQufOhkbKJMSboIPt6ql8DQlkzhmSNhQkAhqCtFHtRlJi3UXykxDW07%2FEcfTfmfUilVdogKxQVmbqvV8%2FDXapSnbWCJyBCFeEt0KZRsTlCIn3z2QWN0CcaEr2oauE6vcCuHDOAzX8x5PbXGgK2o0XfDL58vKV%2B0NlORnv7BwHJy3gyJFam%2FkhiJTHbd4ElgG%2FnWqoo13ioV1VIZTaQh7Gwv6hJhKyrHTZQElF%2FPZDI3IsnKKKq4qReoy51Gqe9s17ZrK%2BKlcs6WnFZPspohVhTI6L2%2BdQDThzVEOA%2FdQy9zdfsXDjguDvvzMWvmENdzBQLrfT2nls43AIwnfblCgoxCAtEBHH%2B06giDFvCWsP47XN2tavYho7M0fqXRex6NZ0lMAQjAbjuaJwldBGjyUIJINjJC1IxXemIiJuTeQSeWt06F3qDzGfI7iWqR6Dovn%2Bxkl23yz0E%2FRHic0ABTenPEMDwZGrfxjW2gJChxPvwdyfCVkB6lKFdKf1k6GW3eaxq%2BweEHrftVBMBuOCNSp8y5ss7jDP5Iu%2FBjqyAT2lA1l32Xsa1doyemZyuyklW3hBQObQzaOIfqt0REpbgA3YlNeNDY%2FkG2EfBfEKNOzR3tA9Zrm2ez4mWkd%2Bnk5noQO3a%2BZPiazIpR%2BEpY%2BXtIl9sxj%2BCoFt5NyVydIeQ47wXtKqKb9zoJSrY5ITBK%2B%2Fe%2FZfrAV9fXkTL3L%2Fc%2FL6wa0dSeA8FrTsTDvql7F4gEm%2Fvt3XNhGi7ISupxr5ryFPnBfNO9isedAQIjSmkxPVWhI%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=a12a385176559bded27cdb203bd1f94c418ffcf85f4fa66a98fdb090ddc27f0c",
        "image_1": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/57jvi3s92dw0xz68ysyq59em4h82?response-content-disposition=attachment%3B%20filename%3D%22email.png%22%3B%20filename%2A%3DUTF-8%27%27email.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ4THEFA5D%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T184547Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELL%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIA%2FmPasm3e%2B19iYq8ElMfUlBHfCf6hlXlZIXFhTG6MsyAiA22QrvM1KyqD2QsQPlvEB5%2BqWhlwUVotrDfZ53lEo%2FwSqyBQgbEAMaDDAxMzYxOTI3NDg0OSIMp2KwBQXeE9h770PMKo8F2LsCKqJJekXmGYpoE3BMHakxy0DuOEoxo%2FRth%2BpPUahbaR4h4NfxMSEHG4yYJFrDfhifa0VJ1tExh20vARZQFhJGsx6AGuBVoIWIUTGIXfSokr8PnPDb6HbDx72p3Y5U793ruMsTrfXTJgvJNn7wmPvIi6cScEn6eSvBEb7ALVamM9aSLLie%2FIIB3Pohl4kFNE57dyq6a2whlTUHbzYxlhklVXsex4nQ%2BX1BAlfc85T17OPewfEhHrhgVqYGXfLpaeBzZxEEgZwVJRZnu233bFRpuZL5k9KmZB0ZBQWC7mJKCeHqXoODzjFMoWokeXZwLf1qUNEtSW5VUkFWQufOhkbKJMSboIPt6ql8DQlkzhmSNhQkAhqCtFHtRlJi3UXykxDW07%2FEcfTfmfUilVdogKxQVmbqvV8%2FDXapSnbWCJyBCFeEt0KZRsTlCIn3z2QWN0CcaEr2oauE6vcCuHDOAzX8x5PbXGgK2o0XfDL58vKV%2B0NlORnv7BwHJy3gyJFam%2FkhiJTHbd4ElgG%2FnWqoo13ioV1VIZTaQh7Gwv6hJhKyrHTZQElF%2FPZDI3IsnKKKq4qReoy51Gqe9s17ZrK%2BKlcs6WnFZPspohVhTI6L2%2BdQDThzVEOA%2FdQy9zdfsXDjguDvvzMWvmENdzBQLrfT2nls43AIwnfblCgoxCAtEBHH%2B06giDFvCWsP47XN2tavYho7M0fqXRex6NZ0lMAQjAbjuaJwldBGjyUIJINjJC1IxXemIiJuTeQSeWt06F3qDzGfI7iWqR6Dovn%2Bxkl23yz0E%2FRHic0ABTenPEMDwZGrfxjW2gJChxPvwdyfCVkB6lKFdKf1k6GW3eaxq%2BweEHrftVBMBuOCNSp8y5ss7jDP5Iu%2FBjqyAT2lA1l32Xsa1doyemZyuyklW3hBQObQzaOIfqt0REpbgA3YlNeNDY%2FkG2EfBfEKNOzR3tA9Zrm2ez4mWkd%2Bnk5noQO3a%2BZPiazIpR%2BEpY%2BXtIl9sxj%2BCoFt5NyVydIeQ47wXtKqKb9zoJSrY5ITBK%2B%2Fe%2FZfrAV9fXkTL3L%2Fc%2FL6wa0dSeA8FrTsTDvql7F4gEm%2Fvt3XNhGi7ISupxr5ryFPnBfNO9isedAQIjSmkxPVWhI%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=531b828ab45f43cf846aa24ccb0cfb8d2dbf8882469221d53bf2300c534595a4",
        "image_2": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/vxrdch7u2jg4mgxcwaozj9ib67r1?response-content-disposition=attachment%3B%20filename%3D%22input.png%22%3B%20filename%2A%3DUTF-8%27%27input.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ4THEFA5D%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T184547Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELL%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIA%2FmPasm3e%2B19iYq8ElMfUlBHfCf6hlXlZIXFhTG6MsyAiA22QrvM1KyqD2QsQPlvEB5%2BqWhlwUVotrDfZ53lEo%2FwSqyBQgbEAMaDDAxMzYxOTI3NDg0OSIMp2KwBQXeE9h770PMKo8F2LsCKqJJekXmGYpoE3BMHakxy0DuOEoxo%2FRth%2BpPUahbaR4h4NfxMSEHG4yYJFrDfhifa0VJ1tExh20vARZQFhJGsx6AGuBVoIWIUTGIXfSokr8PnPDb6HbDx72p3Y5U793ruMsTrfXTJgvJNn7wmPvIi6cScEn6eSvBEb7ALVamM9aSLLie%2FIIB3Pohl4kFNE57dyq6a2whlTUHbzYxlhklVXsex4nQ%2BX1BAlfc85T17OPewfEhHrhgVqYGXfLpaeBzZxEEgZwVJRZnu233bFRpuZL5k9KmZB0ZBQWC7mJKCeHqXoODzjFMoWokeXZwLf1qUNEtSW5VUkFWQufOhkbKJMSboIPt6ql8DQlkzhmSNhQkAhqCtFHtRlJi3UXykxDW07%2FEcfTfmfUilVdogKxQVmbqvV8%2FDXapSnbWCJyBCFeEt0KZRsTlCIn3z2QWN0CcaEr2oauE6vcCuHDOAzX8x5PbXGgK2o0XfDL58vKV%2B0NlORnv7BwHJy3gyJFam%2FkhiJTHbd4ElgG%2FnWqoo13ioV1VIZTaQh7Gwv6hJhKyrHTZQElF%2FPZDI3IsnKKKq4qReoy51Gqe9s17ZrK%2BKlcs6WnFZPspohVhTI6L2%2BdQDThzVEOA%2FdQy9zdfsXDjguDvvzMWvmENdzBQLrfT2nls43AIwnfblCgoxCAtEBHH%2B06giDFvCWsP47XN2tavYho7M0fqXRex6NZ0lMAQjAbjuaJwldBGjyUIJINjJC1IxXemIiJuTeQSeWt06F3qDzGfI7iWqR6Dovn%2Bxkl23yz0E%2FRHic0ABTenPEMDwZGrfxjW2gJChxPvwdyfCVkB6lKFdKf1k6GW3eaxq%2BweEHrftVBMBuOCNSp8y5ss7jDP5Iu%2FBjqyAT2lA1l32Xsa1doyemZyuyklW3hBQObQzaOIfqt0REpbgA3YlNeNDY%2FkG2EfBfEKNOzR3tA9Zrm2ez4mWkd%2Bnk5noQO3a%2BZPiazIpR%2BEpY%2BXtIl9sxj%2BCoFt5NyVydIeQ47wXtKqKb9zoJSrY5ITBK%2B%2Fe%2FZfrAV9fXkTL3L%2Fc%2FL6wa0dSeA8FrTsTDvql7F4gEm%2Fvt3XNhGi7ISupxr5ryFPnBfNO9isedAQIjSmkxPVWhI%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=f501248fdbbb30c0514d44297d96faa53c4894eb4397cd249fe524ea10b1dd6a",
        "image_3": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/ib8gkrquvw3bi4ya6vz3m6nb11x2?response-content-disposition=attachment%3B%20filename%3D%22popup.png%22%3B%20filename%2A%3DUTF-8%27%27popup.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQ4THEFA5D%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T184547Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjELL%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIA%2FmPasm3e%2B19iYq8ElMfUlBHfCf6hlXlZIXFhTG6MsyAiA22QrvM1KyqD2QsQPlvEB5%2BqWhlwUVotrDfZ53lEo%2FwSqyBQgbEAMaDDAxMzYxOTI3NDg0OSIMp2KwBQXeE9h770PMKo8F2LsCKqJJekXmGYpoE3BMHakxy0DuOEoxo%2FRth%2BpPUahbaR4h4NfxMSEHG4yYJFrDfhifa0VJ1tExh20vARZQFhJGsx6AGuBVoIWIUTGIXfSokr8PnPDb6HbDx72p3Y5U793ruMsTrfXTJgvJNn7wmPvIi6cScEn6eSvBEb7ALVamM9aSLLie%2FIIB3Pohl4kFNE57dyq6a2whlTUHbzYxlhklVXsex4nQ%2BX1BAlfc85T17OPewfEhHrhgVqYGXfLpaeBzZxEEgZwVJRZnu233bFRpuZL5k9KmZB0ZBQWC7mJKCeHqXoODzjFMoWokeXZwLf1qUNEtSW5VUkFWQufOhkbKJMSboIPt6ql8DQlkzhmSNhQkAhqCtFHtRlJi3UXykxDW07%2FEcfTfmfUilVdogKxQVmbqvV8%2FDXapSnbWCJyBCFeEt0KZRsTlCIn3z2QWN0CcaEr2oauE6vcCuHDOAzX8x5PbXGgK2o0XfDL58vKV%2B0NlORnv7BwHJy3gyJFam%2FkhiJTHbd4ElgG%2FnWqoo13ioV1VIZTaQh7Gwv6hJhKyrHTZQElF%2FPZDI3IsnKKKq4qReoy51Gqe9s17ZrK%2BKlcs6WnFZPspohVhTI6L2%2BdQDThzVEOA%2FdQy9zdfsXDjguDvvzMWvmENdzBQLrfT2nls43AIwnfblCgoxCAtEBHH%2B06giDFvCWsP47XN2tavYho7M0fqXRex6NZ0lMAQjAbjuaJwldBGjyUIJINjJC1IxXemIiJuTeQSeWt06F3qDzGfI7iWqR6Dovn%2Bxkl23yz0E%2FRHic0ABTenPEMDwZGrfxjW2gJChxPvwdyfCVkB6lKFdKf1k6GW3eaxq%2BweEHrftVBMBuOCNSp8y5ss7jDP5Iu%2FBjqyAT2lA1l32Xsa1doyemZyuyklW3hBQObQzaOIfqt0REpbgA3YlNeNDY%2FkG2EfBfEKNOzR3tA9Zrm2ez4mWkd%2Bnk5noQO3a%2BZPiazIpR%2BEpY%2BXtIl9sxj%2BCoFt5NyVydIeQ47wXtKqKb9zoJSrY5ITBK%2B%2Fe%2FZfrAV9fXkTL3L%2Fc%2FL6wa0dSeA8FrTsTDvql7F4gEm%2Fvt3XNhGi7ISupxr5ryFPnBfNO9isedAQIjSmkxPVWhI%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=34d9a55a011ee8d5a00566a8d3eb6d0462bcf9e630a80d16e46eebed17907582"
    },
    "disclosed_date": 1631727840,
    "report_url": "https://hackerone.com/reports/1256777",
    "is_multi_component": false,
    "complexity": "LOW",
    "novelty": "LOW",
    "vuln_category": "WEB_APP",
    "steps": [
        [
            1,
            "Log in as attacker01"
        ],
        [
            2,
            "Create a group 'attack_group'"
        ],
        [
            3,
            "Navigate to group settings and set 'Default initial branch name' to a script payload (e.g., <script>alert(1);</script>)"
        ],
        [
            4,
            "Save the changes"
        ],
        [
            5,
            "Create a new project under 'attack_group'"
        ],
        [
            6,
            "Observe the script execution on the project's main page"
        ],
        [
            7,
            "Optional: Invite another user as a Developer and observe script execution when they visit the project"
        ]
    ],
    "vuln_description": "A stored XSS vulnerability exists in the main page of a GitLab project, allowing arbitrary JavaScript execution by manipulating the 'Default initial branch name' setting in a group. This can lead to various malicious actions depending on the CSP settings, including token generation and complete system compromise if the victim is an administrator.",
    "reason": "The vulnerability involves manipulating a group setting to inject a script that executes on project creation. While the steps are straightforward, the impact varies based on CSP settings, adding some complexity. The attack does not require novel logic or complex state manipulation.",
    "new_complexity": "MEDIUM",
    "requires_code": false,
    "requires_CVE": false,
    "is_ctf": false,
    "other_report": null,
    "authnz_metadata": {
        "reason": "The vulnerability involves a stored XSS where the payload is injected via the 'Default initial branch name' field in a group's settings. The methodology described focuses on testing authorization boundaries by swapping user sessions and resource IDs within the same application. However, this XSS vulnerability does not involve crossing authorization boundaries but rather exploits improper input sanitization and output encoding. The methodology does not cover testing for XSS vulnerabilities, which require different detection methods such as input fuzzing and output context analysis.",
        "is_detectable": false
    }
}