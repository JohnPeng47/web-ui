{
    "reported_to": "GitLab",
    "reported_by": "joaxcar ",
    "title": "Stored XSS in merge request creation page through payload in approval rule name",
    "content": "\nSummary\nHi GitLab team, I found a stored XSS in merge request creation page caused by a payload in the name of an \"approval rule\".\nAdding approval rules is a feature that is unlocked for premium subscriptions or above. This does not seem to block it from being used against regular users on for example Gitlab.com by inviting them into the \"infected project\".\nThis occurs when adding an \"Approval rule\" to a project and giving it a javascript/html payload as the name and attaching the rule to an approver. When a user tries to create a merge request in the project and opens the \"Reviewers\" dropdown, information about the user with the attached rule will be shown and the rule name will be injected underneath.\nWith the payload\nCode 115 Bytes\n1<iframe/srcdoc='<script/src=/joaxcar_group/first/-/jobs/1415515489/artifacts/raw/data/alert.js></script>'></iframe>\nthis XSS bypasses the current CSP on Gitlab.com (tried it with an Ultimate trial and inviting a user without a trial to the project)\nAs I got the impression that all XSS are treated equal when reporting a similar issue, I have not made any deeper analysis of the reason for this firing. Thought I just report it right away. Please reach back to me if you need me to research the impact deeper! As an example, it does not fire when one \"edits\" a MR which is a bit odd...\nSteps to reproduce\nCreate two user accounts, attacker_user and victim_user (attacker_user must have at least premium features enabled)\nLog in as attacker_user\nCreate a project xss_project by going to https://gitlab.com/projects/new#blank_project\nGo to projects settings on https://gitlab.com/attacker_user/xss_project/edit and scroll down to and expand \"Merge request approvals\"\n<image_0>\nClick \"Add approval rule\"\nPut the payload as the name, If on Gitlab.com use\nCode 115 Bytes\n1<iframe/srcdoc='<script/src=/joaxcar_group/first/-/jobs/1415515489/artifacts/raw/data/alert.js></script>'></iframe>\nif this is tested on a server without CSP feel free to use the payload\nCode 39 Bytes\n1<script>alert(document.domain)</script>\nSearch for and select attacker_user as approver and click create rule.\n<image_1>\nInvite victim_user to the project as Developer on https://gitlab.com/attacker_user/xss_project/-/project_members\nLog out and log back in as victim_user\nGo to https://\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588/user_01/pub/-/branches/new and create a branch new\nDirectly click on \"Create merge request\" (which will appear on the screen)\n<image_2>\nClick on the dropdown at \"Reviewers\"\nPayload will trigger\n<image_3>\nImpact\nStored XSS with CSP bypass. Full Javascript functionality without restrictions, so everything from stealing data to generating and exfiltrating access tokens.\nExamples\nIf you access my private project at Gitlab.com (https://gitlab.com/ultimate-joaxcar-test3/xss) as an admin, you should be able to create an MR and trigger payload. (Just an alert box)\nWhat is the current bug behavior?\nApprover rule name is injected in the user information without proper sanitization.\nWhat is the expected correct behavior?\nThe name should be sanitized\nOutput of checks\nThis bug happens on GitLab.com\nImpact\nStored XSS with CSP bypass. Full Javascript functionality without restrictions, so everything from stealing data to generating and exfiltrating access tokens.\n\n",
    "severity": [
        7.0,
        8.9
    ],
    "bounty": 3000,
    "weaknesses": [
        "Cross-site Scripting (XSS) - Stored"
    ],
    "screenshots": {
        "image_0": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/61r59msq1h0wo4i9ac6guhq67c3w?response-content-disposition=attachment%3B%20filename%3D%22approvals.png%22%3B%20filename%2A%3DUTF-8%27%27approvals.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQWGOAYHVA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T031656Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBdWGOjQbnWoWM%2BubecMPFGh0IHiKIeGqzE3ALwa9H7EAiAK9tI%2FDX%2B4Ijo5QfFkvYuu%2Be4kBFFKEfs0NMnvPc9G3yq6BQj7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAMaDDAxMzYxOTI3NDg0OSIMAuVxqIesaUkje0XlKo4F9b%2FbrfnUzp94Osp6zB5i%2FUe56ZwO5yC%2Fui4X1eB9PKGcoxsvzfro31hiPk3yu3t40AOMjfuBkU5FZM2Q%2FNEJmXuhkEUWd5CdXnL%2F40QmdpxqPbWtiPP0KbvLs%2FLSRM5ZJK6ebyyKTuCef4i%2B8MGXZHQPU6N%2Bmg%2FqiMJVkm5hsJDgHJOGXfjpLs955qbvr1ozdevKR43uTo0jVAUXoTTR39BORtd4aQIBGEBMLdGKLVpp4YpazE3m877Ic4ljOeGipipXX8NyuwWoSewSlIKhpIZ%2FCblGkc3J6arq48QFzrnSGmiN2OPp7hQcRnvpXTXlRN0ZXeokbOvMVVoUQfOhuQ9vqDK42N8Ow2ZRs07dPiy8Ezfe3z9hjwRePe17hROq22i1B5B7FSOZ2y5EgYZeYKdsTBBAjZ66025FTq6jOdZUx5XELrBpP3kMO78Q7vlwHI%2BHjDf%2BcJm%2BX7xB1jrhi5kh6otau9pkiGEmmUcvNE01Nf7jexPdJkNM8lWTq7Le2eJv8swe0dTMRkMiohAv%2FMd7GkdeVR%2FY%2F7o3VtFcTCQxdMA4eLvLvLwbnoAfL2WdpvfoajIoTxPOZpRDqhpImHLPI4GtWOWM4vw2XIegVWNhHs7oIOdJYqfH8wRkb60mO506u4itCNO9iRXEARJttalgICxWfgW%2BT8uivTCJLxyRihJJNMAsmA7IBX9LR6bJShdNb1izcdfWzeuOBZVJlM1XDon8mFNOJ0WHzqS0CF6%2BUm5oo%2BSfE3beV%2FIGRJR5V7b7rxrBKuiJ%2FwnER4Pu%2FRX52VlBzlBwIOAo1Uxng54YRYpIr5nM3zoLep9qRwxNfDAU0AVyMEXHSckD0jHqvtEHq1bKK6CRk87tcW0tMNaliL8GOrIBoL2lX8iAgx5aAaZ7jI%2F5XIw5AxTnwtwG1woZxrNasORW8EbLCzhxqQffM5QOfGl7eELfdtDdRehpQjst337gz9d7xYhTTwTsG8pmXxBUwJbxDHXHa1jBnuADeIucY5rfIv%2F%2B%2BIgf6yTKKV7o7XEvmqRUNTz16%2BpYkVQ8SSC2ViG3dnypfVj6G%2F6L4exRKlfMEjjhgmLYTNFaw3mmqMiMn4gdAF7hIfnsYWG97gvtlINNzw%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=048f39cc3eed7009828775a2eea56513565ae126cfa354d2886f6af78580a781",
        "image_1": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/prpdxrbzdwd3ftndjzlxv2y4occ5?response-content-disposition=attachment%3B%20filename%3D%22create.png%22%3B%20filename%2A%3DUTF-8%27%27create.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQWGOAYHVA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T031656Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBdWGOjQbnWoWM%2BubecMPFGh0IHiKIeGqzE3ALwa9H7EAiAK9tI%2FDX%2B4Ijo5QfFkvYuu%2Be4kBFFKEfs0NMnvPc9G3yq6BQj7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAMaDDAxMzYxOTI3NDg0OSIMAuVxqIesaUkje0XlKo4F9b%2FbrfnUzp94Osp6zB5i%2FUe56ZwO5yC%2Fui4X1eB9PKGcoxsvzfro31hiPk3yu3t40AOMjfuBkU5FZM2Q%2FNEJmXuhkEUWd5CdXnL%2F40QmdpxqPbWtiPP0KbvLs%2FLSRM5ZJK6ebyyKTuCef4i%2B8MGXZHQPU6N%2Bmg%2FqiMJVkm5hsJDgHJOGXfjpLs955qbvr1ozdevKR43uTo0jVAUXoTTR39BORtd4aQIBGEBMLdGKLVpp4YpazE3m877Ic4ljOeGipipXX8NyuwWoSewSlIKhpIZ%2FCblGkc3J6arq48QFzrnSGmiN2OPp7hQcRnvpXTXlRN0ZXeokbOvMVVoUQfOhuQ9vqDK42N8Ow2ZRs07dPiy8Ezfe3z9hjwRePe17hROq22i1B5B7FSOZ2y5EgYZeYKdsTBBAjZ66025FTq6jOdZUx5XELrBpP3kMO78Q7vlwHI%2BHjDf%2BcJm%2BX7xB1jrhi5kh6otau9pkiGEmmUcvNE01Nf7jexPdJkNM8lWTq7Le2eJv8swe0dTMRkMiohAv%2FMd7GkdeVR%2FY%2F7o3VtFcTCQxdMA4eLvLvLwbnoAfL2WdpvfoajIoTxPOZpRDqhpImHLPI4GtWOWM4vw2XIegVWNhHs7oIOdJYqfH8wRkb60mO506u4itCNO9iRXEARJttalgICxWfgW%2BT8uivTCJLxyRihJJNMAsmA7IBX9LR6bJShdNb1izcdfWzeuOBZVJlM1XDon8mFNOJ0WHzqS0CF6%2BUm5oo%2BSfE3beV%2FIGRJR5V7b7rxrBKuiJ%2FwnER4Pu%2FRX52VlBzlBwIOAo1Uxng54YRYpIr5nM3zoLep9qRwxNfDAU0AVyMEXHSckD0jHqvtEHq1bKK6CRk87tcW0tMNaliL8GOrIBoL2lX8iAgx5aAaZ7jI%2F5XIw5AxTnwtwG1woZxrNasORW8EbLCzhxqQffM5QOfGl7eELfdtDdRehpQjst337gz9d7xYhTTwTsG8pmXxBUwJbxDHXHa1jBnuADeIucY5rfIv%2F%2B%2BIgf6yTKKV7o7XEvmqRUNTz16%2BpYkVQ8SSC2ViG3dnypfVj6G%2F6L4exRKlfMEjjhgmLYTNFaw3mmqMiMn4gdAF7hIfnsYWG97gvtlINNzw%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=4aa3bc8fce8eb751f25203898e568dd38e0dc9442dc6ad16d202f0ed48379af9",
        "image_2": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/yvaxgf2ipfotucj6isg6crdbzekt?response-content-disposition=attachment%3B%20filename%3D%22newMR.png%22%3B%20filename%2A%3DUTF-8%27%27newMR.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQWGOAYHVA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T031656Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBdWGOjQbnWoWM%2BubecMPFGh0IHiKIeGqzE3ALwa9H7EAiAK9tI%2FDX%2B4Ijo5QfFkvYuu%2Be4kBFFKEfs0NMnvPc9G3yq6BQj7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAMaDDAxMzYxOTI3NDg0OSIMAuVxqIesaUkje0XlKo4F9b%2FbrfnUzp94Osp6zB5i%2FUe56ZwO5yC%2Fui4X1eB9PKGcoxsvzfro31hiPk3yu3t40AOMjfuBkU5FZM2Q%2FNEJmXuhkEUWd5CdXnL%2F40QmdpxqPbWtiPP0KbvLs%2FLSRM5ZJK6ebyyKTuCef4i%2B8MGXZHQPU6N%2Bmg%2FqiMJVkm5hsJDgHJOGXfjpLs955qbvr1ozdevKR43uTo0jVAUXoTTR39BORtd4aQIBGEBMLdGKLVpp4YpazE3m877Ic4ljOeGipipXX8NyuwWoSewSlIKhpIZ%2FCblGkc3J6arq48QFzrnSGmiN2OPp7hQcRnvpXTXlRN0ZXeokbOvMVVoUQfOhuQ9vqDK42N8Ow2ZRs07dPiy8Ezfe3z9hjwRePe17hROq22i1B5B7FSOZ2y5EgYZeYKdsTBBAjZ66025FTq6jOdZUx5XELrBpP3kMO78Q7vlwHI%2BHjDf%2BcJm%2BX7xB1jrhi5kh6otau9pkiGEmmUcvNE01Nf7jexPdJkNM8lWTq7Le2eJv8swe0dTMRkMiohAv%2FMd7GkdeVR%2FY%2F7o3VtFcTCQxdMA4eLvLvLwbnoAfL2WdpvfoajIoTxPOZpRDqhpImHLPI4GtWOWM4vw2XIegVWNhHs7oIOdJYqfH8wRkb60mO506u4itCNO9iRXEARJttalgICxWfgW%2BT8uivTCJLxyRihJJNMAsmA7IBX9LR6bJShdNb1izcdfWzeuOBZVJlM1XDon8mFNOJ0WHzqS0CF6%2BUm5oo%2BSfE3beV%2FIGRJR5V7b7rxrBKuiJ%2FwnER4Pu%2FRX52VlBzlBwIOAo1Uxng54YRYpIr5nM3zoLep9qRwxNfDAU0AVyMEXHSckD0jHqvtEHq1bKK6CRk87tcW0tMNaliL8GOrIBoL2lX8iAgx5aAaZ7jI%2F5XIw5AxTnwtwG1woZxrNasORW8EbLCzhxqQffM5QOfGl7eELfdtDdRehpQjst337gz9d7xYhTTwTsG8pmXxBUwJbxDHXHa1jBnuADeIucY5rfIv%2F%2B%2BIgf6yTKKV7o7XEvmqRUNTz16%2BpYkVQ8SSC2ViG3dnypfVj6G%2F6L4exRKlfMEjjhgmLYTNFaw3mmqMiMn4gdAF7hIfnsYWG97gvtlINNzw%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=8825099df6100dbd863e0f10493512ed639667d3ef841147e88d883e4cc57e2c",
        "image_3": "https://hackerone-us-west-2-production-attachments.s3.us-west-2.amazonaws.com/wucl49piuyctyv1wp78gsjy21hnv?response-content-disposition=attachment%3B%20filename%3D%22fire.png%22%3B%20filename%2A%3DUTF-8%27%27fire.png&response-content-type=image%2Fpng&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=ASIAQGK6FURQWGOAYHVA%2F20250325%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250325T031656Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEKP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMiJGMEQCIBdWGOjQbnWoWM%2BubecMPFGh0IHiKIeGqzE3ALwa9H7EAiAK9tI%2FDX%2B4Ijo5QfFkvYuu%2Be4kBFFKEfs0NMnvPc9G3yq6BQj7%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAMaDDAxMzYxOTI3NDg0OSIMAuVxqIesaUkje0XlKo4F9b%2FbrfnUzp94Osp6zB5i%2FUe56ZwO5yC%2Fui4X1eB9PKGcoxsvzfro31hiPk3yu3t40AOMjfuBkU5FZM2Q%2FNEJmXuhkEUWd5CdXnL%2F40QmdpxqPbWtiPP0KbvLs%2FLSRM5ZJK6ebyyKTuCef4i%2B8MGXZHQPU6N%2Bmg%2FqiMJVkm5hsJDgHJOGXfjpLs955qbvr1ozdevKR43uTo0jVAUXoTTR39BORtd4aQIBGEBMLdGKLVpp4YpazE3m877Ic4ljOeGipipXX8NyuwWoSewSlIKhpIZ%2FCblGkc3J6arq48QFzrnSGmiN2OPp7hQcRnvpXTXlRN0ZXeokbOvMVVoUQfOhuQ9vqDK42N8Ow2ZRs07dPiy8Ezfe3z9hjwRePe17hROq22i1B5B7FSOZ2y5EgYZeYKdsTBBAjZ66025FTq6jOdZUx5XELrBpP3kMO78Q7vlwHI%2BHjDf%2BcJm%2BX7xB1jrhi5kh6otau9pkiGEmmUcvNE01Nf7jexPdJkNM8lWTq7Le2eJv8swe0dTMRkMiohAv%2FMd7GkdeVR%2FY%2F7o3VtFcTCQxdMA4eLvLvLwbnoAfL2WdpvfoajIoTxPOZpRDqhpImHLPI4GtWOWM4vw2XIegVWNhHs7oIOdJYqfH8wRkb60mO506u4itCNO9iRXEARJttalgICxWfgW%2BT8uivTCJLxyRihJJNMAsmA7IBX9LR6bJShdNb1izcdfWzeuOBZVJlM1XDon8mFNOJ0WHzqS0CF6%2BUm5oo%2BSfE3beV%2FIGRJR5V7b7rxrBKuiJ%2FwnER4Pu%2FRX52VlBzlBwIOAo1Uxng54YRYpIr5nM3zoLep9qRwxNfDAU0AVyMEXHSckD0jHqvtEHq1bKK6CRk87tcW0tMNaliL8GOrIBoL2lX8iAgx5aAaZ7jI%2F5XIw5AxTnwtwG1woZxrNasORW8EbLCzhxqQffM5QOfGl7eELfdtDdRehpQjst337gz9d7xYhTTwTsG8pmXxBUwJbxDHXHa1jBnuADeIucY5rfIv%2F%2B%2BIgf6yTKKV7o7XEvmqRUNTz16%2BpYkVQ8SSC2ViG3dnypfVj6G%2F6L4exRKlfMEjjhgmLYTNFaw3mmqMiMn4gdAF7hIfnsYWG97gvtlINNzw%3D%3D&X-Amz-SignedHeaders=host&X-Amz-Signature=8bb0a3d7b2d6cafb2d8f05550411a781c5b1690da8cb429190c8e5b5c85258ee"
    },
    "disclosed_date": 1648769040,
    "report_url": "https://hackerone.com/reports/1342009",
    "is_multi_component": false,
    "complexity": "LOW",
    "novelty": "LOW",
    "vuln_category": "WEB_APP",
    "steps": [
        [
            1,
            "Create two user accounts: attacker_user (with premium features) and victim_user"
        ],
        [
            2,
            "Attacker creates a project and adds an approval rule with XSS payload as the name"
        ],
        [
            3,
            "Attacker invites victim_user to the project as a Developer"
        ],
        [
            4,
            "Victim logs in, creates a branch and attempts to create a merge request"
        ],
        [
            5,
            "Victim opens the 'Reviewers' dropdown, triggering the XSS payload"
        ]
    ],
    "vuln_description": "Stored XSS in merge request creation page through payload in approval rule name, bypassing CSP and allowing full JavaScript execution",
    "reason": "The attack requires understanding of multiple components (approval rules, merge request workflow, CSP bypass techniques) and involves non-obvious interaction between these components. The attacker needs to manipulate application state by creating specific project settings and user permissions.",
    "new_complexity": "MEDIUM",
    "requires_code": false,
    "requires_CVE": false,
    "is_ctf": false,
    "other_report": null,
    "injection_metadata": {
        "is_simple_payload": false
    },
    "authnz_metadata": {
        "reason": "The vulnerability involves a stored XSS through an approval rule name, which is a specific action (creating/modifying approval rules) tied to a resource (the project). The methodology involves testing actions with different user sessions and resource IDs. Since the XSS is triggered when a victim user interacts with the merge request creation page (a different action than creating the rule), and the payload is stored in the project settings (a resource), the methodology would detect this by testing the merge request creation action with different user sessions (including the victim's) and observing the stored payload execution.",
        "is_detectable": true
    }
}