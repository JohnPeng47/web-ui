from src.llm_models import openai_5
from src.agent.detection.prompts import DetectAndSchedule
from src.agent.discovery.pages import PageObservations

from eval.datasets.detection import PAGE_DATA_JSON, VULN_QUEUE_JSON

import json

"""
Creates queue data that can then be used to test the exploit agent pool
"""

model = openai_5()
page_contents = json.loads(open(PAGE_DATA_JSON, "r").read())
page_observations = PageObservations.from_json(page_contents)

detect = DetectAndSchedule()
actions = detect.invoke(model, prompt_args={"pages": page_observations})

with open(VULN_QUEUE_JSON, "w") as f:
    json.dump([action.model_dump() for action in actions], f)
