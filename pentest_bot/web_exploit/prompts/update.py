import sys

import opik

from .classify_steps import ClassifyStepsPrompt
from .exploit_agent import XSSAgentPrompt
from .classify_solution import ClassifySolutionPrompt

PROMPTS_TO_TRACK = [
    ClassifyStepsPrompt,
    XSSAgentPrompt,
    ClassifySolutionPrompt
]

if __name__ == "__main__":
    opik_client = opik.Opik()
    for prompt_cls in PROMPTS_TO_TRACK:
        prompt = prompt_cls()
        existing_prompt = opik_client.get_prompt(prompt.name)
        if existing_prompt:
            print(prompt.name, prompt.type)
            if existing_prompt.prompt != prompt.prompt or existing_prompt.type != prompt.type:
                print(f"Prompt {prompt.name} already exists but prompt is different, updating ...")
            else:
                print(f"Prompt {prompt.name} already exists and prompt is the same")
                continue
        else:
            print(f"Prompt {prompt.name} does not exist, creating ...")

        opik_client.create_prompt(
            name=prompt.name,
            prompt=prompt.prompt,
            type=prompt.type,
        )