from __future__ import annotations

from argparse import Namespace

from pentest_bot.db import get_session
from pentest_bot.db.tables.agent import get_cost_summary

from pentest_bot.cli_db.helpers import build_table


def cost_cmd(args: Namespace) -> None:
    """Display cost summary (today, week, per-model)"""

    with get_session() as session:
        today_cost, week_cost, per_model = get_cost_summary(session)

    print("\nCOST SUMMARY (UTC)")
    print("------------------")
    print(f"Total cost TODAY       : $ {today_cost:.4f}")
    print(f"Total cost THIS WEEK   : $ {week_cost:.4f}\n")

    if per_model:
        headers = ["Model", "Total Cost ($)", "Total Steps", "Avg/Step ($)"]
        rows = [[model, f"{total:.4f}", str(steps), f"{avg:.6f}"] for model, total, steps, avg in per_model]
        print("PER-MODEL AVERAGES")
        print(build_table(rows, headers))
    else:
        print("<no PentestResult rows in database>") 